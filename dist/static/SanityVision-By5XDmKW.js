import{r as L,j as C,_ as lu,b as au,g as uu,c as me,u as Tn,C as be,a as cu,S as je,B as st,H as hu,e as is,F as Ne,o as Cl,f as yl,h as du,i as fu,k as pu,l as bl,n as bt,v as At,p as Al,q as gu,s as mu,t as Du,w as Cu,x as yu,y as bu,z as Au,A as to,P as io,D as zi,E as ce,G as Ye,I as xu,J as xl,K as le,T as _e,L as Su,M as vu,N as ro,O as wu,Q as Eu,R as qr,U as Fu,V as Bu,W as ku,X as Ei,Y as Mu,Z as Ou,$ as Ru,a0 as Tu,a1 as Lu,a2 as so,a3 as Pu,a4 as ju,a5 as Nu,a6 as _u,a7 as Iu,a8 as zu,a9 as Wu,aa as Hu,ab as Vu,ac as Ls,ad as Sl,ae as qu,af as vl,ag as $u,ah as Ku,ai as wl,aj as Uu,ak as Qu}from"./sanity-DIL4OtZx.js";import{E as Dt,S as $i,F as re,T as Ju,A as El,a as X,b as pi,P as Ln,c as Ze,C as Fl,R as Se,d as Pn,f as vt,e as sn,M as Ti,g as Yu,k as Gu,h as Bl,i as Xu,j as Zu,s as ec,l as jn,m as kl,n as tc,o as ic,p as rc,q as Ml,r as sc,t as Ol,u as nc,v as oc,w as lc,x as Rl,y as ac,z as Tl,B as Nn,D as Ll,G as Pl,H as jl,I as uc,J as Nl,K as cc,L as hc,N as dc,O as fc,Q as K}from"./index-CmXZMIcS.js";import{javascriptLanguage as pc}from"./index-BrkrbVgj.js";import"./index-DQEyl6Lc.js";var gc=Object.defineProperty,no=Object.getOwnPropertySymbols,mc=Object.prototype.hasOwnProperty,Dc=Object.prototype.propertyIsEnumerable,oo=(i,e,t)=>e in i?gc(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,lo=(i,e)=>{for(var t in e||(e={}))mc.call(e,t)&&oo(i,t,e[t]);if(no)for(var t of no(e))Dc.call(e,t)&&oo(i,t,e[t]);return i};const ao=function(i){const{children:e,className:t,split:r,style:s,size:n,eleRef:o}=i;let l={flex:1,position:"relative",outline:"none"};n!==void 0&&(r==="vertical"?l.width=n:(l.height=n,l.display="flex"),l.flex="none"),l=lo(lo({},l),s);const a=["Pane",r,t].filter(Boolean).join(" ");return C.jsx("div",{role:"region",ref:o,className:a,style:l,children:e})},nn="Resizer",Cc=function(i){const{className:e=nn,onClick:t,onDoubleClick:r,onMouseDown:s,onTouchEnd:n,onTouchStart:o,resizerClassName:l,split:a,style:u}=i,c=[l,a,e].filter(Boolean).join(" ");return C.jsx("span",{role:"separator",className:c,style:u,onMouseDown:h=>s(h.nativeEvent),onTouchStart:h=>{h.preventDefault(),o(h.nativeEvent)},onTouchEnd:h=>{h.preventDefault(),n(h.nativeEvent)},onClick:h=>{t&&(h.preventDefault(),t(h.nativeEvent))},onDoubleClick:h=>{r&&(h.preventDefault(),r(h.nativeEvent))}})};var yc=Object.defineProperty,bc=Object.defineProperties,Ac=Object.getOwnPropertyDescriptors,uo=Object.getOwnPropertySymbols,xc=Object.prototype.hasOwnProperty,Sc=Object.prototype.propertyIsEnumerable,on=(i,e,t)=>e in i?yc(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,ze=(i,e)=>{for(var t in e||(e={}))xc.call(e,t)&&on(i,t,e[t]);if(uo)for(var t of uo(e))Sc.call(e,t)&&on(i,t,e[t]);return i},$r=(i,e)=>bc(i,Ac(e)),_r=(i,e,t)=>on(i,typeof e!="symbol"?e+"":e,t);const _l={display:"flex",flex:1,height:"100%",position:"absolute",outline:"none",overflow:"hidden",MozUserSelect:"text",WebkitUserSelect:"text",msUserSelect:"text",userSelect:"text"},vc=$r(ze({},_l),{flexDirection:"row",left:0,right:0}),wc=$r(ze({},_l),{bottom:0,flexDirection:"column",minHeight:"100%",top:0,width:"100%"}),Ps={},Il=class Fi extends L.Component{constructor(e){super(e),_r(this,"pane1",null),_r(this,"pane2",null),_r(this,"splitPane",null),this.onMouseDown=this.onMouseDown.bind(this),this.onTouchStart=this.onTouchStart.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onTouchMove=this.onTouchMove.bind(this),this.onMouseUp=this.onMouseUp.bind(this);const{size:t,defaultSize:r,minSize:s,maxSize:n,primary:o}=e,l=t!==void 0?t:ho(r,s,n,void 0);this.state={active:!1,resized:!1,pane1Size:o==="first"?l:void 0,pane2Size:o==="second"?l:void 0,instanceProps:{size:t}}}componentDidMount(){document.addEventListener("mouseup",this.onMouseUp),document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("touchmove",this.onTouchMove),this.setState(Fi.getSizeUpdate(this.props,this.state))}static getDerivedStateFromProps(e,t){return Fi.getSizeUpdate(e,t)}componentWillUnmount(){document.removeEventListener("mouseup",this.onMouseUp),document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("touchmove",this.onTouchMove)}onMouseDown(e){this.onTouchStart($r(ze({},e),{touches:[{clientX:e.clientX,clientY:e.clientY}]}))}onTouchStart(e){const{allowResize:t,onDragStarted:r,split:s}=this.props;if(t){co(document,window);const n=s==="vertical"?e.touches[0].clientX:e.touches[0].clientY;typeof r=="function"&&r(),this.setState({active:!0,position:n})}}onMouseMove(e){const t=Object.assign({},e,{touches:[{clientX:e.clientX,clientY:e.clientY}]});this.onTouchMove(t)}onTouchMove(e){if(!this.state.active||!this.props.allowResize)return;const{position:t=0}=this.state,{maxSize:r,minSize:s=Fi.defaultProps.minSize,onChange:n,split:o=Fi.defaultProps.split,step:l}=this.props;co(document,window);const a=this.props.primary==="first",u=a?this.pane1:this.pane2,c=a?this.pane2:this.pane1;if(!u||!c||!u.getBoundingClientRect)return;const h=u,d=c,p=h.getBoundingClientRect().width,g=h.getBoundingClientRect().height,f=o==="vertical"?e.touches[0].clientX:e.touches[0].clientY,m=o==="vertical"?p:g;let D=t-f;if(l){if(Math.abs(D)<l)return;D=~~(D/l)*l}let x=a?D:-D;const k=parseInt(window.getComputedStyle(h).order),B=parseInt(window.getComputedStyle(d).order);k>B&&(x=-x);let y=r;this.splitPane&&r!==void 0&&r<=0&&(o==="vertical"?y=this.splitPane.getBoundingClientRect().width+r:y=this.splitPane.getBoundingClientRect().height+r);let E=m-x;const R=t-D;s&&E<s?E=s:y!==void 0&&E>y?E=y:this.setState({position:R,resized:!0}),n&&n(E);const z=a?{pane1Size:E,pane2Size:void 0}:{pane2Size:E,pane1Size:void 0};this.setState(ze({draggedSize:E},z))}onMouseUp(){if(!this.state.active||!this.props.allowResize)return;const{onDragFinished:e}=this.props,{draggedSize:t}=this.state;typeof t<"u"&&typeof e=="function"&&e(t),this.setState({active:!1})}static getSizeUpdate(e,t){const{instanceProps:r}=t;if(r.size===e.size&&e.size!==void 0)return{};const s=e.size!==void 0?e.size:ho(e.defaultSize,e.minSize,e.maxSize,t.draggedSize),n=e.primary==="first"?{pane1Size:s,pane2Size:void 0}:{pane2Size:s,pane1Size:void 0};return $r(ze(ze({},n),typeof e.size>"u"?{}:{draggedSize:s}),{instanceProps:{size:e.size}})}render(){const{allowResize:e,children:t,className:r,onResizerClick:s,onResizerDoubleClick:n,paneClassName:o,pane1ClassName:l,pane2ClassName:a,paneStyle:u,pane1Style:c,pane2Style:h,resizerClassName:d=nn,resizerStyle:p,split:g,style:f}=this.props,{pane1Size:m,pane2Size:D}=this.state,x=e?"":"disabled",k=d&&`${d} ${nn}`,B=Ec(t),y=g==="vertical"?vc:wc,E=f?ze(ze({},y),f):y,R=["SplitPane",r,g,x].filter(Boolean).join(" "),z=fo(ze(ze({},u),c),Ps),S=fo(ze(ze({},u),h),Ps),b=["Pane1",o,l].join(" "),F=["Pane2",o,a].join(" ");return C.jsxs("div",{"data-testid":"split-pane",className:R,style:E,ref:M=>{this.splitPane=M},children:[C.jsx(ao,{className:b,eleRef:M=>{this.pane1=M},size:m,split:g,style:z,children:B[0]},"pane1"),C.jsx(Cc,{className:x,onClick:s,onDoubleClick:n,onMouseDown:this.onMouseDown,onTouchStart:this.onTouchStart,onTouchEnd:this.onMouseUp,resizerClassName:k,split:g||"vertical",style:p||Ps},"resizer"),C.jsx(ao,{className:F,eleRef:M=>{this.pane2=M},size:D,split:g,style:S,children:B[1]},"pane2")]})}};_r(Il,"defaultProps",{allowResize:!0,minSize:50,primary:"first",split:"vertical",paneClassName:"",pane1ClassName:"",pane2ClassName:""});let js=Il;function co(i,e){var t;if("selection"in i&&typeof i.selection=="object"&&i.selection&&"empty"in i.selection&&typeof i.selection.empty=="function")try{i.selection.empty()}catch{}else if(typeof e<"u"&&typeof e.getSelection=="function")try{(t=e.getSelection())==null||t.removeAllRanges()}catch{}}function ho(i,e,t,r){if(typeof r=="number"){const s=typeof e=="number"?e:0,n=typeof t=="number"&&t>=0?t:1/0;return Math.max(s,Math.min(n,r))}return i!==void 0?i:e}function Ec(i){return L.Children.toArray(i).filter(e=>e)}function Fc(i){return i===null||typeof i>"u"||Object.keys(i).length===0}function fo(i,e){return Fc(i)?e:i}let Me=typeof navigator<"u"?navigator:{userAgent:"",vendor:"",platform:""},ln=typeof document<"u"?document:{documentElement:{style:{}}};const an=/Edge\/(\d+)/.exec(Me.userAgent),zl=/MSIE \d/.test(Me.userAgent),un=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Me.userAgent),rs=!!(zl||un||an),po=!rs&&/gecko\/(\d+)/i.test(Me.userAgent),Ns=!rs&&/Chrome\/(\d+)/.exec(Me.userAgent),Bc="webkitFontSmoothing"in ln.documentElement.style,cn=!rs&&/Apple Computer/.test(Me.vendor),go=cn&&(/Mobile\/\w+/.test(Me.userAgent)||Me.maxTouchPoints>2);var N={mac:go||/Mac/.test(Me.platform),windows:/Win/.test(Me.platform),linux:/Linux|X11/.test(Me.platform),ie:rs,ie_version:zl?ln.documentMode||6:un?+un[1]:an?+an[1]:0,gecko:po,gecko_version:po?+(/Firefox\/(\d+)/.exec(Me.userAgent)||[0,0])[1]:0,chrome:!!Ns,chrome_version:Ns?+Ns[1]:0,ios:go,android:/Android\b/.test(Me.userAgent),webkit_version:Bc?+(/\bAppleWebKit\/(\d+)/.exec(Me.userAgent)||[0,0])[1]:0,safari:cn,safari_version:cn?+(/\bVersion\/(\d+(\.\d+)?)/.exec(Me.userAgent)||[0,0])[1]:0,tabSize:ln.documentElement.style.tabSize!=null?"tab-size":"-moz-tab-size"};function _n(i,e){for(let t in i)t=="class"&&e.class?e.class+=" "+i.class:t=="style"&&e.style?e.style+=";"+i.style:e[t]=i[t];return e}const Kr=Object.create(null);function In(i,e,t){if(i==e)return!0;i||(i=Kr),e||(e=Kr);let r=Object.keys(i),s=Object.keys(e);if(r.length-0!=s.length-0)return!1;for(let n of r)if(n!=t&&(s.indexOf(n)==-1||i[n]!==e[n]))return!1;return!0}function kc(i,e){for(let t=i.attributes.length-1;t>=0;t--){let r=i.attributes[t].name;e[r]==null&&i.removeAttribute(r)}for(let t in e){let r=e[t];t=="style"?i.style.cssText=r:i.getAttribute(t)!=r&&i.setAttribute(t,r)}}function mo(i,e,t){let r=!1;if(e)for(let s in e)t&&s in t||(r=!0,s=="style"?i.style.cssText="":i.removeAttribute(s));if(t)for(let s in t)e&&e[s]==t[s]||(r=!0,s=="style"?i.style.cssText=t[s]:i.setAttribute(s,t[s]));return r}function Mc(i){let e=Object.create(null);for(let t=0;t<i.attributes.length;t++){let r=i.attributes[t];e[r.name]=r.value}return e}class zt{eq(e){return!1}updateDOM(e,t){return!1}compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}get estimatedHeight(){return-1}get lineBreaks(){return 0}ignoreEvent(e){return!0}coordsAt(e,t,r){return null}get isHidden(){return!1}get editable(){return!1}destroy(e){}}var Ee=(function(i){return i[i.Text=0]="Text",i[i.WidgetBefore=1]="WidgetBefore",i[i.WidgetAfter=2]="WidgetAfter",i[i.WidgetRange=3]="WidgetRange",i})(Ee||(Ee={}));class ge extends Pn{constructor(e,t,r,s){super(),this.startSide=e,this.endSide=t,this.widget=r,this.spec=s}get heightRelevant(){return!1}static mark(e){return new Ki(e)}static widget(e){let t=Math.max(-1e4,Math.min(1e4,e.side||0)),r=!!e.block;return t+=r&&!e.inlineOrder?t>0?3e8:-4e8:t>0?1e8:-1e8,new Nt(e,t,t,r,e.widget||null,!1)}static replace(e){let t=!!e.block,r,s;if(e.isBlockGap)r=-5e8,s=4e8;else{let{start:n,end:o}=Wl(e,t);r=(n?t?-3e8:-1:5e8)-1,s=(o?t?2e8:1:-6e8)+1}return new Nt(e,r,s,t,e.widget||null,!0)}static line(e){return new Ui(e)}static set(e,t=!1){return Se.of(e,t)}hasHeight(){return this.widget?this.widget.estimatedHeight>-1:!1}}ge.none=Se.empty;class Ki extends ge{constructor(e){let{start:t,end:r}=Wl(e);super(t?-1:5e8,r?1:-6e8,null,e),this.tagName=e.tagName||"span",this.attrs=e.class&&e.attributes?_n(e.attributes,{class:e.class}):e.class?{class:e.class}:e.attributes||Kr}eq(e){return this==e||e instanceof Ki&&this.tagName==e.tagName&&In(this.attrs,e.attrs)}range(e,t=e){if(e>=t)throw new RangeError("Mark decorations may not be empty");return super.range(e,t)}}Ki.prototype.point=!1;class Ui extends ge{constructor(e){super(-2e8,-2e8,null,e)}eq(e){return e instanceof Ui&&this.spec.class==e.spec.class&&In(this.spec.attributes,e.spec.attributes)}range(e,t=e){if(t!=e)throw new RangeError("Line decoration ranges must be zero-length");return super.range(e,t)}}Ui.prototype.mapMode=Ti.TrackBefore;Ui.prototype.point=!0;class Nt extends ge{constructor(e,t,r,s,n,o){super(t,r,n,e),this.block=s,this.isReplace=o,this.mapMode=s?t<=0?Ti.TrackBefore:Ti.TrackAfter:Ti.TrackDel}get type(){return this.startSide!=this.endSide?Ee.WidgetRange:this.startSide<=0?Ee.WidgetBefore:Ee.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&(this.widget.estimatedHeight>=5||this.widget.lineBreaks>0)}eq(e){return e instanceof Nt&&Oc(this.widget,e.widget)&&this.block==e.block&&this.startSide==e.startSide&&this.endSide==e.endSide}range(e,t=e){if(this.isReplace&&(e>t||e==t&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&t!=e)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(e,t)}}Nt.prototype.point=!0;function Wl(i,e=!1){let{inclusiveStart:t,inclusiveEnd:r}=i;return t==null&&(t=i.inclusive),r==null&&(r=i.inclusive),{start:t??e,end:r??e}}function Oc(i,e){return i==e||!!(i&&e&&i.compare(e))}function hi(i,e,t,r=0){let s=t.length-1;s>=0&&t[s]+r>=i?t[s]=Math.max(t[s],e):t.push(i,e)}class Wi extends Pn{constructor(e,t){super(),this.tagName=e,this.attributes=t}eq(e){return e==this||e instanceof Wi&&this.tagName==e.tagName&&In(this.attributes,e.attributes)}static create(e){return new Wi(e.tagName,e.attributes||Kr)}static set(e,t=!1){return Se.of(e,t)}}Wi.prototype.startSide=Wi.prototype.endSide=-1;function gi(i){let e;return i.nodeType==11?e=i.getSelection?i:i.ownerDocument:e=i,e.getSelection()}function hn(i,e){return e?i==e||i.contains(e.nodeType!=1?e.parentNode:e):!1}function Li(i,e){if(!e.anchorNode)return!1;try{return hn(i,e.anchorNode)}catch{return!1}}function Pi(i){return i.nodeType==3?Vi(i,0,i.nodeValue.length).getClientRects():i.nodeType==1?i.getClientRects():[]}function ji(i,e,t,r){return t?Do(i,e,t,r,-1)||Do(i,e,t,r,1):!1}function Et(i){for(var e=0;;e++)if(i=i.previousSibling,!i)return e}function Ur(i){return i.nodeType==1&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(i.nodeName)}function Do(i,e,t,r,s){for(;;){if(i==t&&e==r)return!0;if(e==(s<0?0:yt(i))){if(i.nodeName=="DIV")return!1;let n=i.parentNode;if(!n||n.nodeType!=1)return!1;e=Et(i)+(s<0?0:1),i=n}else if(i.nodeType==1){if(i=i.childNodes[e+(s<0?-1:0)],i.nodeType==1&&i.contentEditable=="false")return!1;e=s<0?yt(i):0}else return!1}}function yt(i){return i.nodeType==3?i.nodeValue.length:i.childNodes.length}function Hi(i,e){let t=e?i.left:i.right;return{left:t,right:t,top:i.top,bottom:i.bottom}}function Rc(i){let e=i.visualViewport;return e?{left:0,right:e.width,top:0,bottom:e.height}:{left:0,right:i.innerWidth,top:0,bottom:i.innerHeight}}function Hl(i,e){let t=e.width/i.offsetWidth,r=e.height/i.offsetHeight;return(t>.995&&t<1.005||!isFinite(t)||Math.abs(e.width-i.offsetWidth)<1)&&(t=1),(r>.995&&r<1.005||!isFinite(r)||Math.abs(e.height-i.offsetHeight)<1)&&(r=1),{scaleX:t,scaleY:r}}function Tc(i,e,t,r,s,n,o,l){let a=i.ownerDocument,u=a.defaultView||window;for(let c=i,h=!1;c&&!h;)if(c.nodeType==1){let d,p=c==a.body,g=1,f=1;if(p)d=Rc(u);else{if(/^(fixed|sticky)$/.test(getComputedStyle(c).position)&&(h=!0),c.scrollHeight<=c.clientHeight&&c.scrollWidth<=c.clientWidth){c=c.assignedSlot||c.parentNode;continue}let x=c.getBoundingClientRect();({scaleX:g,scaleY:f}=Hl(c,x)),d={left:x.left,right:x.left+c.clientWidth*g,top:x.top,bottom:x.top+c.clientHeight*f}}let m=0,D=0;if(s=="nearest")e.top<d.top?(D=e.top-(d.top+o),t>0&&e.bottom>d.bottom+D&&(D=e.bottom-d.bottom+o)):e.bottom>d.bottom&&(D=e.bottom-d.bottom+o,t<0&&e.top-D<d.top&&(D=e.top-(d.top+o)));else{let x=e.bottom-e.top,k=d.bottom-d.top;D=(s=="center"&&x<=k?e.top+x/2-k/2:s=="start"||s=="center"&&t<0?e.top-o:e.bottom-k+o)-d.top}if(r=="nearest"?e.left<d.left?(m=e.left-(d.left+n),t>0&&e.right>d.right+m&&(m=e.right-d.right+n)):e.right>d.right&&(m=e.right-d.right+n,t<0&&e.left<d.left+m&&(m=e.left-(d.left+n))):m=(r=="center"?e.left+(e.right-e.left)/2-(d.right-d.left)/2:r=="start"==l?e.left-n:e.right-(d.right-d.left)+n)-d.left,m||D)if(p)u.scrollBy(m,D);else{let x=0,k=0;if(D){let B=c.scrollTop;c.scrollTop+=D/f,k=(c.scrollTop-B)*f}if(m){let B=c.scrollLeft;c.scrollLeft+=m/g,x=(c.scrollLeft-B)*g}e={left:e.left-x,top:e.top-k,right:e.right-x,bottom:e.bottom-k},x&&Math.abs(x-m)<1&&(r="nearest"),k&&Math.abs(k-D)<1&&(s="nearest")}if(p)break;(e.top<d.top||e.bottom>d.bottom||e.left<d.left||e.right>d.right)&&(e={left:Math.max(e.left,d.left),right:Math.min(e.right,d.right),top:Math.max(e.top,d.top),bottom:Math.min(e.bottom,d.bottom)}),c=c.assignedSlot||c.parentNode}else if(c.nodeType==11)c=c.host;else break}function Lc(i){let e=i.ownerDocument,t,r;for(let s=i.parentNode;s&&!(s==e.body||t&&r);)if(s.nodeType==1)!r&&s.scrollHeight>s.clientHeight&&(r=s),!t&&s.scrollWidth>s.clientWidth&&(t=s),s=s.assignedSlot||s.parentNode;else if(s.nodeType==11)s=s.host;else break;return{x:t,y:r}}class Pc{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(e){return this.anchorNode==e.anchorNode&&this.anchorOffset==e.anchorOffset&&this.focusNode==e.focusNode&&this.focusOffset==e.focusOffset}setRange(e){let{anchorNode:t,focusNode:r}=e;this.set(t,Math.min(e.anchorOffset,t?yt(t):0),r,Math.min(e.focusOffset,r?yt(r):0))}set(e,t,r,s){this.anchorNode=e,this.anchorOffset=t,this.focusNode=r,this.focusOffset=s}}let Pt=null;N.safari&&N.safari_version>=26&&(Pt=!1);function Vl(i){if(i.setActive)return i.setActive();if(Pt)return i.focus(Pt);let e=[];for(let t=i;t&&(e.push(t,t.scrollTop,t.scrollLeft),t!=t.ownerDocument);t=t.parentNode);if(i.focus(Pt==null?{get preventScroll(){return Pt={preventScroll:!0},!0}}:void 0),!Pt){Pt=!1;for(let t=0;t<e.length;){let r=e[t++],s=e[t++],n=e[t++];r.scrollTop!=s&&(r.scrollTop=s),r.scrollLeft!=n&&(r.scrollLeft=n)}}}let Co;function Vi(i,e,t=e){let r=Co||(Co=document.createRange());return r.setEnd(i,t),r.setStart(i,e),r}function di(i,e,t,r){let s={key:e,code:e,keyCode:t,which:t,cancelable:!0};r&&({altKey:s.altKey,ctrlKey:s.ctrlKey,shiftKey:s.shiftKey,metaKey:s.metaKey}=r);let n=new KeyboardEvent("keydown",s);n.synthetic=!0,i.dispatchEvent(n);let o=new KeyboardEvent("keyup",s);return o.synthetic=!0,i.dispatchEvent(o),n.defaultPrevented||o.defaultPrevented}function jc(i){for(;i;){if(i&&(i.nodeType==9||i.nodeType==11&&i.host))return i;i=i.assignedSlot||i.parentNode}return null}function Nc(i,e){let t=e.focusNode,r=e.focusOffset;if(!t||e.anchorNode!=t||e.anchorOffset!=r)return!1;for(r=Math.min(r,yt(t));;)if(r){if(t.nodeType!=1)return!1;let s=t.childNodes[r-1];s.contentEditable=="false"?r--:(t=s,r=yt(t))}else{if(t==i)return!0;r=Et(t),t=t.parentNode}}function ql(i){return i.scrollTop>Math.max(1,i.scrollHeight-i.clientHeight-4)}function $l(i,e){for(let t=i,r=e;;){if(t.nodeType==3&&r>0)return{node:t,offset:r};if(t.nodeType==1&&r>0){if(t.contentEditable=="false")return null;t=t.childNodes[r-1],r=yt(t)}else if(t.parentNode&&!Ur(t))r=Et(t),t=t.parentNode;else return null}}function Kl(i,e){for(let t=i,r=e;;){if(t.nodeType==3&&r<t.nodeValue.length)return{node:t,offset:r};if(t.nodeType==1&&r<t.childNodes.length){if(t.contentEditable=="false")return null;t=t.childNodes[r],r=0}else if(t.parentNode&&!Ur(t))r=Et(t)+1,t=t.parentNode;else return null}}class Xe{constructor(e,t,r=!0){this.node=e,this.offset=t,this.precise=r}static before(e,t){return new Xe(e.parentNode,Et(e),t)}static after(e,t){return new Xe(e.parentNode,Et(e)+1,t)}}var ye=(function(i){return i[i.LTR=0]="LTR",i[i.RTL=1]="RTL",i})(ye||(ye={}));const _t=ye.LTR,zn=ye.RTL;function Ul(i){let e=[];for(let t=0;t<i.length;t++)e.push(1<<+i[t]);return e}const _c=Ul("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),Ic=Ul("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),dn=Object.create(null),it=[];for(let i of["()","[]","{}"]){let e=i.charCodeAt(0),t=i.charCodeAt(1);dn[e]=t,dn[t]=-e}function Ql(i){return i<=247?_c[i]:1424<=i&&i<=1524?2:1536<=i&&i<=1785?Ic[i-1536]:1774<=i&&i<=2220?4:8192<=i&&i<=8204?256:64336<=i&&i<=65023?4:1}const zc=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac\ufb50-\ufdff]/;class gt{get dir(){return this.level%2?zn:_t}constructor(e,t,r){this.from=e,this.to=t,this.level=r}side(e,t){return this.dir==t==e?this.to:this.from}forward(e,t){return e==(this.dir==t)}static find(e,t,r,s){let n=-1;for(let o=0;o<e.length;o++){let l=e[o];if(l.from<=t&&l.to>=t){if(l.level==r)return o;(n<0||(s!=0?s<0?l.from<t:l.to>t:e[n].level>l.level))&&(n=o)}}if(n<0)throw new RangeError("Index out of range");return n}}function Jl(i,e){if(i.length!=e.length)return!1;for(let t=0;t<i.length;t++){let r=i[t],s=e[t];if(r.from!=s.from||r.to!=s.to||r.direction!=s.direction||!Jl(r.inner,s.inner))return!1}return!0}const ue=[];function Wc(i,e,t,r,s){for(let n=0;n<=r.length;n++){let o=n?r[n-1].to:e,l=n<r.length?r[n].from:t,a=n?256:s;for(let u=o,c=a,h=a;u<l;u++){let d=Ql(i.charCodeAt(u));d==512?d=c:d==8&&h==4&&(d=16),ue[u]=d==4?2:d,d&7&&(h=d),c=d}for(let u=o,c=a,h=a;u<l;u++){let d=ue[u];if(d==128)u<l-1&&c==ue[u+1]&&c&24?d=ue[u]=c:ue[u]=256;else if(d==64){let p=u+1;for(;p<l&&ue[p]==64;)p++;let g=u&&c==8||p<t&&ue[p]==8?h==1?1:8:256;for(let f=u;f<p;f++)ue[f]=g;u=p-1}else d==8&&h==1&&(ue[u]=1);c=d,d&7&&(h=d)}}}function Hc(i,e,t,r,s){let n=s==1?2:1;for(let o=0,l=0,a=0;o<=r.length;o++){let u=o?r[o-1].to:e,c=o<r.length?r[o].from:t;for(let h=u,d,p,g;h<c;h++)if(p=dn[d=i.charCodeAt(h)])if(p<0){for(let f=l-3;f>=0;f-=3)if(it[f+1]==-p){let m=it[f+2],D=m&2?s:m&4?m&1?n:s:0;D&&(ue[h]=ue[it[f]]=D),l=f;break}}else{if(it.length==189)break;it[l++]=h,it[l++]=d,it[l++]=a}else if((g=ue[h])==2||g==1){let f=g==s;a=f?0:1;for(let m=l-3;m>=0;m-=3){let D=it[m+2];if(D&2)break;if(f)it[m+2]|=2;else{if(D&4)break;it[m+2]|=4}}}}}function Vc(i,e,t,r){for(let s=0,n=r;s<=t.length;s++){let o=s?t[s-1].to:i,l=s<t.length?t[s].from:e;for(let a=o;a<l;){let u=ue[a];if(u==256){let c=a+1;for(;;)if(c==l){if(s==t.length)break;c=t[s++].to,l=s<t.length?t[s].from:e}else if(ue[c]==256)c++;else break;let h=n==1,d=(c<e?ue[c]:r)==1,p=h==d?h?1:2:r;for(let g=c,f=s,m=f?t[f-1].to:i;g>a;)g==m&&(g=t[--f].from,m=f?t[f-1].to:i),ue[--g]=p;a=c}else n=u,a++}}}function fn(i,e,t,r,s,n,o){let l=r%2?2:1;if(r%2==s%2)for(let a=e,u=0;a<t;){let c=!0,h=!1;if(u==n.length||a<n[u].from){let f=ue[a];f!=l&&(c=!1,h=f==16)}let d=!c&&l==1?[]:null,p=c?r:r+1,g=a;e:for(;;)if(u<n.length&&g==n[u].from){if(h)break e;let f=n[u];if(!c)for(let m=f.to,D=u+1;;){if(m==t)break e;if(D<n.length&&n[D].from==m)m=n[D++].to;else{if(ue[m]==l)break e;break}}if(u++,d)d.push(f);else{f.from>a&&o.push(new gt(a,f.from,p));let m=f.direction==_t!=!(p%2);pn(i,m?r+1:r,s,f.inner,f.from,f.to,o),a=f.to}g=f.to}else{if(g==t||(c?ue[g]!=l:ue[g]==l))break;g++}d?fn(i,a,g,r+1,s,d,o):a<g&&o.push(new gt(a,g,p)),a=g}else for(let a=t,u=n.length;a>e;){let c=!0,h=!1;if(!u||a>n[u-1].to){let f=ue[a-1];f!=l&&(c=!1,h=f==16)}let d=!c&&l==1?[]:null,p=c?r:r+1,g=a;e:for(;;)if(u&&g==n[u-1].to){if(h)break e;let f=n[--u];if(!c)for(let m=f.from,D=u;;){if(m==e)break e;if(D&&n[D-1].to==m)m=n[--D].from;else{if(ue[m-1]==l)break e;break}}if(d)d.push(f);else{f.to<a&&o.push(new gt(f.to,a,p));let m=f.direction==_t!=!(p%2);pn(i,m?r+1:r,s,f.inner,f.from,f.to,o),a=f.from}g=f.from}else{if(g==e||(c?ue[g-1]!=l:ue[g-1]==l))break;g--}d?fn(i,g,a,r+1,s,d,o):g<a&&o.push(new gt(g,a,p)),a=g}}function pn(i,e,t,r,s,n,o){let l=e%2?2:1;Wc(i,s,n,r,l),Hc(i,s,n,r,l),Vc(s,n,r,l),fn(i,s,n,e,t,r,o)}function qc(i,e,t){if(!i)return[new gt(0,0,e==zn?1:0)];if(e==_t&&!t.length&&!zc.test(i))return Yl(i.length);if(t.length)for(;i.length>ue.length;)ue[ue.length]=256;let r=[],s=e==_t?0:1;return pn(i,s,s,t,0,i.length,r),r}function Yl(i){return[new gt(0,i,0)]}let Gl="";function $c(i,e,t,r,s){var n;let o=r.head-i.from,l=gt.find(e,o,(n=r.bidiLevel)!==null&&n!==void 0?n:-1,r.assoc),a=e[l],u=a.side(s,t);if(o==u){let d=l+=s?1:-1;if(d<0||d>=e.length)return null;a=e[l=d],o=a.side(!s,t),u=a.side(s,t)}let c=vt(i.text,o,a.forward(s,t));(c<a.from||c>a.to)&&(c=u),Gl=i.text.slice(Math.min(o,c),Math.max(o,c));let h=l==(s?e.length-1:0)?null:e[l+(s?1:-1)];return h&&c==u&&h.level+(s?0:1)<a.level?X.cursor(h.side(!s,t)+i.from,h.forward(s,t)?1:-1,h.level):X.cursor(c+i.from,a.forward(s,t)?-1:1,a.level)}function Kc(i,e,t){for(let r=e;r<t;r++){let s=Ql(i.charCodeAt(r));if(s==1)return _t;if(s==2||s==4)return zn}return _t}const Xl=re.define(),Zl=re.define(),ea=re.define(),ta=re.define(),gn=re.define(),ia=re.define(),ra=re.define(),Wn=re.define(),Hn=re.define(),sa=re.define({combine:i=>i.some(e=>e)}),na=re.define({combine:i=>i.some(e=>e)}),oa=re.define();class fi{constructor(e,t="nearest",r="nearest",s=5,n=5,o=!1){this.range=e,this.y=t,this.x=r,this.yMargin=s,this.xMargin=n,this.isSnapshot=o}map(e){return e.empty?this:new fi(this.range.map(e),this.y,this.x,this.yMargin,this.xMargin,this.isSnapshot)}clip(e){return this.range.to<=e.doc.length?this:new fi(X.cursor(e.doc.length),this.y,this.x,this.yMargin,this.xMargin,this.isSnapshot)}}const Br=$i.define({map:(i,e)=>i.map(e)}),la=$i.define();function mt(i,e,t){let r=i.facet(ta);r.length?r[0](e):window.onerror&&window.onerror(String(e),t,void 0,void 0,e)||(t?console.error(t+":",e):console.error(e))}const dt=re.define({combine:i=>i.length?i[0]:!0});let Uc=0;const ui=re.define({combine(i){return i.filter((e,t)=>{for(let r=0;r<t;r++)if(i[r].plugin==e.plugin)return!1;return!0})}});class He{constructor(e,t,r,s,n){this.id=e,this.create=t,this.domEventHandlers=r,this.domEventObservers=s,this.baseExtensions=n(this),this.extension=this.baseExtensions.concat(ui.of({plugin:this,arg:void 0}))}of(e){return this.baseExtensions.concat(ui.of({plugin:this,arg:e}))}static define(e,t){const{eventHandlers:r,eventObservers:s,provide:n,decorations:o}=t||{};return new He(Uc++,e,r,s,l=>{let a=[];return o&&a.push(ss.of(u=>{let c=u.plugin(l);return c?o(c):ge.none})),n&&a.push(n(l)),a})}static fromClass(e,t){return He.define((r,s)=>new e(r,s),t)}}class _s{constructor(e){this.spec=e,this.mustUpdate=null,this.value=null}get plugin(){return this.spec&&this.spec.plugin}update(e){if(this.value){if(this.mustUpdate){let t=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(t)}catch(r){if(mt(t.state,r,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch{}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.plugin.create(e,this.spec.arg)}catch(t){mt(e.state,t,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(e){var t;if(!((t=this.value)===null||t===void 0)&&t.destroy)try{this.value.destroy()}catch(r){mt(e.state,r,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const aa=re.define(),Vn=re.define(),ss=re.define(),ua=re.define(),qn=re.define(),Qi=re.define(),ca=re.define();function yo(i,e){let t=i.state.facet(ca);if(!t.length)return t;let r=t.map(n=>n instanceof Function?n(i):n),s=[];return Se.spans(r,e.from,e.to,{point(){},span(n,o,l,a){let u=n-e.from,c=o-e.from,h=s;for(let d=l.length-1;d>=0;d--,a--){let p=l[d].spec.bidiIsolate,g;if(p==null&&(p=Kc(e.text,u,c)),a>0&&h.length&&(g=h[h.length-1]).to==u&&g.direction==p)g.to=c,h=g.inner;else{let f={from:u,to:c,direction:p,inner:[]};h.push(f),h=f.inner}}}}),s}const ha=re.define();function da(i){let e=0,t=0,r=0,s=0;for(let n of i.state.facet(ha)){let o=n(i);o&&(o.left!=null&&(e=Math.max(e,o.left)),o.right!=null&&(t=Math.max(t,o.right)),o.top!=null&&(r=Math.max(r,o.top)),o.bottom!=null&&(s=Math.max(s,o.bottom)))}return{left:e,right:t,top:r,bottom:s}}const Bi=re.define();class We{constructor(e,t,r,s){this.fromA=e,this.toA=t,this.fromB=r,this.toB=s}join(e){return new We(Math.min(this.fromA,e.fromA),Math.max(this.toA,e.toA),Math.min(this.fromB,e.fromB),Math.max(this.toB,e.toB))}addToSet(e){let t=e.length,r=this;for(;t>0;t--){let s=e[t-1];if(!(s.fromA>r.toA)){if(s.toA<r.fromA)break;r=r.join(s),e.splice(t-1,1)}}return e.splice(t,0,r),e}static extendWithRanges(e,t){if(t.length==0)return e;let r=[];for(let s=0,n=0,o=0;;){let l=s<e.length?e[s].fromB:1e9,a=n<t.length?t[n]:1e9,u=Math.min(l,a);if(u==1e9)break;let c=u+o,h=u,d=c;for(;;)if(n<t.length&&t[n]<=h){let p=t[n+1];n+=2,h=Math.max(h,p);for(let g=s;g<e.length&&e[g].fromB<=h;g++)o=e[g].toA-e[g].toB;d=Math.max(d,p+o)}else if(s<e.length&&e[s].fromB<=h){let p=e[s++];h=Math.max(h,p.toB),d=Math.max(d,p.toA),o=p.toA-p.toB}else break;r.push(new We(c,d,u,h))}return r}}class Qr{constructor(e,t,r){this.view=e,this.state=t,this.transactions=r,this.flags=0,this.startState=e.state,this.changes=Fl.empty(this.startState.doc.length);for(let n of r)this.changes=this.changes.compose(n.changes);let s=[];this.changes.iterChangedRanges((n,o,l,a)=>s.push(new We(n,o,l,a))),this.changedRanges=s}static create(e,t,r){return new Qr(e,t,r)}get viewportChanged(){return(this.flags&4)>0}get viewportMoved(){return(this.flags&8)>0}get heightChanged(){return(this.flags&2)>0}get geometryChanged(){return this.docChanged||(this.flags&18)>0}get focusChanged(){return(this.flags&1)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some(e=>e.selection)}get empty(){return this.flags==0&&this.transactions.length==0}}const Qc=[];class Ae{constructor(e,t,r=0){this.dom=e,this.length=t,this.flags=r,this.parent=null,e.cmTile=this}get breakAfter(){return this.flags&1}get children(){return Qc}isWidget(){return!1}get isHidden(){return!1}isComposite(){return!1}isLine(){return!1}isText(){return!1}isBlock(){return!1}get domAttrs(){return null}sync(e){if(this.flags|=2,this.flags&4){this.flags&=-5;let t=this.domAttrs;t&&kc(this.dom,t)}}toString(){return this.constructor.name+(this.children.length?`(${this.children})`:"")+(this.breakAfter?"#":"")}destroy(){this.parent=null}setDOM(e){this.dom=e,e.cmTile=this}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(e,t=this.posAtStart){let r=t;for(let s of this.children){if(s==e)return r;r+=s.length+s.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(e){return this.posBefore(e)+e.length}covers(e){return!0}coordsIn(e,t){return null}domPosFor(e,t){let r=Et(this.dom),s=this.length?e>0:t>0;return new Xe(this.parent.dom,r+(s?1:0),e==0||e==this.length)}markDirty(e){this.flags&=-3,e&&(this.flags|=4),this.parent&&this.parent.flags&2&&this.parent.markDirty(!1)}get overrideDOMText(){return null}get root(){for(let e=this;e;e=e.parent)if(e instanceof os)return e;return null}static get(e){return e.cmTile}}class ns extends Ae{constructor(e){super(e,0),this._children=[]}isComposite(){return!0}get children(){return this._children}get lastChild(){return this.children.length?this.children[this.children.length-1]:null}append(e){this.children.push(e),e.parent=this}sync(e){if(this.flags&2)return;super.sync(e);let t=this.dom,r=null,s,n=e?.node==t?e:null,o=0;for(let l of this.children){if(l.sync(e),o+=l.length+l.breakAfter,s=r?r.nextSibling:t.firstChild,n&&s!=l.dom&&(n.written=!0),l.dom.parentNode==t)for(;s&&s!=l.dom;)s=bo(s);else t.insertBefore(l.dom,s);r=l.dom}for(s=r?r.nextSibling:t.firstChild,n&&s&&(n.written=!0);s;)s=bo(s);this.length=o}}function bo(i){let e=i.nextSibling;return i.parentNode.removeChild(i),e}class os extends ns{constructor(e,t){super(t),this.view=e}owns(e){for(;e;e=e.parent)if(e==this)return!0;return!1}isBlock(){return!0}nearest(e){for(;;){if(!e)return null;let t=Ae.get(e);if(t&&this.owns(t))return t;e=e.parentNode}}blockTiles(e){for(let t=[],r=this,s=0,n=0;;)if(s==r.children.length){if(!t.length)return;r=r.parent,r.breakAfter&&n++,s=t.pop()}else{let o=r.children[s++];if(o instanceof wt)t.push(s),r=o,s=0;else{let l=n+o.length,a=e(o,n);if(a!==void 0)return a;n=l+o.breakAfter}}}resolveBlock(e,t){let r,s=-1,n,o=-1;if(this.blockTiles((l,a)=>{let u=a+l.length;if(e>=a&&e<=u){if(l.isWidget()&&t>=-1&&t<=1){if(l.flags&32)return!0;l.flags&16&&(r=void 0)}(a<e||e==u&&(t<-1?l.length:l.covers(1)))&&(!r||!l.isWidget()&&r.isWidget())&&(r=l,s=e-a),(u>e||e==a&&(t>1?l.length:l.covers(-1)))&&(!n||!l.isWidget()&&n.isWidget())&&(n=l,o=e-a)}}),!r&&!n)throw new Error("No tile at position "+e);return r&&t<0||!n?{tile:r,offset:s}:{tile:n,offset:o}}}class wt extends ns{constructor(e,t){super(e),this.wrapper=t}isBlock(){return!0}covers(e){return this.children.length?e<0?this.children[0].covers(-1):this.lastChild.covers(1):!1}get domAttrs(){return this.wrapper.attributes}static of(e,t){let r=new wt(t||document.createElement(e.tagName),e);return t||(r.flags|=4),r}}class mi extends ns{constructor(e,t){super(e),this.attrs=t}isLine(){return!0}static start(e,t,r){let s=new mi(t||document.createElement("div"),e);return(!t||!r)&&(s.flags|=4),s}get domAttrs(){return this.attrs}resolveInline(e,t,r){let s=null,n=-1,o=null,l=-1;function a(c,h){for(let d=0,p=0;d<c.children.length&&p<=h;d++){let g=c.children[d],f=p+g.length;f>=h&&(g.isComposite()?a(g,h-p):(!o||o.isHidden&&(t>0||r&&Yc(o,g)))&&(f>h||g.flags&32)?(o=g,l=h-p):(p<h||g.flags&16&&!g.isHidden)&&(s=g,n=h-p)),p=f}}a(this,e);let u=(t<0?s:o)||s||o;return u?{tile:u,offset:u==s?n:l}:null}coordsIn(e,t){let r=this.resolveInline(e,t,!0);return r?r.tile.coordsIn(Math.max(0,r.offset),t):Jc(this)}domIn(e,t){let r=this.resolveInline(e,t);if(r){let{tile:s,offset:n}=r;if(this.dom.contains(s.dom))return s.isText()?new Xe(s.dom,Math.min(s.dom.nodeValue.length,n)):s.domPosFor(n,s.flags&16?1:s.flags&32?-1:t);let o=r.tile.parent,l=!1;for(let a of o.children){if(l)return new Xe(a.dom,0);a==r.tile&&(l=!0)}}return new Xe(this.dom,0)}}function Jc(i){let e=i.dom.lastChild;if(!e)return i.dom.getBoundingClientRect();let t=Pi(e);return t[t.length-1]||null}function Yc(i,e){let t=i.coordsIn(0,1),r=e.coordsIn(0,1);return t&&r&&r.top<t.bottom}class Le extends ns{constructor(e,t){super(e),this.mark=t}get domAttrs(){return this.mark.attrs}static of(e,t){let r=new Le(t||document.createElement(e.tagName),e);return t||(r.flags|=4),r}}class jt extends Ae{constructor(e,t){super(e,t.length),this.text=t}sync(e){this.flags&2||(super.sync(e),this.dom.nodeValue!=this.text&&(e&&e.node==this.dom&&(e.written=!0),this.dom.nodeValue=this.text))}isText(){return!0}toString(){return JSON.stringify(this.text)}coordsIn(e,t){let r=this.dom.nodeValue.length;e>r&&(e=r);let s=e,n=e,o=0;e==0&&t<0||e==r&&t>=0?N.chrome||N.gecko||(e?(s--,o=1):n<r&&(n++,o=-1)):t<0?s--:n<r&&n++;let l=Vi(this.dom,s,n).getClientRects();if(!l.length)return null;let a=l[(o?o<0:t>=0)?0:l.length-1];return N.safari&&!o&&a.width==0&&(a=Array.prototype.find.call(l,u=>u.width)||a),o?Hi(a,o<0):a||null}static of(e,t){let r=new jt(t||document.createTextNode(e),e);return t||(r.flags|=2),r}}class It extends Ae{constructor(e,t,r,s){super(e,t,s),this.widget=r}isWidget(){return!0}get isHidden(){return this.widget.isHidden}covers(e){return this.flags&48?!1:(this.flags&(e<0?64:128))>0}coordsIn(e,t){return this.coordsInWidget(e,t,!1)}coordsInWidget(e,t,r){let s=this.widget.coordsAt(this.dom,e,t);if(s)return s;if(r)return Hi(this.dom.getBoundingClientRect(),this.length?e==0:t<=0);{let n=this.dom.getClientRects(),o=null;if(!n.length)return null;let l=this.flags&16?!0:this.flags&32?!1:e>0;for(let a=l?n.length-1:0;o=n[a],!(e>0?a==0:a==n.length-1||o.top<o.bottom);a+=l?-1:1);return Hi(o,!l)}}get overrideDOMText(){if(!this.length)return Ze.empty;let{root:e}=this;if(!e)return Ze.empty;let t=this.posAtStart;return e.view.state.doc.slice(t,t+this.length)}destroy(){super.destroy(),this.widget.destroy(this.dom)}static of(e,t,r,s,n){return n||(n=e.toDOM(t),e.editable||(n.contentEditable="false")),new It(n,r,e,s)}}class Jr extends Ae{constructor(e){let t=document.createElement("img");t.className="cm-widgetBuffer",t.setAttribute("aria-hidden","true"),super(t,0,e)}get isHidden(){return!0}get overrideDOMText(){return Ze.empty}coordsIn(e){return this.dom.getBoundingClientRect()}}class Gc{constructor(e){this.index=0,this.beforeBreak=!1,this.parents=[],this.tile=e}advance(e,t,r){let{tile:s,index:n,beforeBreak:o,parents:l}=this;for(;e||t>0;)if(s.isComposite())if(o){if(!e)break;r&&r.break(),e--,o=!1}else if(n==s.children.length){if(!e&&!l.length)break;r&&r.leave(s),o=!!s.breakAfter,{tile:s,index:n}=l.pop(),n++}else{let a=s.children[n],u=a.breakAfter;(t>0?a.length<=e:a.length<e)&&(!r||r.skip(a,0,a.length)!==!1||!a.isComposite)?(o=!!u,n++,e-=a.length):(l.push({tile:s,index:n}),s=a,n=0,r&&a.isComposite()&&r.enter(a))}else if(n==s.length)o=!!s.breakAfter,{tile:s,index:n}=l.pop(),n++;else if(e){let a=Math.min(e,s.length-n);r&&r.skip(s,n,n+a),e-=a,n+=a}else break;return this.tile=s,this.index=n,this.beforeBreak=o,this}get root(){return this.parents.length?this.parents[0].tile:this.tile}}class Xc{constructor(e,t,r,s){this.from=e,this.to=t,this.wrapper=r,this.rank=s}}class Zc{constructor(e,t,r){this.cache=e,this.root=t,this.blockWrappers=r,this.curLine=null,this.lastBlock=null,this.afterWidget=null,this.pos=0,this.wrappers=[],this.wrapperPos=0}addText(e,t,r,s){var n;this.flushBuffer();let o=this.ensureMarks(t,r),l=o.lastChild;if(l&&l.isText()&&!(l.flags&8)){this.cache.reused.set(l,2);let a=o.children[o.children.length-1]=new jt(l.dom,l.text+e);a.parent=o}else o.append(s||jt.of(e,(n=this.cache.find(jt))===null||n===void 0?void 0:n.dom));this.pos+=e.length,this.afterWidget=null}addComposition(e,t){let r=this.curLine;r.dom!=t.line.dom&&(r.setDOM(this.cache.reused.has(t.line)?Is(t.line.dom):t.line.dom),this.cache.reused.set(t.line,2));let s=r;for(let l=t.marks.length-1;l>=0;l--){let a=t.marks[l],u=s.lastChild;if(u instanceof Le&&u.mark.eq(a.mark))u.dom!=a.dom&&u.setDOM(Is(a.dom)),s=u;else{if(this.cache.reused.get(a)){let h=Ae.get(a.dom);h&&h.setDOM(Is(a.dom))}let c=Le.of(a.mark,a.dom);s.append(c),s=c}this.cache.reused.set(a,2)}let n=Ae.get(e.text);n&&this.cache.reused.set(n,2);let o=new jt(e.text,e.text.nodeValue);o.flags|=8,s.append(o)}addInlineWidget(e,t,r){let s=this.afterWidget&&e.flags&48&&(this.afterWidget.flags&48)==(e.flags&48);s||this.flushBuffer();let n=this.ensureMarks(t,r);!s&&!(e.flags&16)&&n.append(this.getBuffer(1)),n.append(e),this.pos+=e.length,this.afterWidget=e}addMark(e,t,r){this.flushBuffer(),this.ensureMarks(t,r).append(e),this.pos+=e.length,this.afterWidget=null}addBlockWidget(e){this.getBlockPos().append(e),this.pos+=e.length,this.lastBlock=e,this.endLine()}continueWidget(e){let t=this.afterWidget||this.lastBlock;t.length+=e,this.pos+=e}addLineStart(e,t){var r;e||(e=fa);let s=mi.start(e,t||((r=this.cache.find(mi))===null||r===void 0?void 0:r.dom),!!t);this.getBlockPos().append(this.lastBlock=this.curLine=s)}addLine(e){this.getBlockPos().append(e),this.pos+=e.length,this.lastBlock=e,this.endLine()}addBreak(){this.lastBlock.flags|=1,this.endLine(),this.pos++}addLineStartIfNotCovered(e){this.blockPosCovered()||this.addLineStart(e)}ensureLine(e){this.curLine||this.addLineStart(e)}ensureMarks(e,t){var r;let s=this.curLine;for(let n=e.length-1;n>=0;n--){let o=e[n],l;if(t>0&&(l=s.lastChild)&&l instanceof Le&&l.mark.eq(o))s=l,t--;else{let a=Le.of(o,(r=this.cache.find(Le,u=>u.mark.eq(o)))===null||r===void 0?void 0:r.dom);s.append(a),s=a,t=0}}return s}endLine(){if(this.curLine){this.flushBuffer();let e=this.curLine.lastChild;(!e||!Ao(this.curLine,!1)||e.dom.nodeName!="BR"&&e.isWidget()&&!(N.ios&&Ao(this.curLine,!0)))&&this.curLine.append(this.cache.findWidget(zs,0,32)||new It(zs.toDOM(),0,zs,32)),this.curLine=this.afterWidget=null}}updateBlockWrappers(){this.wrapperPos>this.pos+1e4&&(this.blockWrappers.goto(this.pos),this.wrappers.length=0);for(let e=this.wrappers.length-1;e>=0;e--)this.wrappers[e].to<this.pos&&this.wrappers.splice(e,1);for(let e=this.blockWrappers;e.value&&e.from<=this.pos;e.next())if(e.to>=this.pos){let t=new Xc(e.from,e.to,e.value,e.rank),r=this.wrappers.length;for(;r>0&&(this.wrappers[r-1].rank-t.rank||this.wrappers[r-1].to-t.to)<0;)r--;this.wrappers.splice(r,0,t)}this.wrapperPos=this.pos}getBlockPos(){var e;this.updateBlockWrappers();let t=this.root;for(let r of this.wrappers){let s=t.lastChild;if(r.from<this.pos&&s instanceof wt&&s.wrapper.eq(r.wrapper))t=s;else{let n=wt.of(r.wrapper,(e=this.cache.find(wt,o=>o.wrapper.eq(r.wrapper)))===null||e===void 0?void 0:e.dom);t.append(n),t=n}}return t}blockPosCovered(){let e=this.lastBlock;return e!=null&&!e.breakAfter&&(!e.isWidget()||(e.flags&160)>0)}getBuffer(e){let t=2|(e<0?16:32),r=this.cache.find(Jr,void 0,1);return r&&(r.flags=t),r||new Jr(t)}flushBuffer(){this.afterWidget&&!(this.afterWidget.flags&32)&&(this.afterWidget.parent.append(this.getBuffer(-1)),this.afterWidget=null)}}class eh{constructor(e){this.skipCount=0,this.text="",this.textOff=0,this.cursor=e.iter()}skip(e){this.textOff+e<=this.text.length?this.textOff+=e:(this.skipCount+=e-(this.text.length-this.textOff),this.text="",this.textOff=0)}next(e){if(this.textOff==this.text.length){let{value:s,lineBreak:n,done:o}=this.cursor.next(this.skipCount);if(this.skipCount=0,o)throw new Error("Ran out of text content when drawing inline views");this.text=s;let l=this.textOff=Math.min(e,s.length);return n?null:s.slice(0,l)}let t=Math.min(this.text.length,this.textOff+e),r=this.text.slice(this.textOff,t);return this.textOff=t,r}}const Yr=[It,mi,jt,Le,Jr,wt,os];for(let i=0;i<Yr.length;i++)Yr[i].bucket=i;class th{constructor(e){this.view=e,this.buckets=Yr.map(()=>[]),this.index=Yr.map(()=>0),this.reused=new Map}add(e){let t=e.constructor.bucket,r=this.buckets[t];r.length<6?r.push(e):r[this.index[t]=(this.index[t]+1)%6]=e}find(e,t,r=2){let s=e.bucket,n=this.buckets[s],o=this.index[s];for(let l=n.length-1;l>=0;l--){let a=(l+o)%n.length,u=n[a];if((!t||t(u))&&!this.reused.has(u))return n.splice(a,1),a<o&&this.index[s]--,this.reused.set(u,r),u}return null}findWidget(e,t,r){let s=this.buckets[0];if(s.length)for(let n=0,o=0;;n++){if(n==s.length){if(o)return null;o=1,n=0}let l=s[n];if(!this.reused.has(l)&&(o==0?l.widget.compare(e):l.widget.constructor==e.constructor&&e.updateDOM(l.dom,this.view)))return s.splice(n,1),n<this.index[0]&&this.index[0]--,l.widget==e&&l.length==t&&(l.flags&497)==r?(this.reused.set(l,1),l):(this.reused.set(l,2),new It(l.dom,t,e,l.flags&-498|r))}}reuse(e){return this.reused.set(e,1),e}maybeReuse(e,t=2){if(!this.reused.has(e))return this.reused.set(e,t),e.dom}clear(){for(let e=0;e<this.buckets.length;e++)this.buckets[e].length=this.index[e]=0}}class ih{constructor(e,t,r,s,n){this.view=e,this.decorations=s,this.disallowBlockEffectsFor=n,this.openWidget=!1,this.openMarks=0,this.cache=new th(e),this.text=new eh(e.state.doc),this.builder=new Zc(this.cache,new os(e,e.contentDOM),Se.iter(r)),this.cache.reused.set(t,2),this.old=new Gc(t),this.reuseWalker={skip:(o,l,a)=>{if(this.cache.add(o),o.isComposite())return!1},enter:o=>this.cache.add(o),leave:()=>{},break:()=>{}}}run(e,t){let r=t&&this.getCompositionContext(t.text);for(let s=0,n=0,o=0;;){let l=o<e.length?e[o++]:null,a=l?l.fromA:this.old.root.length;if(a>s){let u=a-s;this.preserve(u,!o,!l),s=a,n+=u}if(!l)break;t&&l.fromA<=t.range.fromA&&l.toA>=t.range.toA?(this.forward(l.fromA,t.range.fromA,t.range.fromA<t.range.toA?1:-1),this.emit(n,t.range.fromB),this.cache.clear(),this.builder.addComposition(t,r),this.text.skip(t.range.toB-t.range.fromB),this.forward(t.range.fromA,l.toA),this.emit(t.range.toB,l.toB)):(this.forward(l.fromA,l.toA),this.emit(n,l.toB)),n=l.toB,s=l.toA}return this.builder.curLine&&this.builder.endLine(),this.builder.root}preserve(e,t,r){let s=nh(this.old),n=this.openMarks;this.old.advance(e,r?1:-1,{skip:(o,l,a)=>{if(o.isWidget())if(this.openWidget)this.builder.continueWidget(a-l);else{let u=a>0||l<o.length?It.of(o.widget,this.view,a-l,o.flags&496,this.cache.maybeReuse(o)):this.cache.reuse(o);u.flags&256?(u.flags&=-2,this.builder.addBlockWidget(u)):(this.builder.ensureLine(null),this.builder.addInlineWidget(u,s,n),n=s.length)}else if(o.isText())this.builder.ensureLine(null),!l&&a==o.length?this.builder.addText(o.text,s,n,this.cache.reuse(o)):(this.cache.add(o),this.builder.addText(o.text.slice(l,a),s,n)),n=s.length;else if(o.isLine())o.flags&=-2,this.cache.reused.set(o,1),this.builder.addLine(o);else if(o instanceof Jr)this.cache.add(o);else if(o instanceof Le)this.builder.ensureLine(null),this.builder.addMark(o,s,n),this.cache.reused.set(o,1),n=s.length;else return!1;this.openWidget=!1},enter:o=>{o.isLine()?this.builder.addLineStart(o.attrs,this.cache.maybeReuse(o)):(this.cache.add(o),o instanceof Le&&s.unshift(o.mark)),this.openWidget=!1},leave:o=>{o.isLine()?s.length&&(s.length=n=0):o instanceof Le&&(s.shift(),n=Math.min(n,s.length))},break:()=>{this.builder.addBreak(),this.openWidget=!1}}),this.text.skip(e)}emit(e,t){let r=null,s=this.builder,n=0,o=Se.spans(this.decorations,e,t,{point:(l,a,u,c,h,d)=>{if(u instanceof Nt){if(this.disallowBlockEffectsFor[d]){if(u.block)throw new RangeError("Block decorations may not be specified via plugins");if(a>this.view.state.doc.lineAt(l).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}if(n=c.length,h>c.length)s.continueWidget(a-l);else{let p=u.widget||(u.block?Di.block:Di.inline),g=rh(u),f=this.cache.findWidget(p,a-l,g)||It.of(p,this.view,a-l,g);u.block?(u.startSide>0&&s.addLineStartIfNotCovered(r),s.addBlockWidget(f)):(s.ensureLine(r),s.addInlineWidget(f,c,h))}r=null}else r=sh(r,u);a>l&&this.text.skip(a-l)},span:(l,a,u,c)=>{for(let h=l;h<a;){let d=this.text.next(Math.min(512,a-h));d==null?(s.addLineStartIfNotCovered(r),s.addBreak(),h++):(s.ensureLine(r),s.addText(d,u,c),h+=d.length),r=null}}});s.addLineStartIfNotCovered(r),this.openWidget=o>n,this.openMarks=o}forward(e,t,r=1){t-e<=10?this.old.advance(t-e,r,this.reuseWalker):(this.old.advance(5,-1,this.reuseWalker),this.old.advance(t-e-10,-1),this.old.advance(5,r,this.reuseWalker))}getCompositionContext(e){let t=[],r=null;for(let s=e.parentNode;;s=s.parentNode){let n=Ae.get(s);if(s==this.view.contentDOM)break;n instanceof Le?t.push(n):n?.isLine()?r=n:s.nodeName=="DIV"&&!r&&s!=this.view.contentDOM?r=new mi(s,fa):t.push(Le.of(new Ki({tagName:s.nodeName.toLowerCase(),attributes:Mc(s)}),s))}return{line:r,marks:t}}}function Ao(i,e){let t=r=>{for(let s of r.children)if((e?s.isText():s.length)||t(s))return!0;return!1};return t(i)}function rh(i){let e=i.isReplace?(i.startSide<0?64:0)|(i.endSide>0?128:0):i.startSide>0?32:16;return i.block&&(e|=256),e}const fa={class:"cm-line"};function sh(i,e){let t=e.spec.attributes,r=e.spec.class;return!t&&!r||(i||(i={class:"cm-line"}),t&&_n(t,i),r&&(i.class+=" "+r)),i}function nh(i){let e=[];for(let t=i.parents.length;t>1;t--){let r=t==i.parents.length?i.tile:i.parents[t].tile;r instanceof Le&&e.push(r.mark)}return e}function Is(i){let e=Ae.get(i);return e&&e.setDOM(i.cloneNode()),i}class Di extends zt{constructor(e){super(),this.tag=e}eq(e){return e.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(e){return e.nodeName.toLowerCase()==this.tag}get isHidden(){return!0}}Di.inline=new Di("span");Di.block=new Di("div");const zs=new class extends zt{toDOM(){return document.createElement("br")}get isHidden(){return!0}get editable(){return!0}};class xo{constructor(e){this.view=e,this.decorations=[],this.blockWrappers=[],this.dynamicDecorationMap=[!1],this.domChanged=null,this.hasComposition=null,this.editContextFormatting=ge.none,this.lastCompositionAfterCursor=!1,this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.updateDeco(),this.tile=new os(e,e.contentDOM),this.updateInner([new We(0,0,0,e.state.doc.length)],null)}update(e){var t;let r=e.changedRanges;this.minWidth>0&&r.length&&(r.every(({fromA:c,toA:h})=>h<this.minWidthFrom||c>this.minWidthTo)?(this.minWidthFrom=e.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=e.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.updateEditContextFormatting(e);let s=-1;this.view.inputState.composing>=0&&!this.view.observer.editContext&&(!((t=this.domChanged)===null||t===void 0)&&t.newSel?s=this.domChanged.newSel.head:!ph(e.changes,this.hasComposition)&&!e.selectionSet&&(s=e.state.selection.main.head));let n=s>-1?lh(this.view,e.changes,s):null;if(this.domChanged=null,this.hasComposition){let{from:c,to:h}=this.hasComposition;r=new We(c,h,e.changes.mapPos(c,-1),e.changes.mapPos(h,1)).addToSet(r.slice())}this.hasComposition=n?{from:n.range.fromB,to:n.range.toB}:null,(N.ie||N.chrome)&&!n&&e&&e.state.doc.lines!=e.startState.doc.lines&&(this.forceSelection=!0);let o=this.decorations,l=this.blockWrappers;this.updateDeco();let a=ch(o,this.decorations,e.changes);a.length&&(r=We.extendWithRanges(r,a));let u=dh(l,this.blockWrappers,e.changes);return u.length&&(r=We.extendWithRanges(r,u)),n&&!r.some(c=>c.fromA<=n.range.fromA&&c.toA>=n.range.toA)&&(r=n.range.addToSet(r.slice())),this.tile.flags&2&&r.length==0?!1:(this.updateInner(r,n),e.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(e,t){this.view.viewState.mustMeasureContent=!0;let{observer:r}=this.view;r.ignore(()=>{if(t||e.length){let o=this.tile,l=new ih(this.view,o,this.blockWrappers,this.decorations,this.dynamicDecorationMap);this.tile=l.run(e,t),mn(o,l.cache.reused)}this.tile.dom.style.height=this.view.viewState.contentHeight/this.view.scaleY+"px",this.tile.dom.style.flexBasis=this.minWidth?this.minWidth+"px":"";let n=N.chrome||N.ios?{node:r.selectionRange.focusNode,written:!1}:void 0;this.tile.sync(n),n&&(n.written||r.selectionRange.focusNode!=n.node||!this.tile.dom.contains(n.node))&&(this.forceSelection=!0),this.tile.dom.style.height=""});let s=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let n of this.tile.children)n.isWidget()&&n.widget instanceof Ws&&s.push(n.dom);r.updateGaps(s)}updateEditContextFormatting(e){this.editContextFormatting=this.editContextFormatting.map(e.changes);for(let t of e.transactions)for(let r of t.effects)r.is(la)&&(this.editContextFormatting=r.value)}updateSelection(e=!1,t=!1){(e||!this.view.observer.selectionRange.focusNode)&&this.view.observer.readSelectionRange();let{dom:r}=this.tile,s=this.view.root.activeElement,n=s==r,o=!n&&!(this.view.state.facet(dt)||r.tabIndex>-1)&&Li(r,this.view.observer.selectionRange)&&!(s&&r.contains(s));if(!(n||t||o))return;let l=this.forceSelection;this.forceSelection=!1;let a=this.view.state.selection.main,u,c;if(a.empty?c=u=this.inlineDOMNearPos(a.anchor,a.assoc||1):(c=this.inlineDOMNearPos(a.head,a.head==a.from?1:-1),u=this.inlineDOMNearPos(a.anchor,a.anchor==a.from?1:-1)),N.gecko&&a.empty&&!this.hasComposition&&oh(u)){let d=document.createTextNode("");this.view.observer.ignore(()=>u.node.insertBefore(d,u.node.childNodes[u.offset]||null)),u=c=new Xe(d,0),l=!0}let h=this.view.observer.selectionRange;(l||!h.focusNode||(!ji(u.node,u.offset,h.anchorNode,h.anchorOffset)||!ji(c.node,c.offset,h.focusNode,h.focusOffset))&&!this.suppressWidgetCursorChange(h,a))&&(this.view.observer.ignore(()=>{N.android&&N.chrome&&r.contains(h.focusNode)&&fh(h.focusNode,r)&&(r.blur(),r.focus({preventScroll:!0}));let d=gi(this.view.root);if(d)if(a.empty){if(N.gecko){let p=ah(u.node,u.offset);if(p&&p!=3){let g=(p==1?$l:Kl)(u.node,u.offset);g&&(u=new Xe(g.node,g.offset))}}d.collapse(u.node,u.offset),a.bidiLevel!=null&&d.caretBidiLevel!==void 0&&(d.caretBidiLevel=a.bidiLevel)}else if(d.extend){d.collapse(u.node,u.offset);try{d.extend(c.node,c.offset)}catch{}}else{let p=document.createRange();a.anchor>a.head&&([u,c]=[c,u]),p.setEnd(c.node,c.offset),p.setStart(u.node,u.offset),d.removeAllRanges(),d.addRange(p)}o&&this.view.root.activeElement==r&&(r.blur(),s&&s.focus())}),this.view.observer.setSelectionRange(u,c)),this.impreciseAnchor=u.precise?null:new Xe(h.anchorNode,h.anchorOffset),this.impreciseHead=c.precise?null:new Xe(h.focusNode,h.focusOffset)}suppressWidgetCursorChange(e,t){return this.hasComposition&&t.empty&&ji(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset)&&this.posFromDOM(e.focusNode,e.focusOffset)==t.head}enforceCursorAssoc(){if(this.hasComposition)return;let{view:e}=this,t=e.state.selection.main,r=gi(e.root),{anchorNode:s,anchorOffset:n}=e.observer.selectionRange;if(!r||!t.empty||!t.assoc||!r.modify)return;let o=this.lineAt(t.head,t.assoc);if(!o)return;let l=o.posAtStart;if(t.head==l||t.head==l+o.length)return;let a=this.coordsAt(t.head,-1),u=this.coordsAt(t.head,1);if(!a||!u||a.bottom>u.top)return;let c=this.domAtPos(t.head+t.assoc,t.assoc);r.collapse(c.node,c.offset),r.modify("move",t.assoc<0?"forward":"backward","lineboundary"),e.observer.readSelectionRange();let h=e.observer.selectionRange;e.docView.posFromDOM(h.anchorNode,h.anchorOffset)!=t.from&&r.collapse(s,n)}posFromDOM(e,t){let r=this.tile.nearest(e);if(!r)return this.tile.dom.compareDocumentPosition(e)&2?0:this.view.state.doc.length;let s=r.posAtStart;if(r.isComposite()){let n;if(e==r.dom)n=r.dom.childNodes[t];else{let o=yt(e)==0?0:t==0?-1:1;for(;;){let l=e.parentNode;if(l==r.dom)break;o==0&&l.firstChild!=l.lastChild&&(e==l.firstChild?o=-1:o=1),e=l}o<0?n=e:n=e.nextSibling}if(n==r.dom.firstChild)return s;for(;n&&!Ae.get(n);)n=n.nextSibling;if(!n)return s+r.length;for(let o=0,l=s;;o++){let a=r.children[o];if(a.dom==n)return l;l+=a.length+a.breakAfter}}else return r.isText()?e==r.dom?s+t:s+(t?r.length:0):s}domAtPos(e,t){let{tile:r,offset:s}=this.tile.resolveBlock(e,t);return r.isWidget()?r.domPosFor(e,t):r.domIn(s,t)}inlineDOMNearPos(e,t){let r,s=-1,n=!1,o,l=-1,a=!1;return this.tile.blockTiles((u,c)=>{if(u.isWidget()){if(u.flags&32&&c>=e)return!0;u.flags&16&&(n=!0)}else{let h=c+u.length;if(c<=e&&(r=u,s=e-c,n=h<e),h>=e&&!o&&(o=u,l=e-c,a=c>e),c>e&&o)return!0}}),!r&&!o?this.domAtPos(e,t):(n&&o?r=null:a&&r&&(o=null),r&&t<0||!o?r.domIn(s,t):o.domIn(l,t))}coordsAt(e,t){let{tile:r,offset:s}=this.tile.resolveBlock(e,t);return r.isWidget()?r.widget instanceof Ws?null:r.coordsInWidget(s,t,!0):r.coordsIn(s,t)}lineAt(e,t){let{tile:r}=this.tile.resolveBlock(e,t);return r.isLine()?r:null}coordsForChar(e){let{tile:t,offset:r}=this.tile.resolveBlock(e,1);if(!t.isLine())return null;function s(n,o){if(n.isComposite())for(let l of n.children){if(l.length>=o){let a=s(l,o);if(a)return a}if(o-=l.length,o<0)break}else if(n.isText()&&o<n.length){let l=vt(n.text,o);if(l==o)return null;let a=Vi(n.dom,o,l).getClientRects();for(let u=0;u<a.length;u++){let c=a[u];if(u==a.length-1||c.top<c.bottom&&c.left<c.right)return c}}return null}return s(t,r)}measureVisibleLineHeights(e){let t=[],{from:r,to:s}=e,n=this.view.contentDOM.clientWidth,o=n>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,l=-1,a=this.view.textDirection==ye.LTR,u=0,c=(h,d,p)=>{for(let g=0;g<h.children.length&&!(d>s);g++){let f=h.children[g],m=d+f.length,D=f.dom.getBoundingClientRect(),{height:x}=D;if(p&&!g&&(u+=D.top-p.top),f instanceof wt)m>r&&c(f,d,D);else if(d>=r&&(u>0&&t.push(-u),t.push(x+u),u=0,o)){let k=f.dom.lastChild,B=k?Pi(k):[];if(B.length){let y=B[B.length-1],E=a?y.right-D.left:D.right-y.left;E>l&&(l=E,this.minWidth=n,this.minWidthFrom=d,this.minWidthTo=m)}}p&&g==h.children.length-1&&(u+=p.bottom-D.bottom),d=m+f.breakAfter}};return c(this.tile,0,null),t}textDirectionAt(e){let{tile:t}=this.tile.resolveBlock(e,1);return getComputedStyle(t.dom).direction=="rtl"?ye.RTL:ye.LTR}measureTextSize(){let e=this.tile.blockTiles(o=>{if(o.isLine()&&o.children.length&&o.length<=20){let l=0,a;for(let u of o.children){if(!u.isText()||/[^ -~]/.test(u.text))return;let c=Pi(u.dom);if(c.length!=1)return;l+=c[0].width,a=c[0].height}if(l)return{lineHeight:o.dom.getBoundingClientRect().height,charWidth:l/o.length,textHeight:a}}});if(e)return e;let t=document.createElement("div"),r,s,n;return t.className="cm-line",t.style.width="99999px",t.style.position="absolute",t.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore(()=>{this.tile.dom.appendChild(t);let o=Pi(t.firstChild)[0];r=t.getBoundingClientRect().height,s=o&&o.width?o.width/27:7,n=o&&o.height?o.height:r,t.remove()}),{lineHeight:r,charWidth:s,textHeight:n}}computeBlockGapDeco(){let e=[],t=this.view.viewState;for(let r=0,s=0;;s++){let n=s==t.viewports.length?null:t.viewports[s],o=n?n.from-1:this.view.state.doc.length;if(o>r){let l=(t.lineBlockAt(o).bottom-t.lineBlockAt(r).top)/this.view.scaleY;e.push(ge.replace({widget:new Ws(l),block:!0,inclusive:!0,isBlockGap:!0}).range(r,o))}if(!n)break;r=n.to+1}return ge.set(e)}updateDeco(){let e=1,t=this.view.state.facet(ss).map(n=>(this.dynamicDecorationMap[e++]=typeof n=="function")?n(this.view):n),r=!1,s=this.view.state.facet(qn).map((n,o)=>{let l=typeof n=="function";return l&&(r=!0),l?n(this.view):n});for(s.length&&(this.dynamicDecorationMap[e++]=r,t.push(Se.join(s))),this.decorations=[this.editContextFormatting,...t,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco];e<this.decorations.length;)this.dynamicDecorationMap[e++]=!1;this.blockWrappers=this.view.state.facet(ua).map(n=>typeof n=="function"?n(this.view):n)}scrollIntoView(e){if(e.isSnapshot){let u=this.view.viewState.lineBlockAt(e.range.head);this.view.scrollDOM.scrollTop=u.top-e.yMargin,this.view.scrollDOM.scrollLeft=e.xMargin;return}for(let u of this.view.state.facet(oa))try{if(u(this.view,e.range,e))return!0}catch(c){mt(this.view.state,c,"scroll handler")}let{range:t}=e,r=this.coordsAt(t.head,t.empty?t.assoc:t.head>t.anchor?-1:1),s;if(!r)return;!t.empty&&(s=this.coordsAt(t.anchor,t.anchor>t.head?-1:1))&&(r={left:Math.min(r.left,s.left),top:Math.min(r.top,s.top),right:Math.max(r.right,s.right),bottom:Math.max(r.bottom,s.bottom)});let n=da(this.view),o={left:r.left-n.left,top:r.top-n.top,right:r.right+n.right,bottom:r.bottom+n.bottom},{offsetWidth:l,offsetHeight:a}=this.view.scrollDOM;Tc(this.view.scrollDOM,o,t.head<t.anchor?-1:1,e.x,e.y,Math.max(Math.min(e.xMargin,l),-l),Math.max(Math.min(e.yMargin,a),-a),this.view.textDirection==ye.LTR)}lineHasWidget(e){let t=r=>r.isWidget()||r.children.some(t);return t(this.tile.resolveBlock(e,1).tile)}destroy(){mn(this.tile)}}function mn(i,e){let t=e?.get(i);if(t!=1){t==null&&i.destroy();for(let r of i.children)mn(r,e)}}function oh(i){return i.node.nodeType==1&&i.node.firstChild&&(i.offset==0||i.node.childNodes[i.offset-1].contentEditable=="false")&&(i.offset==i.node.childNodes.length||i.node.childNodes[i.offset].contentEditable=="false")}function pa(i,e){let t=i.observer.selectionRange;if(!t.focusNode)return null;let r=$l(t.focusNode,t.focusOffset),s=Kl(t.focusNode,t.focusOffset),n=r||s;if(s&&r&&s.node!=r.node){let l=Ae.get(s.node);if(!l||l.isText()&&l.text!=s.node.nodeValue)n=s;else if(i.docView.lastCompositionAfterCursor){let a=Ae.get(r.node);!a||a.isText()&&a.text!=r.node.nodeValue||(n=s)}}if(i.docView.lastCompositionAfterCursor=n!=r,!n)return null;let o=e-n.offset;return{from:o,to:o+n.node.nodeValue.length,node:n.node}}function lh(i,e,t){let r=pa(i,t);if(!r)return null;let{node:s,from:n,to:o}=r,l=s.nodeValue;if(/[\n\r]/.test(l)||i.state.doc.sliceString(r.from,r.to)!=l)return null;let a=e.invertedDesc;return{range:new We(a.mapPos(n),a.mapPos(o),n,o),text:s}}function ah(i,e){return i.nodeType!=1?0:(e&&i.childNodes[e-1].contentEditable=="false"?1:0)|(e<i.childNodes.length&&i.childNodes[e].contentEditable=="false"?2:0)}let uh=class{constructor(){this.changes=[]}compareRange(e,t){hi(e,t,this.changes)}comparePoint(e,t){hi(e,t,this.changes)}boundChange(e){hi(e,e,this.changes)}};function ch(i,e,t){let r=new uh;return Se.compare(i,e,t,r),r.changes}class hh{constructor(){this.changes=[]}compareRange(e,t){hi(e,t,this.changes)}comparePoint(){}boundChange(e){hi(e,e,this.changes)}}function dh(i,e,t){let r=new hh;return Se.compare(i,e,t,r),r.changes}function fh(i,e){for(let t=i;t&&t!=e;t=t.assignedSlot||t.parentNode)if(t.nodeType==1&&t.contentEditable=="false")return!0;return!1}function ph(i,e){let t=!1;return e&&i.iterChangedRanges((r,s)=>{r<e.to&&s>e.from&&(t=!0)}),t}class Ws extends zt{constructor(e){super(),this.height=e}toDOM(){let e=document.createElement("div");return e.className="cm-gap",this.updateDOM(e),e}eq(e){return e.height==this.height}updateDOM(e){return e.style.height=this.height+"px",!0}get editable(){return!0}get estimatedHeight(){return this.height}ignoreEvent(){return!1}}function gh(i,e,t=1){let r=i.charCategorizer(e),s=i.doc.lineAt(e),n=e-s.from;if(s.length==0)return X.cursor(e);n==0?t=1:n==s.length&&(t=-1);let o=n,l=n;t<0?o=vt(s.text,n,!1):l=vt(s.text,n);let a=r(s.text.slice(o,l));for(;o>0;){let u=vt(s.text,o,!1);if(r(s.text.slice(u,o))!=a)break;o=u}for(;l<s.length;){let u=vt(s.text,l);if(r(s.text.slice(l,u))!=a)break;l=u}return X.range(o+s.from,l+s.from)}function mh(i,e,t,r,s){let n=Math.round((r-e.left)*i.defaultCharacterWidth);if(i.lineWrapping&&t.height>i.defaultLineHeight*1.5){let l=i.viewState.heightOracle.textHeight,a=Math.floor((s-t.top-(i.defaultLineHeight-l)*.5)/l);n+=a*i.viewState.heightOracle.lineLength}let o=i.state.sliceDoc(t.from,t.to);return t.from+sn(o,n,i.state.tabSize)}function Dn(i,e,t){let r=i.lineBlockAt(e);if(Array.isArray(r.type)){let s;for(let n of r.type){if(n.from>e)break;if(!(n.to<e)){if(n.from<e&&n.to>e)return n;(!s||n.type==Ee.Text&&(s.type!=n.type||(t<0?n.from<e:n.to>e)))&&(s=n)}}return s||r}return r}function Dh(i,e,t,r){let s=Dn(i,e.head,e.assoc||-1),n=!r||s.type!=Ee.Text||!(i.lineWrapping||s.widgetLineBreaks)?null:i.coordsAtPos(e.assoc<0&&e.head>s.from?e.head-1:e.head);if(n){let o=i.dom.getBoundingClientRect(),l=i.textDirectionAt(s.from),a=i.posAtCoords({x:t==(l==ye.LTR)?o.right-1:o.left+1,y:(n.top+n.bottom)/2});if(a!=null)return X.cursor(a,t?-1:1)}return X.cursor(t?s.to:s.from,t?-1:1)}function So(i,e,t,r){let s=i.state.doc.lineAt(e.head),n=i.bidiSpans(s),o=i.textDirectionAt(s.from);for(let l=e,a=null;;){let u=$c(s,n,o,l,t),c=Gl;if(!u){if(s.number==(t?i.state.doc.lines:1))return l;c=`
`,s=i.state.doc.line(s.number+(t?1:-1)),n=i.bidiSpans(s),u=i.visualLineSide(s,!t)}if(a){if(!a(c))return l}else{if(!r)return u;a=r(c)}l=u}}function Ch(i,e,t){let r=i.state.charCategorizer(e),s=r(t);return n=>{let o=r(n);return s==ic.Space&&(s=o),s==o}}function yh(i,e,t,r){let s=e.head,n=t?1:-1;if(s==(t?i.state.doc.length:0))return X.cursor(s,e.assoc);let o=e.goalColumn,l,a=i.contentDOM.getBoundingClientRect(),u=i.coordsAtPos(s,e.assoc||-1),c=i.documentTop;if(u)o==null&&(o=u.left-a.left),l=n<0?u.top:u.bottom;else{let g=i.viewState.lineBlockAt(s);o==null&&(o=Math.min(a.right-a.left,i.defaultCharacterWidth*(s-g.from))),l=(n<0?g.top:g.bottom)+c}let h=a.left+o,d=r??i.viewState.heightOracle.textHeight>>1,p=Cn(i,{x:h,y:l+d*n},!1,n);return X.cursor(p.pos,p.assoc,void 0,o)}function Ni(i,e,t){for(;;){let r=0;for(let s of i)s.between(e-1,e+1,(n,o,l)=>{if(e>n&&e<o){let a=r||t||(e-n<o-e?-1:1);e=a<0?n:o,r=a}});if(!r)return e}}function ga(i,e){let t=null;for(let r=0;r<e.ranges.length;r++){let s=e.ranges[r],n=null;if(s.empty){let o=Ni(i,s.from,0);o!=s.from&&(n=X.cursor(o,-1))}else{let o=Ni(i,s.from,-1),l=Ni(i,s.to,1);(o!=s.from||l!=s.to)&&(n=X.range(s.from==s.anchor?o:l,s.from==s.head?o:l))}n&&(t||(t=e.ranges.slice()),t[r]=n)}return t?X.create(t,e.mainIndex):e}function Hs(i,e,t){let r=Ni(i.state.facet(Qi).map(s=>s(i)),t.from,e.head>t.from?-1:1);return r==t.from?t:X.cursor(r,r<t.from?1:-1)}class rt{constructor(e,t){this.pos=e,this.assoc=t}}function Cn(i,e,t,r){let s=i.contentDOM.getBoundingClientRect(),n=s.top+i.viewState.paddingTop,{x:o,y:l}=e,a=l-n,u;for(;;){if(a<0)return new rt(0,1);if(a>i.viewState.docHeight)return new rt(i.state.doc.length,-1);if(u=i.elementAtHeight(a),r==null)break;if(u.type==Ee.Text){let d=i.docView.coordsAt(r<0?u.from:u.to,r);if(d&&(r<0?d.top<=a+n:d.bottom>=a+n))break}let h=i.viewState.heightOracle.textHeight/2;a=r>0?u.bottom+h:u.top-h}if(i.viewport.from>=u.to||i.viewport.to<=u.from){if(t)return null;if(u.type==Ee.Text){let h=mh(i,s,u,o,l);return new rt(h,h==u.from?1:-1)}}if(u.type!=Ee.Text)return a<(u.top+u.bottom)/2?new rt(u.from,1):new rt(u.to,-1);let c=i.docView.lineAt(u.from,2);return(!c||c.length!=u.length)&&(c=i.docView.lineAt(u.from,-2)),ma(i,c,u.from,o,l)}function ma(i,e,t,r,s){let n=-1,o=null,l=1e9,a=1e9,u=s,c=s,h=(d,p)=>{for(let g=0;g<d.length;g++){let f=d[g];if(f.top==f.bottom)continue;let m=f.left>r?f.left-r:f.right<r?r-f.right:0,D=f.top>s?f.top-s:f.bottom<s?s-f.bottom:0;f.top<=c&&f.bottom>=u&&(u=Math.min(f.top,u),c=Math.max(f.bottom,c),D=0),(n<0||(D-a||m-l)<0)&&(n>=0&&a&&l<m&&o.top<=c-2&&o.bottom>=u+2?a=0:(n=p,l=m,a=D,o=f))}};if(e.isText()){for(let p=0;p<e.length;){let g=vt(e.text,p);if(h(Vi(e.dom,p,g).getClientRects(),p),!l&&!a)break;p=g}return r>(o.left+o.right)/2==(vo(i,n+t)==ye.LTR)?new rt(t+vt(e.text,n),-1):new rt(t+n,1)}else{if(!e.length)return new rt(t,1);for(let f=0;f<e.children.length;f++){let m=e.children[f];if(m.flags&48)continue;let D=(m.dom.nodeType==1?m.dom:Vi(m.dom,0,m.length)).getClientRects();if(h(D,f),!l&&!a)break}let d=e.children[n],p=e.posBefore(d,t);return d.isComposite()||d.isText()?ma(i,d,p,Math.max(o.left,Math.min(o.right,r)),s):r>(o.left+o.right)/2==(vo(i,n+t)==ye.LTR)?new rt(p+d.length,-1):new rt(p,1)}}function vo(i,e){let t=i.state.doc.lineAt(e);return i.bidiSpans(t)[gt.find(i.bidiSpans(t),e-t.from,-1,1)].dir}const ki="";class bh{constructor(e,t){this.points=e,this.view=t,this.text="",this.lineSeparator=t.state.facet(Dt.lineSeparator)}append(e){this.text+=e}lineBreak(){this.text+=ki}readRange(e,t){if(!e)return this;let r=e.parentNode;for(let s=e;;){this.findPointBefore(r,s);let n=this.text.length;this.readNode(s);let o=Ae.get(s),l=s.nextSibling;if(l==t){o?.breakAfter&&!l&&r!=this.view.contentDOM&&this.lineBreak();break}let a=Ae.get(l);(o&&a?o.breakAfter:(o?o.breakAfter:Ur(s))||Ur(l)&&(s.nodeName!="BR"||o?.isWidget())&&this.text.length>n)&&!xh(l,t)&&this.lineBreak(),s=l}return this.findPointBefore(r,t),this}readTextNode(e){let t=e.nodeValue;for(let r of this.points)r.node==e&&(r.pos=this.text.length+Math.min(r.offset,t.length));for(let r=0,s=this.lineSeparator?null:/\r\n?|\n/g;;){let n=-1,o=1,l;if(this.lineSeparator?(n=t.indexOf(this.lineSeparator,r),o=this.lineSeparator.length):(l=s.exec(t))&&(n=l.index,o=l[0].length),this.append(t.slice(r,n<0?t.length:n)),n<0)break;if(this.lineBreak(),o>1)for(let a of this.points)a.node==e&&a.pos>this.text.length&&(a.pos-=o-1);r=n+o}}readNode(e){let t=Ae.get(e),r=t&&t.overrideDOMText;if(r!=null){this.findPointInside(e,r.length);for(let s=r.iter();!s.next().done;)s.lineBreak?this.lineBreak():this.append(s.value)}else e.nodeType==3?this.readTextNode(e):e.nodeName=="BR"?e.nextSibling&&this.lineBreak():e.nodeType==1&&this.readRange(e.firstChild,null)}findPointBefore(e,t){for(let r of this.points)r.node==e&&e.childNodes[r.offset]==t&&(r.pos=this.text.length)}findPointInside(e,t){for(let r of this.points)(e.nodeType==3?r.node==e:e.contains(r.node))&&(r.pos=this.text.length+(Ah(e,r.node,r.offset)?t:0))}}function Ah(i,e,t){for(;;){if(!e||t<yt(e))return!1;if(e==i)return!0;t=Et(e)+1,e=e.parentNode}}function xh(i,e){let t;for(;!(i==e||!i);i=i.nextSibling){let r=Ae.get(i);if(!r?.isWidget())return!1;r&&(t||(t=[])).push(r)}if(t)for(let r of t){let s=r.overrideDOMText;if(s?.length)return!1}return!0}class wo{constructor(e,t){this.node=e,this.offset=t,this.pos=-1}}class Sh{constructor(e,t,r,s){this.typeOver=s,this.bounds=null,this.text="",this.domChanged=t>-1;let{impreciseHead:n,impreciseAnchor:o}=e.docView;if(e.state.readOnly&&t>-1)this.newSel=null;else if(t>-1&&(this.bounds=Da(e.docView.tile,t,r,0))){let l=n||o?[]:wh(e),a=new bh(l,e);a.readRange(this.bounds.startDOM,this.bounds.endDOM),this.text=a.text,this.newSel=Eh(l,this.bounds.from)}else{let l=e.observer.selectionRange,a=n&&n.node==l.focusNode&&n.offset==l.focusOffset||!hn(e.contentDOM,l.focusNode)?e.state.selection.main.head:e.docView.posFromDOM(l.focusNode,l.focusOffset),u=o&&o.node==l.anchorNode&&o.offset==l.anchorOffset||!hn(e.contentDOM,l.anchorNode)?e.state.selection.main.anchor:e.docView.posFromDOM(l.anchorNode,l.anchorOffset),c=e.viewport;if((N.ios||N.chrome)&&e.state.selection.main.empty&&a!=u&&(c.from>0||c.to<e.state.doc.length)){let h=Math.min(a,u),d=Math.max(a,u),p=c.from-h,g=c.to-d;(p==0||p==1||h==0)&&(g==0||g==-1||d==e.state.doc.length)&&(a=0,u=e.state.doc.length)}e.inputState.composing>-1&&e.state.selection.ranges.length>1?this.newSel=e.state.selection.replaceRange(X.range(u,a)):this.newSel=X.single(u,a)}}}function Da(i,e,t,r){if(i.isComposite()){let s=-1,n=-1,o=-1,l=-1;for(let a=0,u=r,c=r;a<i.children.length;a++){let h=i.children[a],d=u+h.length;if(u<e&&d>t)return Da(h,e,t,u);if(d>=e&&s==-1&&(s=a,n=u),u>t&&h.dom.parentNode==i.dom){o=a,l=c;break}c=d,u=d+h.breakAfter}return{from:n,to:l<0?r+i.length:l,startDOM:(s?i.children[s-1].dom.nextSibling:null)||i.dom.firstChild,endDOM:o<i.children.length&&o>=0?i.children[o].dom:null}}else return i.isText()?{from:r,to:r+i.length,startDOM:i.dom,endDOM:i.dom.nextSibling}:null}function Ca(i,e){let t,{newSel:r}=e,s=i.state.selection.main,n=i.inputState.lastKeyTime>Date.now()-100?i.inputState.lastKeyCode:-1;if(e.bounds){let{from:o,to:l}=e.bounds,a=s.from,u=null;(n===8||N.android&&e.text.length<l-o)&&(a=s.to,u="end");let c=ya(i.state.doc.sliceString(o,l,ki),e.text,a-o,u);c&&(N.chrome&&n==13&&c.toB==c.from+2&&e.text.slice(c.from,c.toB)==ki+ki&&c.toB--,t={from:o+c.from,to:o+c.toA,insert:Ze.of(e.text.slice(c.from,c.toB).split(ki))})}else r&&(!i.hasFocus&&i.state.facet(dt)||Gr(r,s))&&(r=null);if(!t&&!r)return!1;if(!t&&e.typeOver&&!s.empty&&r&&r.main.empty?t={from:s.from,to:s.to,insert:i.state.doc.slice(s.from,s.to)}:(N.mac||N.android)&&t&&t.from==t.to&&t.from==s.head-1&&/^\. ?$/.test(t.insert.toString())&&i.contentDOM.getAttribute("autocorrect")=="off"?(r&&t.insert.length==2&&(r=X.single(r.main.anchor-1,r.main.head-1)),t={from:t.from,to:t.to,insert:Ze.of([t.insert.toString().replace("."," ")])}):t&&t.from>=s.from&&t.to<=s.to&&(t.from!=s.from||t.to!=s.to)&&s.to-s.from-(t.to-t.from)<=4?t={from:s.from,to:s.to,insert:i.state.doc.slice(s.from,t.from).append(t.insert).append(i.state.doc.slice(t.to,s.to))}:i.state.doc.lineAt(s.from).to<s.to&&i.docView.lineHasWidget(s.to)&&i.inputState.insertingTextAt>Date.now()-50?t={from:s.from,to:s.to,insert:i.state.toText(i.inputState.insertingText)}:N.chrome&&t&&t.from==t.to&&t.from==s.head&&t.insert.toString()==`
 `&&i.lineWrapping&&(r&&(r=X.single(r.main.anchor-1,r.main.head-1)),t={from:s.from,to:s.to,insert:Ze.of([" "])}),t)return $n(i,t,r,n);if(r&&!Gr(r,s)){let o=!1,l="select";return i.inputState.lastSelectionTime>Date.now()-50&&(i.inputState.lastSelectionOrigin=="select"&&(o=!0),l=i.inputState.lastSelectionOrigin,l=="select.pointer"&&(r=ga(i.state.facet(Qi).map(a=>a(i)),r))),i.dispatch({selection:r,scrollIntoView:o,userEvent:l}),!0}else return!1}function $n(i,e,t,r=-1){if(N.ios&&i.inputState.flushIOSKey(e))return!0;let s=i.state.selection.main;if(N.android&&(e.to==s.to&&(e.from==s.from||e.from==s.from-1&&i.state.sliceDoc(e.from,s.from)==" ")&&e.insert.length==1&&e.insert.lines==2&&di(i.contentDOM,"Enter",13)||(e.from==s.from-1&&e.to==s.to&&e.insert.length==0||r==8&&e.insert.length<e.to-e.from&&e.to>s.head)&&di(i.contentDOM,"Backspace",8)||e.from==s.from&&e.to==s.to+1&&e.insert.length==0&&di(i.contentDOM,"Delete",46)))return!0;let n=e.insert.toString();i.inputState.composing>=0&&i.inputState.composing++;let o,l=()=>o||(o=vh(i,e,t));return i.state.facet(ia).some(a=>a(i,e.from,e.to,n,l))||i.dispatch(l()),!0}function vh(i,e,t){let r,s=i.state,n=s.selection.main,o=-1;if(e.from==e.to&&e.from<n.from||e.from>n.to){let a=e.from<n.from?-1:1,u=a<0?n.from:n.to,c=Ni(s.facet(Qi).map(h=>h(i)),u,a);e.from==c&&(o=c)}if(o>-1)r={changes:e,selection:X.cursor(e.from+e.insert.length,-1)};else if(e.from>=n.from&&e.to<=n.to&&e.to-e.from>=(n.to-n.from)/3&&(!t||t.main.empty&&t.main.from==e.from+e.insert.length)&&i.inputState.composing<0){let a=n.from<e.from?s.sliceDoc(n.from,e.from):"",u=n.to>e.to?s.sliceDoc(e.to,n.to):"";r=s.replaceSelection(i.state.toText(a+e.insert.sliceString(0,void 0,i.state.lineBreak)+u))}else{let a=s.changes(e),u=t&&t.main.to<=a.newLength?t.main:void 0;if(s.selection.ranges.length>1&&(i.inputState.composing>=0||i.inputState.compositionPendingChange)&&e.to<=n.to+10&&e.to>=n.to-10){let c=i.state.sliceDoc(e.from,e.to),h,d=t&&pa(i,t.main.head);if(d){let g=e.insert.length-(e.to-e.from);h={from:d.from,to:d.to-g}}else h=i.state.doc.lineAt(n.head);let p=n.to-e.to;r=s.changeByRange(g=>{if(g.from==n.from&&g.to==n.to)return{changes:a,range:u||g.map(a)};let f=g.to-p,m=f-c.length;if(i.state.sliceDoc(m,f)!=c||f>=h.from&&m<=h.to)return{range:g};let D=s.changes({from:m,to:f,insert:e.insert}),x=g.to-n.to;return{changes:D,range:u?X.range(Math.max(0,u.anchor+x),Math.max(0,u.head+x)):g.map(D)}})}else r={changes:a,selection:u&&s.selection.replaceRange(u)}}let l="input.type";return(i.composing||i.inputState.compositionPendingChange&&i.inputState.compositionEndedAt>Date.now()-50)&&(i.inputState.compositionPendingChange=!1,l+=".compose",i.inputState.compositionFirstChange&&(l+=".start",i.inputState.compositionFirstChange=!1)),s.update(r,{userEvent:l,scrollIntoView:!0})}function ya(i,e,t,r){let s=Math.min(i.length,e.length),n=0;for(;n<s&&i.charCodeAt(n)==e.charCodeAt(n);)n++;if(n==s&&i.length==e.length)return null;let o=i.length,l=e.length;for(;o>0&&l>0&&i.charCodeAt(o-1)==e.charCodeAt(l-1);)o--,l--;if(r=="end"){let a=Math.max(0,n-Math.min(o,l));t-=o+a-n}if(o<n&&i.length<e.length){let a=t<=n&&t>=o?n-t:0;n-=a,l=n+(l-o),o=n}else if(l<n){let a=t<=n&&t>=l?n-t:0;n-=a,o=n+(o-l),l=n}return{from:n,toA:o,toB:l}}function wh(i){let e=[];if(i.root.activeElement!=i.contentDOM)return e;let{anchorNode:t,anchorOffset:r,focusNode:s,focusOffset:n}=i.observer.selectionRange;return t&&(e.push(new wo(t,r)),(s!=t||n!=r)&&e.push(new wo(s,n))),e}function Eh(i,e){if(i.length==0)return null;let t=i[0].pos,r=i.length==2?i[1].pos:t;return t>-1&&r>-1?X.single(t+e,r+e):null}function Gr(i,e){return e.head==i.main.head&&e.anchor==i.main.anchor}class Fh{setSelectionOrigin(e){this.lastSelectionOrigin=e,this.lastSelectionTime=Date.now()}constructor(e){this.view=e,this.lastKeyCode=0,this.lastKeyTime=0,this.lastTouchTime=0,this.lastFocusTime=0,this.lastScrollTop=0,this.lastScrollLeft=0,this.pendingIOSKey=void 0,this.tabFocusMode=-1,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastContextMenu=0,this.scrollHandlers=[],this.handlers=Object.create(null),this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.compositionPendingKey=!1,this.compositionPendingChange=!1,this.insertingText="",this.insertingTextAt=0,this.mouseSelection=null,this.draggedContent=null,this.handleEvent=this.handleEvent.bind(this),this.notifiedFocused=e.hasFocus,N.safari&&e.contentDOM.addEventListener("input",()=>null),N.gecko&&Hh(e.contentDOM.ownerDocument)}handleEvent(e){!Ph(this.view,e)||this.ignoreDuringComposition(e)||e.type=="keydown"&&this.keydown(e)||(this.view.updateState!=0?Promise.resolve().then(()=>this.runHandlers(e.type,e)):this.runHandlers(e.type,e))}runHandlers(e,t){let r=this.handlers[e];if(r){for(let s of r.observers)s(this.view,t);for(let s of r.handlers){if(t.defaultPrevented)break;if(s(this.view,t)){t.preventDefault();break}}}}ensureHandlers(e){let t=Bh(e),r=this.handlers,s=this.view.contentDOM;for(let n in t)if(n!="scroll"){let o=!t[n].handlers.length,l=r[n];l&&o!=!l.handlers.length&&(s.removeEventListener(n,this.handleEvent),l=null),l||s.addEventListener(n,this.handleEvent,{passive:o})}for(let n in r)n!="scroll"&&!t[n]&&s.removeEventListener(n,this.handleEvent);this.handlers=t}keydown(e){if(this.lastKeyCode=e.keyCode,this.lastKeyTime=Date.now(),e.keyCode==9&&this.tabFocusMode>-1&&(!this.tabFocusMode||Date.now()<=this.tabFocusMode))return!0;if(this.tabFocusMode>0&&e.keyCode!=27&&Aa.indexOf(e.keyCode)<0&&(this.tabFocusMode=-1),N.android&&N.chrome&&!e.synthetic&&(e.keyCode==13||e.keyCode==8))return this.view.observer.delayAndroidKey(e.key,e.keyCode),!0;let t;return N.ios&&!e.synthetic&&!e.altKey&&!e.metaKey&&((t=ba.find(r=>r.keyCode==e.keyCode))&&!e.ctrlKey||kh.indexOf(e.key)>-1&&e.ctrlKey&&!e.shiftKey)?(this.pendingIOSKey=t||e,setTimeout(()=>this.flushIOSKey(),250),!0):(e.keyCode!=229&&this.view.observer.forceFlush(),!1)}flushIOSKey(e){let t=this.pendingIOSKey;return!t||t.key=="Enter"&&e&&e.from<e.to&&/^\S+$/.test(e.insert.toString())?!1:(this.pendingIOSKey=void 0,di(this.view.contentDOM,t.key,t.keyCode,t instanceof KeyboardEvent?t:void 0))}ignoreDuringComposition(e){return!/^key/.test(e.type)||e.synthetic?!1:this.composing>0?!0:N.safari&&!N.ios&&this.compositionPendingKey&&Date.now()-this.compositionEndedAt<100?(this.compositionPendingKey=!1,!0):!1}startMouseSelection(e){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=e}update(e){this.view.observer.update(e),this.mouseSelection&&this.mouseSelection.update(e),this.draggedContent&&e.docChanged&&(this.draggedContent=this.draggedContent.map(e.changes)),e.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}function Eo(i,e){return(t,r)=>{try{return e.call(i,r,t)}catch(s){mt(t.state,s)}}}function Bh(i){let e=Object.create(null);function t(r){return e[r]||(e[r]={observers:[],handlers:[]})}for(let r of i){let s=r.spec,n=s&&s.plugin.domEventHandlers,o=s&&s.plugin.domEventObservers;if(n)for(let l in n){let a=n[l];a&&t(l).handlers.push(Eo(r.value,a))}if(o)for(let l in o){let a=o[l];a&&t(l).observers.push(Eo(r.value,a))}}for(let r in tt)t(r).handlers.push(tt[r]);for(let r in Ve)t(r).observers.push(Ve[r]);return e}const ba=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Enter",keyCode:13,inputType:"insertLineBreak"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],kh="dthko",Aa=[16,17,18,20,91,92,224,225],kr=6;function Mr(i){return Math.max(0,i)*.7+8}function Mh(i,e){return Math.max(Math.abs(i.clientX-e.clientX),Math.abs(i.clientY-e.clientY))}class Oh{constructor(e,t,r,s){this.view=e,this.startEvent=t,this.style=r,this.mustSelect=s,this.scrollSpeed={x:0,y:0},this.scrolling=-1,this.lastEvent=t,this.scrollParents=Lc(e.contentDOM),this.atoms=e.state.facet(Qi).map(o=>o(e));let n=e.contentDOM.ownerDocument;n.addEventListener("mousemove",this.move=this.move.bind(this)),n.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=t.shiftKey,this.multiple=e.state.facet(Dt.allowMultipleSelections)&&Rh(e,t),this.dragging=Lh(e,t)&&va(t)==1?null:!1}start(e){this.dragging===!1&&this.select(e)}move(e){if(e.buttons==0)return this.destroy();if(this.dragging||this.dragging==null&&Mh(this.startEvent,e)<10)return;this.select(this.lastEvent=e);let t=0,r=0,s=0,n=0,o=this.view.win.innerWidth,l=this.view.win.innerHeight;this.scrollParents.x&&({left:s,right:o}=this.scrollParents.x.getBoundingClientRect()),this.scrollParents.y&&({top:n,bottom:l}=this.scrollParents.y.getBoundingClientRect());let a=da(this.view);e.clientX-a.left<=s+kr?t=-Mr(s-e.clientX):e.clientX+a.right>=o-kr&&(t=Mr(e.clientX-o)),e.clientY-a.top<=n+kr?r=-Mr(n-e.clientY):e.clientY+a.bottom>=l-kr&&(r=Mr(e.clientY-l)),this.setScrollSpeed(t,r)}up(e){this.dragging==null&&this.select(this.lastEvent),this.dragging||e.preventDefault(),this.destroy()}destroy(){this.setScrollSpeed(0,0);let e=this.view.contentDOM.ownerDocument;e.removeEventListener("mousemove",this.move),e.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=this.view.inputState.draggedContent=null}setScrollSpeed(e,t){this.scrollSpeed={x:e,y:t},e||t?this.scrolling<0&&(this.scrolling=setInterval(()=>this.scroll(),50)):this.scrolling>-1&&(clearInterval(this.scrolling),this.scrolling=-1)}scroll(){let{x:e,y:t}=this.scrollSpeed;e&&this.scrollParents.x&&(this.scrollParents.x.scrollLeft+=e,e=0),t&&this.scrollParents.y&&(this.scrollParents.y.scrollTop+=t,t=0),(e||t)&&this.view.win.scrollBy(e,t),this.dragging===!1&&this.select(this.lastEvent)}select(e){let{view:t}=this,r=ga(this.atoms,this.style.get(e,this.extend,this.multiple));(this.mustSelect||!r.eq(t.state.selection,this.dragging===!1))&&this.view.dispatch({selection:r,userEvent:"select.pointer"}),this.mustSelect=!1}update(e){e.transactions.some(t=>t.isUserEvent("input.type"))?this.destroy():this.style.update(e)&&setTimeout(()=>this.select(this.lastEvent),20)}}function Rh(i,e){let t=i.state.facet(Xl);return t.length?t[0](e):N.mac?e.metaKey:e.ctrlKey}function Th(i,e){let t=i.state.facet(Zl);return t.length?t[0](e):N.mac?!e.altKey:!e.ctrlKey}function Lh(i,e){let{main:t}=i.state.selection;if(t.empty)return!1;let r=gi(i.root);if(!r||r.rangeCount==0)return!0;let s=r.getRangeAt(0).getClientRects();for(let n=0;n<s.length;n++){let o=s[n];if(o.left<=e.clientX&&o.right>=e.clientX&&o.top<=e.clientY&&o.bottom>=e.clientY)return!0}return!1}function Ph(i,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let t=e.target,r;t!=i.contentDOM;t=t.parentNode)if(!t||t.nodeType==11||(r=Ae.get(t))&&r.isWidget()&&!r.isHidden&&r.widget.ignoreEvent(e))return!1;return!0}const tt=Object.create(null),Ve=Object.create(null),xa=N.ie&&N.ie_version<15||N.ios&&N.webkit_version<604;function jh(i){let e=i.dom.parentNode;if(!e)return;let t=e.appendChild(document.createElement("textarea"));t.style.cssText="position: fixed; left: -10000px; top: 10px",t.focus(),setTimeout(()=>{i.focus(),t.remove(),Sa(i,t.value)},50)}function ls(i,e,t){for(let r of i.facet(e))t=r(t,i);return t}function Sa(i,e){e=ls(i.state,Wn,e);let{state:t}=i,r,s=1,n=t.toText(e),o=n.lines==t.selection.ranges.length;if(yn!=null&&t.selection.ranges.every(a=>a.empty)&&yn==n.toString()){let a=-1;r=t.changeByRange(u=>{let c=t.doc.lineAt(u.from);if(c.from==a)return{range:u};a=c.from;let h=t.toText((o?n.line(s++).text:e)+t.lineBreak);return{changes:{from:c.from,insert:h},range:X.cursor(u.from+h.length)}})}else o?r=t.changeByRange(a=>{let u=n.line(s++);return{changes:{from:a.from,to:a.to,insert:u.text},range:X.cursor(a.from+u.length)}}):r=t.replaceSelection(n);i.dispatch(r,{userEvent:"input.paste",scrollIntoView:!0})}Ve.scroll=i=>{i.inputState.lastScrollTop=i.scrollDOM.scrollTop,i.inputState.lastScrollLeft=i.scrollDOM.scrollLeft};tt.keydown=(i,e)=>(i.inputState.setSelectionOrigin("select"),e.keyCode==27&&i.inputState.tabFocusMode!=0&&(i.inputState.tabFocusMode=Date.now()+2e3),!1);Ve.touchstart=(i,e)=>{i.inputState.lastTouchTime=Date.now(),i.inputState.setSelectionOrigin("select.pointer")};Ve.touchmove=i=>{i.inputState.setSelectionOrigin("select.pointer")};tt.mousedown=(i,e)=>{if(i.observer.flush(),i.inputState.lastTouchTime>Date.now()-2e3)return!1;let t=null;for(let r of i.state.facet(ea))if(t=r(i,e),t)break;if(!t&&e.button==0&&(t=_h(i,e)),t){let r=!i.hasFocus;i.inputState.startMouseSelection(new Oh(i,e,t,r)),r&&i.observer.ignore(()=>{Vl(i.contentDOM);let n=i.root.activeElement;n&&!n.contains(i.contentDOM)&&n.blur()});let s=i.inputState.mouseSelection;if(s)return s.start(e),s.dragging===!1}else i.inputState.setSelectionOrigin("select.pointer");return!1};function Fo(i,e,t,r){if(r==1)return X.cursor(e,t);if(r==2)return gh(i.state,e,t);{let s=i.docView.lineAt(e,t),n=i.state.doc.lineAt(s?s.posAtEnd:e),o=s?s.posAtStart:n.from,l=s?s.posAtEnd:n.to;return l<i.state.doc.length&&l==n.to&&l++,X.range(o,l)}}const Nh=N.ie&&N.ie_version<=11;let Bo=null,ko=0,Mo=0;function va(i){if(!Nh)return i.detail;let e=Bo,t=Mo;return Bo=i,Mo=Date.now(),ko=!e||t>Date.now()-400&&Math.abs(e.clientX-i.clientX)<2&&Math.abs(e.clientY-i.clientY)<2?(ko+1)%3:1}function _h(i,e){let t=i.posAndSideAtCoords({x:e.clientX,y:e.clientY},!1),r=va(e),s=i.state.selection;return{update(n){n.docChanged&&(t.pos=n.changes.mapPos(t.pos),s=s.map(n.changes))},get(n,o,l){let a=i.posAndSideAtCoords({x:n.clientX,y:n.clientY},!1),u,c=Fo(i,a.pos,a.assoc,r);if(t.pos!=a.pos&&!o){let h=Fo(i,t.pos,t.assoc,r),d=Math.min(h.from,c.from),p=Math.max(h.to,c.to);c=d<c.from?X.range(d,p):X.range(p,d)}return o?s.replaceRange(s.main.extend(c.from,c.to)):l&&r==1&&s.ranges.length>1&&(u=Ih(s,a.pos))?u:l?s.addRange(c):X.create([c])}}}function Ih(i,e){for(let t=0;t<i.ranges.length;t++){let{from:r,to:s}=i.ranges[t];if(r<=e&&s>=e)return X.create(i.ranges.slice(0,t).concat(i.ranges.slice(t+1)),i.mainIndex==t?0:i.mainIndex-(i.mainIndex>t?1:0))}return null}tt.dragstart=(i,e)=>{let{selection:{main:t}}=i.state;if(e.target.draggable){let s=i.docView.tile.nearest(e.target);if(s&&s.isWidget()){let n=s.posAtStart,o=n+s.length;(n>=t.to||o<=t.from)&&(t=X.range(n,o))}}let{inputState:r}=i;return r.mouseSelection&&(r.mouseSelection.dragging=!0),r.draggedContent=t,e.dataTransfer&&(e.dataTransfer.setData("Text",ls(i.state,Hn,i.state.sliceDoc(t.from,t.to))),e.dataTransfer.effectAllowed="copyMove"),!1};tt.dragend=i=>(i.inputState.draggedContent=null,!1);function Oo(i,e,t,r){if(t=ls(i.state,Wn,t),!t)return;let s=i.posAtCoords({x:e.clientX,y:e.clientY},!1),{draggedContent:n}=i.inputState,o=r&&n&&Th(i,e)?{from:n.from,to:n.to}:null,l={from:s,insert:t},a=i.state.changes(o?[o,l]:l);i.focus(),i.dispatch({changes:a,selection:{anchor:a.mapPos(s,-1),head:a.mapPos(s,1)},userEvent:o?"move.drop":"input.drop"}),i.inputState.draggedContent=null}tt.drop=(i,e)=>{if(!e.dataTransfer)return!1;if(i.state.readOnly)return!0;let t=e.dataTransfer.files;if(t&&t.length){let r=Array(t.length),s=0,n=()=>{++s==t.length&&Oo(i,e,r.filter(o=>o!=null).join(i.state.lineBreak),!1)};for(let o=0;o<t.length;o++){let l=new FileReader;l.onerror=n,l.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(l.result)||(r[o]=l.result),n()},l.readAsText(t[o])}return!0}else{let r=e.dataTransfer.getData("Text");if(r)return Oo(i,e,r,!0),!0}return!1};tt.paste=(i,e)=>{if(i.state.readOnly)return!0;i.observer.flush();let t=xa?null:e.clipboardData;return t?(Sa(i,t.getData("text/plain")||t.getData("text/uri-list")),!0):(jh(i),!1)};function zh(i,e){let t=i.dom.parentNode;if(!t)return;let r=t.appendChild(document.createElement("textarea"));r.style.cssText="position: fixed; left: -10000px; top: 10px",r.value=e,r.focus(),r.selectionEnd=e.length,r.selectionStart=0,setTimeout(()=>{r.remove(),i.focus()},50)}function Wh(i){let e=[],t=[],r=!1;for(let s of i.selection.ranges)s.empty||(e.push(i.sliceDoc(s.from,s.to)),t.push(s));if(!e.length){let s=-1;for(let{from:n}of i.selection.ranges){let o=i.doc.lineAt(n);o.number>s&&(e.push(o.text),t.push({from:o.from,to:Math.min(i.doc.length,o.to+1)})),s=o.number}r=!0}return{text:ls(i,Hn,e.join(i.lineBreak)),ranges:t,linewise:r}}let yn=null;tt.copy=tt.cut=(i,e)=>{let t=gi(i.root);if(t&&!Li(i.contentDOM,t))return!1;let{text:r,ranges:s,linewise:n}=Wh(i.state);if(!r&&!n)return!1;yn=n?r:null,e.type=="cut"&&!i.state.readOnly&&i.dispatch({changes:s,scrollIntoView:!0,userEvent:"delete.cut"});let o=xa?null:e.clipboardData;return o?(o.clearData(),o.setData("text/plain",r),!0):(zh(i,r),!1)};const wa=El.define();function Ea(i,e){let t=[];for(let r of i.facet(ra)){let s=r(i,e);s&&t.push(s)}return t.length?i.update({effects:t,annotations:wa.of(!0)}):null}function Fa(i){setTimeout(()=>{let e=i.hasFocus;if(e!=i.inputState.notifiedFocused){let t=Ea(i.state,e);t?i.dispatch(t):i.update([])}},10)}Ve.focus=i=>{i.inputState.lastFocusTime=Date.now(),!i.scrollDOM.scrollTop&&(i.inputState.lastScrollTop||i.inputState.lastScrollLeft)&&(i.scrollDOM.scrollTop=i.inputState.lastScrollTop,i.scrollDOM.scrollLeft=i.inputState.lastScrollLeft),Fa(i)};Ve.blur=i=>{i.observer.clearSelectionRange(),Fa(i)};Ve.compositionstart=Ve.compositionupdate=i=>{i.observer.editContext||(i.inputState.compositionFirstChange==null&&(i.inputState.compositionFirstChange=!0),i.inputState.composing<0&&(i.inputState.composing=0))};Ve.compositionend=i=>{i.observer.editContext||(i.inputState.composing=-1,i.inputState.compositionEndedAt=Date.now(),i.inputState.compositionPendingKey=!0,i.inputState.compositionPendingChange=i.observer.pendingRecords().length>0,i.inputState.compositionFirstChange=null,N.chrome&&N.android?i.observer.flushSoon():i.inputState.compositionPendingChange?Promise.resolve().then(()=>i.observer.flush()):setTimeout(()=>{i.inputState.composing<0&&i.docView.hasComposition&&i.update([])},50))};Ve.contextmenu=i=>{i.inputState.lastContextMenu=Date.now()};tt.beforeinput=(i,e)=>{var t,r;if((e.inputType=="insertText"||e.inputType=="insertCompositionText")&&(i.inputState.insertingText=e.data,i.inputState.insertingTextAt=Date.now()),e.inputType=="insertReplacementText"&&i.observer.editContext){let n=(t=e.dataTransfer)===null||t===void 0?void 0:t.getData("text/plain"),o=e.getTargetRanges();if(n&&o.length){let l=o[0],a=i.posAtDOM(l.startContainer,l.startOffset),u=i.posAtDOM(l.endContainer,l.endOffset);return $n(i,{from:a,to:u,insert:i.state.toText(n)},null),!0}}let s;if(N.chrome&&N.android&&(s=ba.find(n=>n.inputType==e.inputType))&&(i.observer.delayAndroidKey(s.key,s.keyCode),s.key=="Backspace"||s.key=="Delete")){let n=((r=window.visualViewport)===null||r===void 0?void 0:r.height)||0;setTimeout(()=>{var o;(((o=window.visualViewport)===null||o===void 0?void 0:o.height)||0)>n+10&&i.hasFocus&&(i.contentDOM.blur(),i.focus())},100)}return N.ios&&e.inputType=="deleteContentForward"&&i.observer.flushSoon(),N.safari&&e.inputType=="insertText"&&i.inputState.composing>=0&&setTimeout(()=>Ve.compositionend(i,e),20),!1};const Ro=new Set;function Hh(i){Ro.has(i)||(Ro.add(i),i.addEventListener("copy",()=>{}),i.addEventListener("cut",()=>{}))}const To=["pre-wrap","normal","pre-line","break-spaces"];let Ci=!1;function Lo(){Ci=!1}class Vh{constructor(e){this.lineWrapping=e,this.doc=Ze.empty,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.textHeight=14,this.lineLength=30}heightForGap(e,t){let r=this.doc.lineAt(t).number-this.doc.lineAt(e).number+1;return this.lineWrapping&&(r+=Math.max(0,Math.ceil((t-e-r*this.lineLength*.5)/this.lineLength))),this.lineHeight*r}heightForLine(e){return this.lineWrapping?(1+Math.max(0,Math.ceil((e-this.lineLength)/Math.max(1,this.lineLength-5))))*this.lineHeight:this.lineHeight}setDoc(e){return this.doc=e,this}mustRefreshForWrapping(e){return To.indexOf(e)>-1!=this.lineWrapping}mustRefreshForHeights(e){let t=!1;for(let r=0;r<e.length;r++){let s=e[r];s<0?r++:this.heightSamples[Math.floor(s*10)]||(t=!0,this.heightSamples[Math.floor(s*10)]=!0)}return t}refresh(e,t,r,s,n,o){let l=To.indexOf(e)>-1,a=Math.abs(t-this.lineHeight)>.3||this.lineWrapping!=l||Math.abs(r-this.charWidth)>.1;if(this.lineWrapping=l,this.lineHeight=t,this.charWidth=r,this.textHeight=s,this.lineLength=n,a){this.heightSamples={};for(let u=0;u<o.length;u++){let c=o[u];c<0?u++:this.heightSamples[Math.floor(c*10)]=!0}}return a}}class qh{constructor(e,t){this.from=e,this.heights=t,this.index=0}get more(){return this.index<this.heights.length}}class Ge{constructor(e,t,r,s,n){this.from=e,this.length=t,this.top=r,this.height=s,this._content=n}get type(){return typeof this._content=="number"?Ee.Text:Array.isArray(this._content)?this._content:this._content.type}get to(){return this.from+this.length}get bottom(){return this.top+this.height}get widget(){return this._content instanceof Nt?this._content.widget:null}get widgetLineBreaks(){return typeof this._content=="number"?this._content:0}join(e){let t=(Array.isArray(this._content)?this._content:[this]).concat(Array.isArray(e._content)?e._content:[e]);return new Ge(this.from,this.length+e.length,this.top,this.height+e.height,t)}}var de=(function(i){return i[i.ByPos=0]="ByPos",i[i.ByHeight=1]="ByHeight",i[i.ByPosNoHeight=2]="ByPosNoHeight",i})(de||(de={}));const Ir=.001;class Re{constructor(e,t,r=2){this.length=e,this.height=t,this.flags=r}get outdated(){return(this.flags&2)>0}set outdated(e){this.flags=(e?2:0)|this.flags&-3}setHeight(e){this.height!=e&&(Math.abs(this.height-e)>Ir&&(Ci=!0),this.height=e)}replace(e,t,r){return Re.of(r)}decomposeLeft(e,t){t.push(this)}decomposeRight(e,t){t.push(this)}applyChanges(e,t,r,s){let n=this,o=r.doc;for(let l=s.length-1;l>=0;l--){let{fromA:a,toA:u,fromB:c,toB:h}=s[l],d=n.lineAt(a,de.ByPosNoHeight,r.setDoc(t),0,0),p=d.to>=u?d:n.lineAt(u,de.ByPosNoHeight,r,0,0);for(h+=p.to-u,u=p.to;l>0&&d.from<=s[l-1].toA;)a=s[l-1].fromA,c=s[l-1].fromB,l--,a<d.from&&(d=n.lineAt(a,de.ByPosNoHeight,r,0,0));c+=d.from-a,a=d.from;let g=Kn.build(r.setDoc(o),e,c,h);n=Xr(n,n.replace(a,u,g))}return n.updateHeight(r,0)}static empty(){return new Pe(0,0,0)}static of(e){if(e.length==1)return e[0];let t=0,r=e.length,s=0,n=0;for(;;)if(t==r)if(s>n*2){let l=e[t-1];l.break?e.splice(--t,1,l.left,null,l.right):e.splice(--t,1,l.left,l.right),r+=1+l.break,s-=l.size}else if(n>s*2){let l=e[r];l.break?e.splice(r,1,l.left,null,l.right):e.splice(r,1,l.left,l.right),r+=2+l.break,n-=l.size}else break;else if(s<n){let l=e[t++];l&&(s+=l.size)}else{let l=e[--r];l&&(n+=l.size)}let o=0;return e[t-1]==null?(o=1,t--):e[t]==null&&(o=1,r++),new Kh(Re.of(e.slice(0,t)),o,Re.of(e.slice(r)))}}function Xr(i,e){return i==e?i:(i.constructor!=e.constructor&&(Ci=!0),e)}Re.prototype.size=1;const $h=ge.replace({});class Ba extends Re{constructor(e,t,r){super(e,t),this.deco=r,this.spaceAbove=0}mainBlock(e,t){return new Ge(t,this.length,e+this.spaceAbove,this.height-this.spaceAbove,this.deco||0)}blockAt(e,t,r,s){return this.spaceAbove&&e<r+this.spaceAbove?new Ge(s,0,r,this.spaceAbove,$h):this.mainBlock(r,s)}lineAt(e,t,r,s,n){let o=this.mainBlock(s,n);return this.spaceAbove?this.blockAt(0,r,s,n).join(o):o}forEachLine(e,t,r,s,n,o){e<=n+this.length&&t>=n&&o(this.lineAt(0,de.ByPos,r,s,n))}setMeasuredHeight(e){let t=e.heights[e.index++];t<0?(this.spaceAbove=-t,t=e.heights[e.index++]):this.spaceAbove=0,this.setHeight(t)}updateHeight(e,t=0,r=!1,s){return s&&s.from<=t&&s.more&&this.setMeasuredHeight(s),this.outdated=!1,this}toString(){return`block(${this.length})`}}class Pe extends Ba{constructor(e,t,r){super(e,t,null),this.collapsed=0,this.widgetHeight=0,this.breaks=0,this.spaceAbove=r}mainBlock(e,t){return new Ge(t,this.length,e+this.spaceAbove,this.height-this.spaceAbove,this.breaks)}replace(e,t,r){let s=r[0];return r.length==1&&(s instanceof Pe||s instanceof we&&s.flags&4)&&Math.abs(this.length-s.length)<10?(s instanceof we?s=new Pe(s.length,this.height,this.spaceAbove):s.height=this.height,this.outdated||(s.outdated=!1),s):Re.of(r)}updateHeight(e,t=0,r=!1,s){return s&&s.from<=t&&s.more?this.setMeasuredHeight(s):(r||this.outdated)&&(this.spaceAbove=0,this.setHeight(Math.max(this.widgetHeight,e.heightForLine(this.length-this.collapsed))+this.breaks*e.lineHeight)),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class we extends Re{constructor(e){super(e,0)}heightMetrics(e,t){let r=e.doc.lineAt(t).number,s=e.doc.lineAt(t+this.length).number,n=s-r+1,o,l=0;if(e.lineWrapping){let a=Math.min(this.height,e.lineHeight*n);o=a/n,this.length>n+1&&(l=(this.height-a)/(this.length-n-1))}else o=this.height/n;return{firstLine:r,lastLine:s,perLine:o,perChar:l}}blockAt(e,t,r,s){let{firstLine:n,lastLine:o,perLine:l,perChar:a}=this.heightMetrics(t,s);if(t.lineWrapping){let u=s+(e<t.lineHeight?0:Math.round(Math.max(0,Math.min(1,(e-r)/this.height))*this.length)),c=t.doc.lineAt(u),h=l+c.length*a,d=Math.max(r,e-h/2);return new Ge(c.from,c.length,d,h,0)}else{let u=Math.max(0,Math.min(o-n,Math.floor((e-r)/l))),{from:c,length:h}=t.doc.line(n+u);return new Ge(c,h,r+l*u,l,0)}}lineAt(e,t,r,s,n){if(t==de.ByHeight)return this.blockAt(e,r,s,n);if(t==de.ByPosNoHeight){let{from:p,to:g}=r.doc.lineAt(e);return new Ge(p,g-p,0,0,0)}let{firstLine:o,perLine:l,perChar:a}=this.heightMetrics(r,n),u=r.doc.lineAt(e),c=l+u.length*a,h=u.number-o,d=s+l*h+a*(u.from-n-h);return new Ge(u.from,u.length,Math.max(s,Math.min(d,s+this.height-c)),c,0)}forEachLine(e,t,r,s,n,o){e=Math.max(e,n),t=Math.min(t,n+this.length);let{firstLine:l,perLine:a,perChar:u}=this.heightMetrics(r,n);for(let c=e,h=s;c<=t;){let d=r.doc.lineAt(c);if(c==e){let g=d.number-l;h+=a*g+u*(e-n-g)}let p=a+u*d.length;o(new Ge(d.from,d.length,h,p,0)),h+=p,c=d.to+1}}replace(e,t,r){let s=this.length-t;if(s>0){let n=r[r.length-1];n instanceof we?r[r.length-1]=new we(n.length+s):r.push(null,new we(s-1))}if(e>0){let n=r[0];n instanceof we?r[0]=new we(e+n.length):r.unshift(new we(e-1),null)}return Re.of(r)}decomposeLeft(e,t){t.push(new we(e-1),null)}decomposeRight(e,t){t.push(null,new we(this.length-e-1))}updateHeight(e,t=0,r=!1,s){let n=t+this.length;if(s&&s.from<=t+this.length&&s.more){let o=[],l=Math.max(t,s.from),a=-1;for(s.from>t&&o.push(new we(s.from-t-1).updateHeight(e,t));l<=n&&s.more;){let c=e.doc.lineAt(l).length;o.length&&o.push(null);let h=s.heights[s.index++],d=0;h<0&&(d=-h,h=s.heights[s.index++]),a==-1?a=h:Math.abs(h-a)>=Ir&&(a=-2);let p=new Pe(c,h,d);p.outdated=!1,o.push(p),l+=c+1}l<=n&&o.push(null,new we(n-l).updateHeight(e,l));let u=Re.of(o);return(a<0||Math.abs(u.height-this.height)>=Ir||Math.abs(a-this.heightMetrics(e,t).perLine)>=Ir)&&(Ci=!0),Xr(this,u)}else(r||this.outdated)&&(this.setHeight(e.heightForGap(t,t+this.length)),this.outdated=!1);return this}toString(){return`gap(${this.length})`}}class Kh extends Re{constructor(e,t,r){super(e.length+t+r.length,e.height+r.height,t|(e.outdated||r.outdated?2:0)),this.left=e,this.right=r,this.size=e.size+r.size}get break(){return this.flags&1}blockAt(e,t,r,s){let n=r+this.left.height;return e<n?this.left.blockAt(e,t,r,s):this.right.blockAt(e,t,n,s+this.left.length+this.break)}lineAt(e,t,r,s,n){let o=s+this.left.height,l=n+this.left.length+this.break,a=t==de.ByHeight?e<o:e<l,u=a?this.left.lineAt(e,t,r,s,n):this.right.lineAt(e,t,r,o,l);if(this.break||(a?u.to<l:u.from>l))return u;let c=t==de.ByPosNoHeight?de.ByPosNoHeight:de.ByPos;return a?u.join(this.right.lineAt(l,c,r,o,l)):this.left.lineAt(l,c,r,s,n).join(u)}forEachLine(e,t,r,s,n,o){let l=s+this.left.height,a=n+this.left.length+this.break;if(this.break)e<a&&this.left.forEachLine(e,t,r,s,n,o),t>=a&&this.right.forEachLine(e,t,r,l,a,o);else{let u=this.lineAt(a,de.ByPos,r,s,n);e<u.from&&this.left.forEachLine(e,u.from-1,r,s,n,o),u.to>=e&&u.from<=t&&o(u),t>u.to&&this.right.forEachLine(u.to+1,t,r,l,a,o)}}replace(e,t,r){let s=this.left.length+this.break;if(t<s)return this.balanced(this.left.replace(e,t,r),this.right);if(e>this.left.length)return this.balanced(this.left,this.right.replace(e-s,t-s,r));let n=[];e>0&&this.decomposeLeft(e,n);let o=n.length;for(let l of r)n.push(l);if(e>0&&Po(n,o-1),t<this.length){let l=n.length;this.decomposeRight(t,n),Po(n,l)}return Re.of(n)}decomposeLeft(e,t){let r=this.left.length;if(e<=r)return this.left.decomposeLeft(e,t);t.push(this.left),this.break&&(r++,e>=r&&t.push(null)),e>r&&this.right.decomposeLeft(e-r,t)}decomposeRight(e,t){let r=this.left.length,s=r+this.break;if(e>=s)return this.right.decomposeRight(e-s,t);e<r&&this.left.decomposeRight(e,t),this.break&&e<s&&t.push(null),t.push(this.right)}balanced(e,t){return e.size>2*t.size||t.size>2*e.size?Re.of(this.break?[e,null,t]:[e,t]):(this.left=Xr(this.left,e),this.right=Xr(this.right,t),this.setHeight(e.height+t.height),this.outdated=e.outdated||t.outdated,this.size=e.size+t.size,this.length=e.length+this.break+t.length,this)}updateHeight(e,t=0,r=!1,s){let{left:n,right:o}=this,l=t+n.length+this.break,a=null;return s&&s.from<=t+n.length&&s.more?a=n=n.updateHeight(e,t,r,s):n.updateHeight(e,t,r),s&&s.from<=l+o.length&&s.more?a=o=o.updateHeight(e,l,r,s):o.updateHeight(e,l,r),a?this.balanced(n,o):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function Po(i,e){let t,r;i[e]==null&&(t=i[e-1])instanceof we&&(r=i[e+1])instanceof we&&i.splice(e-1,3,new we(t.length+1+r.length))}const Uh=5;class Kn{constructor(e,t){this.pos=e,this.oracle=t,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=e}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(e,t){if(this.lineStart>-1){let r=Math.min(t,this.lineEnd),s=this.nodes[this.nodes.length-1];s instanceof Pe?s.length+=r-this.pos:(r>this.pos||!this.isCovered)&&this.nodes.push(new Pe(r-this.pos,-1,0)),this.writtenTo=r,t>r&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=t}point(e,t,r){if(e<t||r.heightRelevant){let s=r.widget?r.widget.estimatedHeight:0,n=r.widget?r.widget.lineBreaks:0;s<0&&(s=this.oracle.lineHeight);let o=t-e;r.block?this.addBlock(new Ba(o,s,r)):(o||n||s>=Uh)&&this.addLineDeco(s,n,o)}else t>e&&this.span(e,t);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:e,to:t}=this.oracle.doc.lineAt(this.pos);this.lineStart=e,this.lineEnd=t,this.writtenTo<e&&((this.writtenTo<e-1||this.nodes[this.nodes.length-1]==null)&&this.nodes.push(this.blankContent(this.writtenTo,e-1)),this.nodes.push(null)),this.pos>e&&this.nodes.push(new Pe(this.pos-e,-1,0)),this.writtenTo=this.pos}blankContent(e,t){let r=new we(t-e);return this.oracle.doc.lineAt(e).to==t&&(r.flags|=4),r}ensureLine(){this.enterLine();let e=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(e instanceof Pe)return e;let t=new Pe(0,-1,0);return this.nodes.push(t),t}addBlock(e){this.enterLine();let t=e.deco;t&&t.startSide>0&&!this.isCovered&&this.ensureLine(),this.nodes.push(e),this.writtenTo=this.pos=this.pos+e.length,t&&t.endSide>0&&(this.covering=e)}addLineDeco(e,t,r){let s=this.ensureLine();s.length+=r,s.collapsed+=r,s.widgetHeight=Math.max(s.widgetHeight,e),s.breaks+=t,this.writtenTo=this.pos=this.pos+r}finish(e){let t=this.nodes.length==0?null:this.nodes[this.nodes.length-1];this.lineStart>-1&&!(t instanceof Pe)&&!this.isCovered?this.nodes.push(new Pe(0,-1,0)):(this.writtenTo<this.pos||t==null)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos));let r=e;for(let s of this.nodes)s instanceof Pe&&s.updateHeight(this.oracle,r),r+=s?s.length:1;return this.nodes}static build(e,t,r,s){let n=new Kn(r,e);return Se.spans(t,r,s,n,0),n.finish(r)}}function Qh(i,e,t){let r=new Jh;return Se.compare(i,e,t,r,0),r.changes}class Jh{constructor(){this.changes=[]}compareRange(){}comparePoint(e,t,r,s){(e<t||r&&r.heightRelevant||s&&s.heightRelevant)&&hi(e,t,this.changes,5)}}function Yh(i,e){let t=i.getBoundingClientRect(),r=i.ownerDocument,s=r.defaultView||window,n=Math.max(0,t.left),o=Math.min(s.innerWidth,t.right),l=Math.max(0,t.top),a=Math.min(s.innerHeight,t.bottom);for(let u=i.parentNode;u&&u!=r.body;)if(u.nodeType==1){let c=u,h=window.getComputedStyle(c);if((c.scrollHeight>c.clientHeight||c.scrollWidth>c.clientWidth)&&h.overflow!="visible"){let d=c.getBoundingClientRect();n=Math.max(n,d.left),o=Math.min(o,d.right),l=Math.max(l,d.top),a=Math.min(u==i.parentNode?s.innerHeight:a,d.bottom)}u=h.position=="absolute"||h.position=="fixed"?c.offsetParent:c.parentNode}else if(u.nodeType==11)u=u.host;else break;return{left:n-t.left,right:Math.max(n,o)-t.left,top:l-(t.top+e),bottom:Math.max(l,a)-(t.top+e)}}function Gh(i){let e=i.getBoundingClientRect(),t=i.ownerDocument.defaultView||window;return e.left<t.innerWidth&&e.right>0&&e.top<t.innerHeight&&e.bottom>0}function Xh(i,e){let t=i.getBoundingClientRect();return{left:0,right:t.right-t.left,top:e,bottom:t.bottom-(t.top+e)}}class Vs{constructor(e,t,r,s){this.from=e,this.to=t,this.size=r,this.displaySize=s}static same(e,t){if(e.length!=t.length)return!1;for(let r=0;r<e.length;r++){let s=e[r],n=t[r];if(s.from!=n.from||s.to!=n.to||s.size!=n.size)return!1}return!0}draw(e,t){return ge.replace({widget:new Zh(this.displaySize*(t?e.scaleY:e.scaleX),t)}).range(this.from,this.to)}}class Zh extends zt{constructor(e,t){super(),this.size=e,this.vertical=t}eq(e){return e.size==this.size&&e.vertical==this.vertical}toDOM(){let e=document.createElement("div");return this.vertical?e.style.height=this.size+"px":(e.style.width=this.size+"px",e.style.height="2px",e.style.display="inline-block"),e}get estimatedHeight(){return this.vertical?this.size:-1}}class jo{constructor(e){this.state=e,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.scrollTop=0,this.scrolledToBottom=!1,this.scaleX=1,this.scaleY=1,this.scrollAnchorPos=0,this.scrollAnchorHeight=-1,this.scaler=No,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.defaultTextDirection=ye.LTR,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1;let t=e.facet(Vn).some(r=>typeof r!="function"&&r.class=="cm-lineWrapping");this.heightOracle=new Vh(t),this.stateDeco=_o(e),this.heightMap=Re.empty().applyChanges(this.stateDeco,Ze.empty,this.heightOracle.setDoc(e.doc),[new We(0,0,0,e.doc.length)]);for(let r=0;r<2&&(this.viewport=this.getViewport(0,null),!!this.updateForViewport());r++);this.updateViewportLines(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=ge.set(this.lineGaps.map(r=>r.draw(this,!1))),this.computeVisibleRanges()}updateForViewport(){let e=[this.viewport],{main:t}=this.state.selection;for(let r=0;r<=1;r++){let s=r?t.head:t.anchor;if(!e.some(({from:n,to:o})=>s>=n&&s<=o)){let{from:n,to:o}=this.lineBlockAt(s);e.push(new Or(n,o))}}return this.viewports=e.sort((r,s)=>r.from-s.from),this.updateScaler()}updateScaler(){let e=this.scaler;return this.scaler=this.heightMap.height<=7e6?No:new Un(this.heightOracle,this.heightMap,this.viewports),e.eq(this.scaler)?0:2}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.heightOracle.setDoc(this.state.doc),0,0,e=>{this.viewportLines.push(Mi(e,this.scaler))})}update(e,t=null){this.state=e.state;let r=this.stateDeco;this.stateDeco=_o(this.state);let s=e.changedRanges,n=We.extendWithRanges(s,Qh(r,this.stateDeco,e?e.changes:Fl.empty(this.state.doc.length))),o=this.heightMap.height,l=this.scrolledToBottom?null:this.scrollAnchorAt(this.scrollTop);Lo(),this.heightMap=this.heightMap.applyChanges(this.stateDeco,e.startState.doc,this.heightOracle.setDoc(this.state.doc),n),(this.heightMap.height!=o||Ci)&&(e.flags|=2),l?(this.scrollAnchorPos=e.changes.mapPos(l.from,-1),this.scrollAnchorHeight=l.top):(this.scrollAnchorPos=-1,this.scrollAnchorHeight=o);let a=n.length?this.mapViewport(this.viewport,e.changes):this.viewport;(t&&(t.range.head<a.from||t.range.head>a.to)||!this.viewportIsAppropriate(a))&&(a=this.getViewport(0,t));let u=a.from!=this.viewport.from||a.to!=this.viewport.to;this.viewport=a,e.flags|=this.updateForViewport(),(u||!e.changes.empty||e.flags&2)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,e.changes))),e.flags|=this.computeVisibleRanges(e.changes),t&&(this.scrollTarget=t),!this.mustEnforceCursorAssoc&&(e.selectionSet||e.focusChanged)&&e.view.lineWrapping&&e.state.selection.main.empty&&e.state.selection.main.assoc&&!e.state.facet(na)&&(this.mustEnforceCursorAssoc=!0)}measure(e){let t=e.contentDOM,r=window.getComputedStyle(t),s=this.heightOracle,n=r.whiteSpace;this.defaultTextDirection=r.direction=="rtl"?ye.RTL:ye.LTR;let o=this.heightOracle.mustRefreshForWrapping(n)||this.mustMeasureContent,l=t.getBoundingClientRect(),a=o||this.mustMeasureContent||this.contentDOMHeight!=l.height;this.contentDOMHeight=l.height,this.mustMeasureContent=!1;let u=0,c=0;if(l.width&&l.height){let{scaleX:B,scaleY:y}=Hl(t,l);(B>.005&&Math.abs(this.scaleX-B)>.005||y>.005&&Math.abs(this.scaleY-y)>.005)&&(this.scaleX=B,this.scaleY=y,u|=16,o=a=!0)}let h=(parseInt(r.paddingTop)||0)*this.scaleY,d=(parseInt(r.paddingBottom)||0)*this.scaleY;(this.paddingTop!=h||this.paddingBottom!=d)&&(this.paddingTop=h,this.paddingBottom=d,u|=18),this.editorWidth!=e.scrollDOM.clientWidth&&(s.lineWrapping&&(a=!0),this.editorWidth=e.scrollDOM.clientWidth,u|=16);let p=e.scrollDOM.scrollTop*this.scaleY;this.scrollTop!=p&&(this.scrollAnchorHeight=-1,this.scrollTop=p),this.scrolledToBottom=ql(e.scrollDOM);let g=(this.printing?Xh:Yh)(t,this.paddingTop),f=g.top-this.pixelViewport.top,m=g.bottom-this.pixelViewport.bottom;this.pixelViewport=g;let D=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(D!=this.inView&&(this.inView=D,D&&(a=!0)),!this.inView&&!this.scrollTarget&&!Gh(e.dom))return 0;let x=l.width;if((this.contentDOMWidth!=x||this.editorHeight!=e.scrollDOM.clientHeight)&&(this.contentDOMWidth=l.width,this.editorHeight=e.scrollDOM.clientHeight,u|=16),a){let B=e.docView.measureVisibleLineHeights(this.viewport);if(s.mustRefreshForHeights(B)&&(o=!0),o||s.lineWrapping&&Math.abs(x-this.contentDOMWidth)>s.charWidth){let{lineHeight:y,charWidth:E,textHeight:R}=e.docView.measureTextSize();o=y>0&&s.refresh(n,y,E,R,Math.max(5,x/E),B),o&&(e.docView.minWidth=0,u|=16)}f>0&&m>0?c=Math.max(f,m):f<0&&m<0&&(c=Math.min(f,m)),Lo();for(let y of this.viewports){let E=y.from==this.viewport.from?B:e.docView.measureVisibleLineHeights(y);this.heightMap=(o?Re.empty().applyChanges(this.stateDeco,Ze.empty,this.heightOracle,[new We(0,0,0,e.state.doc.length)]):this.heightMap).updateHeight(s,0,o,new qh(y.from,E))}Ci&&(u|=2)}let k=!this.viewportIsAppropriate(this.viewport,c)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return k&&(u&2&&(u|=this.updateScaler()),this.viewport=this.getViewport(c,this.scrollTarget),u|=this.updateForViewport()),(u&2||k)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(o?[]:this.lineGaps,e)),u|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,e.docView.enforceCursorAssoc()),u}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(e,t){let r=.5-Math.max(-.5,Math.min(.5,e/1e3/2)),s=this.heightMap,n=this.heightOracle,{visibleTop:o,visibleBottom:l}=this,a=new Or(s.lineAt(o-r*1e3,de.ByHeight,n,0,0).from,s.lineAt(l+(1-r)*1e3,de.ByHeight,n,0,0).to);if(t){let{head:u}=t.range;if(u<a.from||u>a.to){let c=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),h=s.lineAt(u,de.ByPos,n,0,0),d;t.y=="center"?d=(h.top+h.bottom)/2-c/2:t.y=="start"||t.y=="nearest"&&u<a.from?d=h.top:d=h.bottom-c,a=new Or(s.lineAt(d-1e3/2,de.ByHeight,n,0,0).from,s.lineAt(d+c+1e3/2,de.ByHeight,n,0,0).to)}}return a}mapViewport(e,t){let r=t.mapPos(e.from,-1),s=t.mapPos(e.to,1);return new Or(this.heightMap.lineAt(r,de.ByPos,this.heightOracle,0,0).from,this.heightMap.lineAt(s,de.ByPos,this.heightOracle,0,0).to)}viewportIsAppropriate({from:e,to:t},r=0){if(!this.inView)return!0;let{top:s}=this.heightMap.lineAt(e,de.ByPos,this.heightOracle,0,0),{bottom:n}=this.heightMap.lineAt(t,de.ByPos,this.heightOracle,0,0),{visibleTop:o,visibleBottom:l}=this;return(e==0||s<=o-Math.max(10,Math.min(-r,250)))&&(t==this.state.doc.length||n>=l+Math.max(10,Math.min(r,250)))&&s>o-2*1e3&&n<l+2*1e3}mapLineGaps(e,t){if(!e.length||t.empty)return e;let r=[];for(let s of e)t.touchesRange(s.from,s.to)||r.push(new Vs(t.mapPos(s.from),t.mapPos(s.to),s.size,s.displaySize));return r}ensureLineGaps(e,t){let r=this.heightOracle.lineWrapping,s=r?1e4:2e3,n=s>>1,o=s<<1;if(this.defaultTextDirection!=ye.LTR&&!r)return[];let l=[],a=(c,h,d,p)=>{if(h-c<n)return;let g=this.state.selection.main,f=[g.from];g.empty||f.push(g.to);for(let D of f)if(D>c&&D<h){a(c,D-10,d,p),a(D+10,h,d,p);return}let m=td(e,D=>D.from>=d.from&&D.to<=d.to&&Math.abs(D.from-c)<n&&Math.abs(D.to-h)<n&&!f.some(x=>D.from<x&&D.to>x));if(!m){if(h<d.to&&t&&r&&t.visibleRanges.some(k=>k.from<=h&&k.to>=h)){let k=t.moveToLineBoundary(X.cursor(h),!1,!0).head;k>c&&(h=k)}let D=this.gapSize(d,c,h,p),x=r||D<2e6?D:2e6;m=new Vs(c,h,D,x)}l.push(m)},u=c=>{if(c.length<o||c.type!=Ee.Text)return;let h=ed(c.from,c.to,this.stateDeco);if(h.total<o)return;let d=this.scrollTarget?this.scrollTarget.range.head:null,p,g;if(r){let f=s/this.heightOracle.lineLength*this.heightOracle.lineHeight,m,D;if(d!=null){let x=Tr(h,d),k=((this.visibleBottom-this.visibleTop)/2+f)/c.height;m=x-k,D=x+k}else m=(this.visibleTop-c.top-f)/c.height,D=(this.visibleBottom-c.top+f)/c.height;p=Rr(h,m),g=Rr(h,D)}else{let f=h.total*this.heightOracle.charWidth,m=s*this.heightOracle.charWidth,D=0;if(f>2e6)for(let E of e)E.from>=c.from&&E.from<c.to&&E.size!=E.displaySize&&E.from*this.heightOracle.charWidth+D<this.pixelViewport.left&&(D=E.size-E.displaySize);let x=this.pixelViewport.left+D,k=this.pixelViewport.right+D,B,y;if(d!=null){let E=Tr(h,d),R=((k-x)/2+m)/f;B=E-R,y=E+R}else B=(x-m)/f,y=(k+m)/f;p=Rr(h,B),g=Rr(h,y)}p>c.from&&a(c.from,p,c,h),g<c.to&&a(g,c.to,c,h)};for(let c of this.viewportLines)Array.isArray(c.type)?c.type.forEach(u):u(c);return l}gapSize(e,t,r,s){let n=Tr(s,r)-Tr(s,t);return this.heightOracle.lineWrapping?e.height*n:s.total*this.heightOracle.charWidth*n}updateLineGaps(e){Vs.same(e,this.lineGaps)||(this.lineGaps=e,this.lineGapDeco=ge.set(e.map(t=>t.draw(this,this.heightOracle.lineWrapping))))}computeVisibleRanges(e){let t=this.stateDeco;this.lineGaps.length&&(t=t.concat(this.lineGapDeco));let r=[];Se.spans(t,this.viewport.from,this.viewport.to,{span(n,o){r.push({from:n,to:o})},point(){}},20);let s=0;if(r.length!=this.visibleRanges.length)s=12;else for(let n=0;n<r.length&&!(s&8);n++){let o=this.visibleRanges[n],l=r[n];(o.from!=l.from||o.to!=l.to)&&(s|=4,e&&e.mapPos(o.from,-1)==l.from&&e.mapPos(o.to,1)==l.to||(s|=8))}return this.visibleRanges=r,s}lineBlockAt(e){return e>=this.viewport.from&&e<=this.viewport.to&&this.viewportLines.find(t=>t.from<=e&&t.to>=e)||Mi(this.heightMap.lineAt(e,de.ByPos,this.heightOracle,0,0),this.scaler)}lineBlockAtHeight(e){return e>=this.viewportLines[0].top&&e<=this.viewportLines[this.viewportLines.length-1].bottom&&this.viewportLines.find(t=>t.top<=e&&t.bottom>=e)||Mi(this.heightMap.lineAt(this.scaler.fromDOM(e),de.ByHeight,this.heightOracle,0,0),this.scaler)}scrollAnchorAt(e){let t=this.lineBlockAtHeight(e+8);return t.from>=this.viewport.from||this.viewportLines[0].top-e>200?t:this.viewportLines[0]}elementAtHeight(e){return Mi(this.heightMap.blockAt(this.scaler.fromDOM(e),this.heightOracle,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class Or{constructor(e,t){this.from=e,this.to=t}}function ed(i,e,t){let r=[],s=i,n=0;return Se.spans(t,i,e,{span(){},point(o,l){o>s&&(r.push({from:s,to:o}),n+=o-s),s=l}},20),s<e&&(r.push({from:s,to:e}),n+=e-s),{total:n,ranges:r}}function Rr({total:i,ranges:e},t){if(t<=0)return e[0].from;if(t>=1)return e[e.length-1].to;let r=Math.floor(i*t);for(let s=0;;s++){let{from:n,to:o}=e[s],l=o-n;if(r<=l)return n+r;r-=l}}function Tr(i,e){let t=0;for(let{from:r,to:s}of i.ranges){if(e<=s){t+=e-r;break}t+=s-r}return t/i.total}function td(i,e){for(let t of i)if(e(t))return t}const No={toDOM(i){return i},fromDOM(i){return i},scale:1,eq(i){return i==this}};function _o(i){let e=i.facet(ss).filter(r=>typeof r!="function"),t=i.facet(qn).filter(r=>typeof r!="function");return t.length&&e.push(Se.join(t)),e}class Un{constructor(e,t,r){let s=0,n=0,o=0;this.viewports=r.map(({from:l,to:a})=>{let u=t.lineAt(l,de.ByPos,e,0,0).top,c=t.lineAt(a,de.ByPos,e,0,0).bottom;return s+=c-u,{from:l,to:a,top:u,bottom:c,domTop:0,domBottom:0}}),this.scale=(7e6-s)/(t.height-s);for(let l of this.viewports)l.domTop=o+(l.top-n)*this.scale,o=l.domBottom=l.domTop+(l.bottom-l.top),n=l.bottom}toDOM(e){for(let t=0,r=0,s=0;;t++){let n=t<this.viewports.length?this.viewports[t]:null;if(!n||e<n.top)return s+(e-r)*this.scale;if(e<=n.bottom)return n.domTop+(e-n.top);r=n.bottom,s=n.domBottom}}fromDOM(e){for(let t=0,r=0,s=0;;t++){let n=t<this.viewports.length?this.viewports[t]:null;if(!n||e<n.domTop)return r+(e-s)/this.scale;if(e<=n.domBottom)return n.top+(e-n.domTop);r=n.bottom,s=n.domBottom}}eq(e){return e instanceof Un?this.scale==e.scale&&this.viewports.length==e.viewports.length&&this.viewports.every((t,r)=>t.from==e.viewports[r].from&&t.to==e.viewports[r].to):!1}}function Mi(i,e){if(e.scale==1)return i;let t=e.toDOM(i.top),r=e.toDOM(i.bottom);return new Ge(i.from,i.length,t,r-t,Array.isArray(i._content)?i._content.map(s=>Mi(s,e)):i._content)}const Lr=re.define({combine:i=>i.join(" ")}),bn=re.define({combine:i=>i.indexOf(!0)>-1}),An=pi.newName(),ka=pi.newName(),Ma=pi.newName(),Oa={"&light":"."+ka,"&dark":"."+Ma};function xn(i,e,t){return new pi(e,{finish(r){return/&/.test(r)?r.replace(/&\w*/,s=>{if(s=="&")return i;if(!t||!t[s])throw new RangeError(`Unsupported selector: ${s}`);return t[s]}):i+" "+r}})}const id=xn("."+An,{"&":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0,overflowAnchor:"none"},".cm-content":{margin:0,flexGrow:2,flexShrink:0,display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",minHeight:"100%",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere",flexShrink:1},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 6px"},".cm-layer":{position:"absolute",left:0,top:0,contain:"size style","& > *":{position:"absolute"}},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{pointerEvents:"none"},"&.cm-focused > .cm-scroller > .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{opacity:0},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{opacity:0},"100%":{}},".cm-cursor, .cm-dropCursor":{borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#ddd"},".cm-dropCursor":{position:"absolute"},"&.cm-focused > .cm-scroller > .cm-cursorLayer .cm-cursor":{display:"block"},".cm-iso":{unicodeBidi:"isolate"},".cm-announced":{position:"fixed",top:"-10000px"},"@media print":{".cm-announced":{display:"none"}},"&light .cm-activeLine":{backgroundColor:"#cceeff44"},"&dark .cm-activeLine":{backgroundColor:"#99eeff33"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-gutters":{flexShrink:0,display:"flex",height:"100%",boxSizing:"border-box",zIndex:200},".cm-gutters-before":{insetInlineStart:0},".cm-gutters-after":{insetInlineEnd:0},"&light .cm-gutters":{backgroundColor:"#f5f5f5",color:"#6c6c6c",border:"0px solid #ddd","&.cm-gutters-before":{borderRightWidth:"1px"},"&.cm-gutters-after":{borderLeftWidth:"1px"}},"&dark .cm-gutters":{backgroundColor:"#333338",color:"#ccc"},".cm-gutter":{display:"flex !important",flexDirection:"column",flexShrink:0,boxSizing:"border-box",minHeight:"100%",overflow:"hidden"},".cm-gutterElement":{boxSizing:"border-box"},".cm-lineNumbers .cm-gutterElement":{padding:"0 3px 0 5px",minWidth:"20px",textAlign:"right",whiteSpace:"nowrap"},"&light .cm-activeLineGutter":{backgroundColor:"#e2f2ff"},"&dark .cm-activeLineGutter":{backgroundColor:"#222227"},".cm-panels":{boxSizing:"border-box",position:"sticky",left:0,right:0,zIndex:300},"&light .cm-panels":{backgroundColor:"#f5f5f5",color:"black"},"&light .cm-panels-top":{borderBottom:"1px solid #ddd"},"&light .cm-panels-bottom":{borderTop:"1px solid #ddd"},"&dark .cm-panels":{backgroundColor:"#333338",color:"white"},".cm-dialog":{padding:"2px 19px 4px 6px",position:"relative","& label":{fontSize:"80%"}},".cm-dialog-close":{position:"absolute",top:"3px",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",fontSize:"14px",padding:"0"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",width:0,display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top",userSelect:"none"},".cm-highlightSpace":{backgroundImage:"radial-gradient(circle at 50% 55%, #aaa 20%, transparent 5%)",backgroundPosition:"center"},".cm-highlightTab":{backgroundImage:`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="20"><path stroke="%23888" stroke-width="1" fill="none" d="M1 10H196L190 5M190 15L196 10M197 4L197 16"/></svg>')`,backgroundSize:"auto 100%",backgroundPosition:"right 90%",backgroundRepeat:"no-repeat"},".cm-trailingSpace":{backgroundColor:"#ff332255"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},Oa),rd={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},qs=N.ie&&N.ie_version<=11;class sd{constructor(e){this.view=e,this.active=!1,this.editContext=null,this.selectionRange=new Pc,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.flushingAndroidKey=-1,this.lastChange=0,this.scrollTargets=[],this.intersection=null,this.resizeScroll=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.printQuery=null,this.parentCheck=-1,this.dom=e.contentDOM,this.observer=new MutationObserver(t=>{for(let r of t)this.queue.push(r);(N.ie&&N.ie_version<=11||N.ios&&e.composing)&&t.some(r=>r.type=="childList"&&r.removedNodes.length||r.type=="characterData"&&r.oldValue.length>r.target.nodeValue.length)?this.flushSoon():this.flush()}),window.EditContext&&N.android&&e.constructor.EDIT_CONTEXT!==!1&&!(N.chrome&&N.chrome_version<126)&&(this.editContext=new od(e),e.state.facet(dt)&&(e.contentDOM.editContext=this.editContext.editContext)),qs&&(this.onCharData=t=>{this.queue.push({target:t.target,type:"characterData",oldValue:t.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),this.onResize=this.onResize.bind(this),this.onPrint=this.onPrint.bind(this),this.onScroll=this.onScroll.bind(this),window.matchMedia&&(this.printQuery=window.matchMedia("print")),typeof ResizeObserver=="function"&&(this.resizeScroll=new ResizeObserver(()=>{var t;((t=this.view.docView)===null||t===void 0?void 0:t.lastUpdate)<Date.now()-75&&this.onResize()}),this.resizeScroll.observe(e.scrollDOM)),this.addWindowListeners(this.win=e.win),this.start(),typeof IntersectionObserver=="function"&&(this.intersection=new IntersectionObserver(t=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),t.length>0&&t[t.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))},{threshold:[0,.001]}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver(t=>{t.length>0&&t[t.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))},{})),this.listenForScroll(),this.readSelectionRange()}onScrollChanged(e){this.view.inputState.runHandlers("scroll",e),this.intersecting&&this.view.measure()}onScroll(e){this.intersecting&&this.flush(!1),this.editContext&&this.view.requestMeasure(this.editContext.measureReq),this.onScrollChanged(e)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout(()=>{this.resizeTimeout=-1,this.view.requestMeasure()},50))}onPrint(e){(e.type=="change"||!e.type)&&!e.matches||(this.view.viewState.printing=!0,this.view.measure(),setTimeout(()=>{this.view.viewState.printing=!1,this.view.requestMeasure()},500))}updateGaps(e){if(this.gapIntersection&&(e.length!=this.gaps.length||this.gaps.some((t,r)=>t!=e[r]))){this.gapIntersection.disconnect();for(let t of e)this.gapIntersection.observe(t);this.gaps=e}}onSelectionChange(e){let t=this.selectionChanged;if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:r}=this,s=this.selectionRange;if(r.state.facet(dt)?r.root.activeElement!=this.dom:!Li(this.dom,s))return;let n=s.anchorNode&&r.docView.tile.nearest(s.anchorNode);if(n&&n.isWidget()&&n.widget.ignoreEvent(e)){t||(this.selectionChanged=!1);return}(N.ie&&N.ie_version<=11||N.android&&N.chrome)&&!r.state.selection.main.empty&&s.focusNode&&ji(s.focusNode,s.focusOffset,s.anchorNode,s.anchorOffset)?this.flushSoon():this.flush(!1)}readSelectionRange(){let{view:e}=this,t=gi(e.root);if(!t)return!1;let r=N.safari&&e.root.nodeType==11&&e.root.activeElement==this.dom&&nd(this.view,t)||t;if(!r||this.selectionRange.eq(r))return!1;let s=Li(this.dom,r);return s&&!this.selectionChanged&&e.inputState.lastFocusTime>Date.now()-200&&e.inputState.lastTouchTime<Date.now()-300&&Nc(this.dom,r)?(this.view.inputState.lastFocusTime=0,e.docView.updateSelection(),!1):(this.selectionRange.setRange(r),s&&(this.selectionChanged=!0),!0)}setSelectionRange(e,t){this.selectionRange.set(e.node,e.offset,t.node,t.offset),this.selectionChanged=!1}clearSelectionRange(){this.selectionRange.set(null,0,null,0)}listenForScroll(){this.parentCheck=-1;let e=0,t=null;for(let r=this.dom;r;)if(r.nodeType==1)!t&&e<this.scrollTargets.length&&this.scrollTargets[e]==r?e++:t||(t=this.scrollTargets.slice(0,e)),t&&t.push(r),r=r.assignedSlot||r.parentNode;else if(r.nodeType==11)r=r.host;else break;if(e<this.scrollTargets.length&&!t&&(t=this.scrollTargets.slice(0,e)),t){for(let r of this.scrollTargets)r.removeEventListener("scroll",this.onScroll);for(let r of this.scrollTargets=t)r.addEventListener("scroll",this.onScroll)}}ignore(e){if(!this.active)return e();try{return this.stop(),e()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,rd),qs&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),qs&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(e,t){var r;if(!this.delayedAndroidKey){let s=()=>{let n=this.delayedAndroidKey;n&&(this.clearDelayedAndroidKey(),this.view.inputState.lastKeyCode=n.keyCode,this.view.inputState.lastKeyTime=Date.now(),!this.flush()&&n.force&&di(this.dom,n.key,n.keyCode))};this.flushingAndroidKey=this.view.win.requestAnimationFrame(s)}(!this.delayedAndroidKey||e=="Enter")&&(this.delayedAndroidKey={key:e,keyCode:t,force:this.lastChange<Date.now()-50||!!(!((r=this.delayedAndroidKey)===null||r===void 0)&&r.force)})}clearDelayedAndroidKey(){this.win.cancelAnimationFrame(this.flushingAndroidKey),this.delayedAndroidKey=null,this.flushingAndroidKey=-1}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=this.view.win.requestAnimationFrame(()=>{this.delayedFlush=-1,this.flush()}))}forceFlush(){this.delayedFlush>=0&&(this.view.win.cancelAnimationFrame(this.delayedFlush),this.delayedFlush=-1),this.flush()}pendingRecords(){for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}processRecords(){let e=this.pendingRecords();e.length&&(this.queue=[]);let t=-1,r=-1,s=!1;for(let n of e){let o=this.readMutation(n);o&&(o.typeOver&&(s=!0),t==-1?{from:t,to:r}=o:(t=Math.min(o.from,t),r=Math.max(o.to,r)))}return{from:t,to:r,typeOver:s}}readChange(){let{from:e,to:t,typeOver:r}=this.processRecords(),s=this.selectionChanged&&Li(this.dom,this.selectionRange);if(e<0&&!s)return null;e>-1&&(this.lastChange=Date.now()),this.view.inputState.lastFocusTime=0,this.selectionChanged=!1;let n=new Sh(this.view,e,t,r);return this.view.docView.domChanged={newSel:n.newSel?n.newSel.main:null},n}flush(e=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return!1;e&&this.readSelectionRange();let t=this.readChange();if(!t)return this.view.requestMeasure(),!1;let r=this.view.state,s=Ca(this.view,t);return this.view.state==r&&(t.domChanged||t.newSel&&!Gr(this.view.state.selection,t.newSel.main))&&this.view.update([]),s}readMutation(e){let t=this.view.docView.tile.nearest(e.target);if(!t||t.isWidget())return null;if(t.markDirty(e.type=="attributes"),e.type=="childList"){let r=Io(t,e.previousSibling||e.target.previousSibling,-1),s=Io(t,e.nextSibling||e.target.nextSibling,1);return{from:r?t.posAfter(r):t.posAtStart,to:s?t.posBefore(s):t.posAtEnd,typeOver:!1}}else return e.type=="characterData"?{from:t.posAtStart,to:t.posAtEnd,typeOver:e.target.nodeValue==e.oldValue}:null}setWindow(e){e!=this.win&&(this.removeWindowListeners(this.win),this.win=e,this.addWindowListeners(this.win))}addWindowListeners(e){e.addEventListener("resize",this.onResize),this.printQuery?this.printQuery.addEventListener?this.printQuery.addEventListener("change",this.onPrint):this.printQuery.addListener(this.onPrint):e.addEventListener("beforeprint",this.onPrint),e.addEventListener("scroll",this.onScroll),e.document.addEventListener("selectionchange",this.onSelectionChange)}removeWindowListeners(e){e.removeEventListener("scroll",this.onScroll),e.removeEventListener("resize",this.onResize),this.printQuery?this.printQuery.removeEventListener?this.printQuery.removeEventListener("change",this.onPrint):this.printQuery.removeListener(this.onPrint):e.removeEventListener("beforeprint",this.onPrint),e.document.removeEventListener("selectionchange",this.onSelectionChange)}update(e){this.editContext&&(this.editContext.update(e),e.startState.facet(dt)!=e.state.facet(dt)&&(e.view.contentDOM.editContext=e.state.facet(dt)?this.editContext.editContext:null))}destroy(){var e,t,r;this.stop(),(e=this.intersection)===null||e===void 0||e.disconnect(),(t=this.gapIntersection)===null||t===void 0||t.disconnect(),(r=this.resizeScroll)===null||r===void 0||r.disconnect();for(let s of this.scrollTargets)s.removeEventListener("scroll",this.onScroll);this.removeWindowListeners(this.win),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout),this.win.cancelAnimationFrame(this.delayedFlush),this.win.cancelAnimationFrame(this.flushingAndroidKey),this.editContext&&(this.view.contentDOM.editContext=null,this.editContext.destroy())}}function Io(i,e,t){for(;e;){let r=Ae.get(e);if(r&&r.parent==i)return r;let s=e.parentNode;e=s!=i.dom?s:t>0?e.nextSibling:e.previousSibling}return null}function zo(i,e){let t=e.startContainer,r=e.startOffset,s=e.endContainer,n=e.endOffset,o=i.docView.domAtPos(i.state.selection.main.anchor,1);return ji(o.node,o.offset,s,n)&&([t,r,s,n]=[s,n,t,r]),{anchorNode:t,anchorOffset:r,focusNode:s,focusOffset:n}}function nd(i,e){if(e.getComposedRanges){let s=e.getComposedRanges(i.root)[0];if(s)return zo(i,s)}let t=null;function r(s){s.preventDefault(),s.stopImmediatePropagation(),t=s.getTargetRanges()[0]}return i.contentDOM.addEventListener("beforeinput",r,!0),i.dom.ownerDocument.execCommand("indent"),i.contentDOM.removeEventListener("beforeinput",r,!0),t?zo(i,t):null}class od{constructor(e){this.from=0,this.to=0,this.pendingContextChange=null,this.handlers=Object.create(null),this.composing=null,this.resetRange(e.state);let t=this.editContext=new window.EditContext({text:e.state.doc.sliceString(this.from,this.to),selectionStart:this.toContextPos(Math.max(this.from,Math.min(this.to,e.state.selection.main.anchor))),selectionEnd:this.toContextPos(e.state.selection.main.head)});this.handlers.textupdate=r=>{let s=e.state.selection.main,{anchor:n,head:o}=s,l=this.toEditorPos(r.updateRangeStart),a=this.toEditorPos(r.updateRangeEnd);e.inputState.composing>=0&&!this.composing&&(this.composing={contextBase:r.updateRangeStart,editorBase:l,drifted:!1});let u=a-l>r.text.length;l==this.from&&n<this.from?l=n:a==this.to&&n>this.to&&(a=n);let c=ya(e.state.sliceDoc(l,a),r.text,(u?s.from:s.to)-l,u?"end":null);if(!c){let d=X.single(this.toEditorPos(r.selectionStart),this.toEditorPos(r.selectionEnd));Gr(d,s)||e.dispatch({selection:d,userEvent:"select"});return}let h={from:c.from+l,to:c.toA+l,insert:Ze.of(r.text.slice(c.from,c.toB).split(`
`))};if((N.mac||N.android)&&h.from==o-1&&/^\. ?$/.test(r.text)&&e.contentDOM.getAttribute("autocorrect")=="off"&&(h={from:l,to:a,insert:Ze.of([r.text.replace("."," ")])}),this.pendingContextChange=h,!e.state.readOnly){let d=this.to-this.from+(h.to-h.from+h.insert.length);$n(e,h,X.single(this.toEditorPos(r.selectionStart,d),this.toEditorPos(r.selectionEnd,d)))}this.pendingContextChange&&(this.revertPending(e.state),this.setSelection(e.state)),h.from<h.to&&!h.insert.length&&e.inputState.composing>=0&&!/[\\p{Alphabetic}\\p{Number}_]/.test(t.text.slice(Math.max(0,r.updateRangeStart-1),Math.min(t.text.length,r.updateRangeStart+1)))&&this.handlers.compositionend(r)},this.handlers.characterboundsupdate=r=>{let s=[],n=null;for(let o=this.toEditorPos(r.rangeStart),l=this.toEditorPos(r.rangeEnd);o<l;o++){let a=e.coordsForChar(o);n=a&&new DOMRect(a.left,a.top,a.right-a.left,a.bottom-a.top)||n||new DOMRect,s.push(n)}t.updateCharacterBounds(r.rangeStart,s)},this.handlers.textformatupdate=r=>{let s=[];for(let n of r.getTextFormats()){let o=n.underlineStyle,l=n.underlineThickness;if(!/none/i.test(o)&&!/none/i.test(l)){let a=this.toEditorPos(n.rangeStart),u=this.toEditorPos(n.rangeEnd);if(a<u){let c=`text-decoration: underline ${/^[a-z]/.test(o)?o+" ":o=="Dashed"?"dashed ":o=="Squiggle"?"wavy ":""}${/thin/i.test(l)?1:2}px`;s.push(ge.mark({attributes:{style:c}}).range(a,u))}}}e.dispatch({effects:la.of(ge.set(s))})},this.handlers.compositionstart=()=>{e.inputState.composing<0&&(e.inputState.composing=0,e.inputState.compositionFirstChange=!0)},this.handlers.compositionend=()=>{if(e.inputState.composing=-1,e.inputState.compositionFirstChange=null,this.composing){let{drifted:r}=this.composing;this.composing=null,r&&this.reset(e.state)}};for(let r in this.handlers)t.addEventListener(r,this.handlers[r]);this.measureReq={read:r=>{this.editContext.updateControlBounds(r.contentDOM.getBoundingClientRect());let s=gi(r.root);s&&s.rangeCount&&this.editContext.updateSelectionBounds(s.getRangeAt(0).getBoundingClientRect())}}}applyEdits(e){let t=0,r=!1,s=this.pendingContextChange;return e.changes.iterChanges((n,o,l,a,u)=>{if(r)return;let c=u.length-(o-n);if(s&&o>=s.to)if(s.from==n&&s.to==o&&s.insert.eq(u)){s=this.pendingContextChange=null,t+=c,this.to+=c;return}else s=null,this.revertPending(e.state);if(n+=t,o+=t,o<=this.from)this.from+=c,this.to+=c;else if(n<this.to){if(n<this.from||o>this.to||this.to-this.from+u.length>3e4){r=!0;return}this.editContext.updateText(this.toContextPos(n),this.toContextPos(o),u.toString()),this.to+=c}t+=c}),s&&!r&&this.revertPending(e.state),!r}update(e){let t=this.pendingContextChange,r=e.startState.selection.main;this.composing&&(this.composing.drifted||!e.changes.touchesRange(r.from,r.to)&&e.transactions.some(s=>!s.isUserEvent("input.type")&&s.changes.touchesRange(this.from,this.to)))?(this.composing.drifted=!0,this.composing.editorBase=e.changes.mapPos(this.composing.editorBase)):!this.applyEdits(e)||!this.rangeIsValid(e.state)?(this.pendingContextChange=null,this.reset(e.state)):(e.docChanged||e.selectionSet||t)&&this.setSelection(e.state),(e.geometryChanged||e.docChanged||e.selectionSet)&&e.view.requestMeasure(this.measureReq)}resetRange(e){let{head:t}=e.selection.main;this.from=Math.max(0,t-1e4),this.to=Math.min(e.doc.length,t+1e4)}reset(e){this.resetRange(e),this.editContext.updateText(0,this.editContext.text.length,e.doc.sliceString(this.from,this.to)),this.setSelection(e)}revertPending(e){let t=this.pendingContextChange;this.pendingContextChange=null,this.editContext.updateText(this.toContextPos(t.from),this.toContextPos(t.from+t.insert.length),e.doc.sliceString(t.from,t.to))}setSelection(e){let{main:t}=e.selection,r=this.toContextPos(Math.max(this.from,Math.min(this.to,t.anchor))),s=this.toContextPos(t.head);(this.editContext.selectionStart!=r||this.editContext.selectionEnd!=s)&&this.editContext.updateSelection(r,s)}rangeIsValid(e){let{head:t}=e.selection.main;return!(this.from>0&&t-this.from<500||this.to<e.doc.length&&this.to-t<500||this.to-this.from>1e4*3)}toEditorPos(e,t=this.to-this.from){e=Math.min(e,t);let r=this.composing;return r&&r.drifted?r.editorBase+(e-r.contextBase):e+this.from}toContextPos(e){let t=this.composing;return t&&t.drifted?t.contextBase+(e-t.editorBase):e-this.from}destroy(){for(let e in this.handlers)this.editContext.removeEventListener(e,this.handlers[e])}}class Z{get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return!!this.inputState&&this.inputState.composing>0}get compositionStarted(){return!!this.inputState&&this.inputState.composing>=0}get root(){return this._root}get win(){return this.dom.ownerDocument.defaultView||window}constructor(e={}){var t;this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.className="cm-announced",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),e.parent&&e.parent.appendChild(this.dom);let{dispatch:r}=e;this.dispatchTransactions=e.dispatchTransactions||r&&(s=>s.forEach(n=>r(n,this)))||(s=>this.update(s)),this.dispatch=this.dispatch.bind(this),this._root=e.root||jc(e.parent)||document,this.viewState=new jo(e.state||Dt.create(e)),e.scrollTo&&e.scrollTo.is(Br)&&(this.viewState.scrollTarget=e.scrollTo.value.clip(this.viewState.state)),this.plugins=this.state.facet(ui).map(s=>new _s(s));for(let s of this.plugins)s.update(this);this.observer=new sd(this),this.inputState=new Fh(this),this.inputState.ensureHandlers(this.plugins),this.docView=new xo(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),!((t=document.fonts)===null||t===void 0)&&t.ready&&document.fonts.ready.then(()=>{this.viewState.mustMeasureContent=!0,this.requestMeasure()})}dispatch(...e){let t=e.length==1&&e[0]instanceof Ju?e:e.length==1&&Array.isArray(e[0])?e[0]:[this.state.update(...e)];this.dispatchTransactions(t,this)}update(e){if(this.updateState!=0)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let t=!1,r=!1,s,n=this.state;for(let d of e){if(d.startState!=n)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");n=d.state}if(this.destroyed){this.viewState.state=n;return}let o=this.hasFocus,l=0,a=null;e.some(d=>d.annotation(wa))?(this.inputState.notifiedFocused=o,l=1):o!=this.inputState.notifiedFocused&&(this.inputState.notifiedFocused=o,a=Ea(n,o),a||(l=1));let u=this.observer.delayedAndroidKey,c=null;if(u?(this.observer.clearDelayedAndroidKey(),c=this.observer.readChange(),(c&&!this.state.doc.eq(n.doc)||!this.state.selection.eq(n.selection))&&(c=null)):this.observer.clear(),n.facet(Dt.phrases)!=this.state.facet(Dt.phrases))return this.setState(n);s=Qr.create(this,n,e),s.flags|=l;let h=this.viewState.scrollTarget;try{this.updateState=2;for(let d of e){if(h&&(h=h.map(d.changes)),d.scrollIntoView){let{main:p}=d.state.selection;h=new fi(p.empty?p:X.cursor(p.head,p.head>p.anchor?-1:1))}for(let p of d.effects)p.is(Br)&&(h=p.value.clip(this.state))}this.viewState.update(s,h),this.bidiCache=Zr.update(this.bidiCache,s.changes),s.empty||(this.updatePlugins(s),this.inputState.update(s)),t=this.docView.update(s),this.state.facet(Bi)!=this.styleModules&&this.mountStyles(),r=this.updateAttrs(),this.showAnnouncements(e),this.docView.updateSelection(t,e.some(d=>d.isUserEvent("select.pointer")))}finally{this.updateState=0}if(s.startState.facet(Lr)!=s.state.facet(Lr)&&(this.viewState.mustMeasureContent=!0),(t||r||h||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),t&&this.docViewUpdate(),!s.empty)for(let d of this.state.facet(gn))try{d(s)}catch(p){mt(this.state,p,"update listener")}(a||c)&&Promise.resolve().then(()=>{a&&this.state==a.startState&&this.dispatch(a),c&&!Ca(this,c)&&u.force&&di(this.contentDOM,u.key,u.keyCode)})}setState(e){if(this.updateState!=0)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed){this.viewState.state=e;return}this.updateState=2;let t=this.hasFocus;try{for(let r of this.plugins)r.destroy(this);this.viewState=new jo(e),this.plugins=e.facet(ui).map(r=>new _s(r)),this.pluginMap.clear();for(let r of this.plugins)r.update(this);this.docView.destroy(),this.docView=new xo(this),this.inputState.ensureHandlers(this.plugins),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}t&&this.focus(),this.requestMeasure()}updatePlugins(e){let t=e.startState.facet(ui),r=e.state.facet(ui);if(t!=r){let s=[];for(let n of r){let o=t.indexOf(n);if(o<0)s.push(new _s(n));else{let l=this.plugins[o];l.mustUpdate=e,s.push(l)}}for(let n of this.plugins)n.mustUpdate!=e&&n.destroy(this);this.plugins=s,this.pluginMap.clear()}else for(let s of this.plugins)s.mustUpdate=e;for(let s=0;s<this.plugins.length;s++)this.plugins[s].update(this);t!=r&&this.inputState.ensureHandlers(this.plugins)}docViewUpdate(){for(let e of this.plugins){let t=e.value;if(t&&t.docViewUpdate)try{t.docViewUpdate(this)}catch(r){mt(this.state,r,"doc view update listener")}}}measure(e=!0){if(this.destroyed)return;if(this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.observer.delayedAndroidKey){this.measureScheduled=-1,this.requestMeasure();return}this.measureScheduled=0,e&&this.observer.forceFlush();let t=null,r=this.scrollDOM,s=r.scrollTop*this.scaleY,{scrollAnchorPos:n,scrollAnchorHeight:o}=this.viewState;Math.abs(s-this.viewState.scrollTop)>1&&(o=-1),this.viewState.scrollAnchorHeight=-1;try{for(let l=0;;l++){if(o<0)if(ql(r))n=-1,o=this.viewState.heightMap.height;else{let p=this.viewState.scrollAnchorAt(s);n=p.from,o=p.top}this.updateState=1;let a=this.viewState.measure(this);if(!a&&!this.measureRequests.length&&this.viewState.scrollTarget==null)break;if(l>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let u=[];a&4||([this.measureRequests,u]=[u,this.measureRequests]);let c=u.map(p=>{try{return p.read(this)}catch(g){return mt(this.state,g),Wo}}),h=Qr.create(this,this.state,[]),d=!1;h.flags|=a,t?t.flags|=a:t=h,this.updateState=2,h.empty||(this.updatePlugins(h),this.inputState.update(h),this.updateAttrs(),d=this.docView.update(h),d&&this.docViewUpdate());for(let p=0;p<u.length;p++)if(c[p]!=Wo)try{let g=u[p];g.write&&g.write(c[p],this)}catch(g){mt(this.state,g)}if(d&&this.docView.updateSelection(!0),!h.viewportChanged&&this.measureRequests.length==0){if(this.viewState.editorHeight)if(this.viewState.scrollTarget){this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,o=-1;continue}else{let g=(n<0?this.viewState.heightMap.height:this.viewState.lineBlockAt(n).top)-o;if(g>1||g<-1){s=s+g,r.scrollTop=s/this.scaleY,o=-1;continue}}break}}}finally{this.updateState=0,this.measureScheduled=-1}if(t&&!t.empty)for(let l of this.state.facet(gn))l(t)}get themeClasses(){return An+" "+(this.state.facet(bn)?Ma:ka)+" "+this.state.facet(Lr)}updateAttrs(){let e=Ho(this,aa,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),t={spellcheck:"false",autocorrect:"off",autocapitalize:"off",writingsuggestions:"false",translate:"no",contenteditable:this.state.facet(dt)?"true":"false",class:"cm-content",style:`${N.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(t["aria-readonly"]="true"),Ho(this,Vn,t);let r=this.observer.ignore(()=>{let s=mo(this.contentDOM,this.contentAttrs,t),n=mo(this.dom,this.editorAttrs,e);return s||n});return this.editorAttrs=e,this.contentAttrs=t,r}showAnnouncements(e){let t=!0;for(let r of e)for(let s of r.effects)if(s.is(Z.announce)){t&&(this.announceDOM.textContent=""),t=!1;let n=this.announceDOM.appendChild(document.createElement("div"));n.textContent=s.value}}mountStyles(){this.styleModules=this.state.facet(Bi);let e=this.state.facet(Z.cspNonce);pi.mount(this.root,this.styleModules.concat(id).reverse(),e?{nonce:e}:void 0)}readMeasured(){if(this.updateState==2)throw new Error("Reading the editor layout isn't allowed during an update");this.updateState==0&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(e){if(this.measureScheduled<0&&(this.measureScheduled=this.win.requestAnimationFrame(()=>this.measure())),e){if(this.measureRequests.indexOf(e)>-1)return;if(e.key!=null){for(let t=0;t<this.measureRequests.length;t++)if(this.measureRequests[t].key===e.key){this.measureRequests[t]=e;return}}this.measureRequests.push(e)}}plugin(e){let t=this.pluginMap.get(e);return(t===void 0||t&&t.plugin!=e)&&this.pluginMap.set(e,t=this.plugins.find(r=>r.plugin==e)||null),t&&t.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}get scaleX(){return this.viewState.scaleX}get scaleY(){return this.viewState.scaleY}elementAtHeight(e){return this.readMeasured(),this.viewState.elementAtHeight(e)}lineBlockAtHeight(e){return this.readMeasured(),this.viewState.lineBlockAtHeight(e)}get viewportLineBlocks(){return this.viewState.viewportLines}lineBlockAt(e){return this.viewState.lineBlockAt(e)}get contentHeight(){return this.viewState.contentHeight}moveByChar(e,t,r){return Hs(this,e,So(this,e,t,r))}moveByGroup(e,t){return Hs(this,e,So(this,e,t,r=>Ch(this,e.head,r)))}visualLineSide(e,t){let r=this.bidiSpans(e),s=this.textDirectionAt(e.from),n=r[t?r.length-1:0];return X.cursor(n.side(t,s)+e.from,n.forward(!t,s)?1:-1)}moveToLineBoundary(e,t,r=!0){return Dh(this,e,t,r)}moveVertically(e,t,r){return Hs(this,e,yh(this,e,t,r))}domAtPos(e,t=1){return this.docView.domAtPos(e,t)}posAtDOM(e,t=0){return this.docView.posFromDOM(e,t)}posAtCoords(e,t=!0){this.readMeasured();let r=Cn(this,e,t);return r&&r.pos}posAndSideAtCoords(e,t=!0){return this.readMeasured(),Cn(this,e,t)}coordsAtPos(e,t=1){this.readMeasured();let r=this.docView.coordsAt(e,t);if(!r||r.left==r.right)return r;let s=this.state.doc.lineAt(e),n=this.bidiSpans(s),o=n[gt.find(n,e-s.from,-1,t)];return Hi(r,o.dir==ye.LTR==t>0)}coordsForChar(e){return this.readMeasured(),this.docView.coordsForChar(e)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.defaultTextDirection}textDirectionAt(e){return!this.state.facet(sa)||e<this.viewport.from||e>this.viewport.to?this.textDirection:(this.readMeasured(),this.docView.textDirectionAt(e))}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(e){if(e.length>ld)return Yl(e.length);let t=this.textDirectionAt(e.from),r;for(let n of this.bidiCache)if(n.from==e.from&&n.dir==t&&(n.fresh||Jl(n.isolates,r=yo(this,e))))return n.order;r||(r=yo(this,e));let s=qc(e.text,t,r);return this.bidiCache.push(new Zr(e.from,e.to,t,r,!0,s)),s}get hasFocus(){var e;return(this.dom.ownerDocument.hasFocus()||N.safari&&((e=this.inputState)===null||e===void 0?void 0:e.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore(()=>{Vl(this.contentDOM),this.docView.updateSelection()})}setRoot(e){this._root!=e&&(this._root=e,this.observer.setWindow((e.nodeType==9?e:e.ownerDocument).defaultView||window),this.mountStyles())}destroy(){this.root.activeElement==this.contentDOM&&this.contentDOM.blur();for(let e of this.plugins)e.destroy(this);this.plugins=[],this.inputState.destroy(),this.docView.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(e,t={}){return Br.of(new fi(typeof e=="number"?X.cursor(e):e,t.y,t.x,t.yMargin,t.xMargin))}scrollSnapshot(){let{scrollTop:e,scrollLeft:t}=this.scrollDOM,r=this.viewState.scrollAnchorAt(e);return Br.of(new fi(X.cursor(r.from),"start","start",r.top-e,t,!0))}setTabFocusMode(e){e==null?this.inputState.tabFocusMode=this.inputState.tabFocusMode<0?0:-1:typeof e=="boolean"?this.inputState.tabFocusMode=e?0:-1:this.inputState.tabFocusMode!=0&&(this.inputState.tabFocusMode=Date.now()+e)}static domEventHandlers(e){return He.define(()=>({}),{eventHandlers:e})}static domEventObservers(e){return He.define(()=>({}),{eventObservers:e})}static theme(e,t){let r=pi.newName(),s=[Lr.of(r),Bi.of(xn(`.${r}`,e))];return t&&t.dark&&s.push(bn.of(!0)),s}static baseTheme(e){return Ln.lowest(Bi.of(xn("."+An,e,Oa)))}static findFromDOM(e){var t;let r=e.querySelector(".cm-content"),s=r&&Ae.get(r)||Ae.get(e);return((t=s?.root)===null||t===void 0?void 0:t.view)||null}}Z.styleModule=Bi;Z.inputHandler=ia;Z.clipboardInputFilter=Wn;Z.clipboardOutputFilter=Hn;Z.scrollHandler=oa;Z.focusChangeEffect=ra;Z.perLineTextDirection=sa;Z.exceptionSink=ta;Z.updateListener=gn;Z.editable=dt;Z.mouseSelectionStyle=ea;Z.dragMovesSelection=Zl;Z.clickAddsSelectionRange=Xl;Z.decorations=ss;Z.blockWrappers=ua;Z.outerDecorations=qn;Z.atomicRanges=Qi;Z.bidiIsolatedRanges=ca;Z.scrollMargins=ha;Z.darkTheme=bn;Z.cspNonce=re.define({combine:i=>i.length?i[0]:""});Z.contentAttributes=Vn;Z.editorAttributes=aa;Z.lineWrapping=Z.contentAttributes.of({class:"cm-lineWrapping"});Z.announce=$i.define();const ld=4096,Wo={};class Zr{constructor(e,t,r,s,n,o){this.from=e,this.to=t,this.dir=r,this.isolates=s,this.fresh=n,this.order=o}static update(e,t){if(t.empty&&!e.some(n=>n.fresh))return e;let r=[],s=e.length?e[e.length-1].dir:ye.LTR;for(let n=Math.max(0,e.length-10);n<e.length;n++){let o=e[n];o.dir==s&&!t.touchesRange(o.from,o.to)&&r.push(new Zr(t.mapPos(o.from,1),t.mapPos(o.to,-1),o.dir,o.isolates,!1,o.order))}return r}}function Ho(i,e,t){for(let r=i.state.facet(e),s=r.length-1;s>=0;s--){let n=r[s],o=typeof n=="function"?n(i):n;o&&_n(o,t)}return t}const ad=N.mac?"mac":N.windows?"win":N.linux?"linux":"key";function ud(i,e){const t=i.split(/-(?!$)/);let r=t[t.length-1];r=="Space"&&(r=" ");let s,n,o,l;for(let a=0;a<t.length-1;++a){const u=t[a];if(/^(cmd|meta|m)$/i.test(u))l=!0;else if(/^a(lt)?$/i.test(u))s=!0;else if(/^(c|ctrl|control)$/i.test(u))n=!0;else if(/^s(hift)?$/i.test(u))o=!0;else if(/^mod$/i.test(u))e=="mac"?l=!0:n=!0;else throw new Error("Unrecognized modifier name: "+u)}return s&&(r="Alt-"+r),n&&(r="Ctrl-"+r),l&&(r="Meta-"+r),o&&(r="Shift-"+r),r}function Pr(i,e,t){return e.altKey&&(i="Alt-"+i),e.ctrlKey&&(i="Ctrl-"+i),e.metaKey&&(i="Meta-"+i),t!==!1&&e.shiftKey&&(i="Shift-"+i),i}const cd=Ln.default(Z.domEventHandlers({keydown(i,e){return pd(hd(e.state),i,e,"editor")}})),as=re.define({enables:cd}),Vo=new WeakMap;function hd(i){let e=i.facet(as),t=Vo.get(e);return t||Vo.set(e,t=fd(e.reduce((r,s)=>r.concat(s),[]))),t}let St=null;const dd=4e3;function fd(i,e=ad){let t=Object.create(null),r=Object.create(null),s=(o,l)=>{let a=r[o];if(a==null)r[o]=l;else if(a!=l)throw new Error("Key binding "+o+" is used both as a regular binding and as a multi-stroke prefix")},n=(o,l,a,u,c)=>{var h,d;let p=t[o]||(t[o]=Object.create(null)),g=l.split(/ (?!$)/).map(D=>ud(D,e));for(let D=1;D<g.length;D++){let x=g.slice(0,D).join(" ");s(x,!0),p[x]||(p[x]={preventDefault:!0,stopPropagation:!1,run:[k=>{let B=St={view:k,prefix:x,scope:o};return setTimeout(()=>{St==B&&(St=null)},dd),!0}]})}let f=g.join(" ");s(f,!1);let m=p[f]||(p[f]={preventDefault:!1,stopPropagation:!1,run:((d=(h=p._any)===null||h===void 0?void 0:h.run)===null||d===void 0?void 0:d.slice())||[]});a&&m.run.push(a),u&&(m.preventDefault=!0),c&&(m.stopPropagation=!0)};for(let o of i){let l=o.scope?o.scope.split(" "):["editor"];if(o.any)for(let u of l){let c=t[u]||(t[u]=Object.create(null));c._any||(c._any={preventDefault:!1,stopPropagation:!1,run:[]});let{any:h}=o;for(let d in c)c[d].run.push(p=>h(p,Sn))}let a=o[e]||o.key;if(a)for(let u of l)n(u,a,o.run,o.preventDefault,o.stopPropagation),o.shift&&n(u,"Shift-"+a,o.shift,o.preventDefault,o.stopPropagation)}return t}let Sn=null;function pd(i,e,t,r){Sn=e;let s=Gu(e),n=Bl(s,0),o=Xu(n)==s.length&&s!=" ",l="",a=!1,u=!1,c=!1;St&&St.view==t&&St.scope==r&&(l=St.prefix+" ",Aa.indexOf(e.keyCode)<0&&(u=!0,St=null));let h=new Set,d=m=>{if(m){for(let D of m.run)if(!h.has(D)&&(h.add(D),D(t)))return m.stopPropagation&&(c=!0),!0;m.preventDefault&&(m.stopPropagation&&(c=!0),u=!0)}return!1},p=i[r],g,f;return p&&(d(p[l+Pr(s,e,!o)])?a=!0:o&&(e.altKey||e.metaKey||e.ctrlKey)&&!(N.windows&&e.ctrlKey&&e.altKey)&&!(N.mac&&e.altKey&&!(e.ctrlKey||e.metaKey))&&(g=Zu[e.keyCode])&&g!=s?(d(p[l+Pr(g,e,!0)])||e.shiftKey&&(f=ec[e.keyCode])!=s&&f!=g&&d(p[l+Pr(f,e,!1)]))&&(a=!0):o&&e.shiftKey&&d(p[l+Pr(s,e,!0)])&&(a=!0),!a&&d(p._any)&&(a=!0)),u&&(a=!0),a&&c&&e.stopPropagation(),Sn=null,a}class Ji{constructor(e,t,r,s,n){this.className=e,this.left=t,this.top=r,this.width=s,this.height=n}draw(){let e=document.createElement("div");return e.className=this.className,this.adjust(e),e}update(e,t){return t.className!=this.className?!1:(this.adjust(e),!0)}adjust(e){e.style.left=this.left+"px",e.style.top=this.top+"px",this.width!=null&&(e.style.width=this.width+"px"),e.style.height=this.height+"px"}eq(e){return this.left==e.left&&this.top==e.top&&this.width==e.width&&this.height==e.height&&this.className==e.className}static forRange(e,t,r){if(r.empty){let s=e.coordsAtPos(r.head,r.assoc||1);if(!s)return[];let n=Ra(e);return[new Ji(t,s.left-n.left,s.top-n.top,null,s.bottom-s.top)]}else return gd(e,t,r)}}function Ra(i){let e=i.scrollDOM.getBoundingClientRect();return{left:(i.textDirection==ye.LTR?e.left:e.right-i.scrollDOM.clientWidth*i.scaleX)-i.scrollDOM.scrollLeft*i.scaleX,top:e.top-i.scrollDOM.scrollTop*i.scaleY}}function qo(i,e,t,r){let s=i.coordsAtPos(e,t*2);if(!s)return r;let n=i.dom.getBoundingClientRect(),o=(s.top+s.bottom)/2,l=i.posAtCoords({x:n.left+1,y:o}),a=i.posAtCoords({x:n.right-1,y:o});return l==null||a==null?r:{from:Math.max(r.from,Math.min(l,a)),to:Math.min(r.to,Math.max(l,a))}}function gd(i,e,t){if(t.to<=i.viewport.from||t.from>=i.viewport.to)return[];let r=Math.max(t.from,i.viewport.from),s=Math.min(t.to,i.viewport.to),n=i.textDirection==ye.LTR,o=i.contentDOM,l=o.getBoundingClientRect(),a=Ra(i),u=o.querySelector(".cm-line"),c=u&&window.getComputedStyle(u),h=l.left+(c?parseInt(c.paddingLeft)+Math.min(0,parseInt(c.textIndent)):0),d=l.right-(c?parseInt(c.paddingRight):0),p=Dn(i,r,1),g=Dn(i,s,-1),f=p.type==Ee.Text?p:null,m=g.type==Ee.Text?g:null;if(f&&(i.lineWrapping||p.widgetLineBreaks)&&(f=qo(i,r,1,f)),m&&(i.lineWrapping||g.widgetLineBreaks)&&(m=qo(i,s,-1,m)),f&&m&&f.from==m.from&&f.to==m.to)return x(k(t.from,t.to,f));{let y=f?k(t.from,null,f):B(p,!1),E=m?k(null,t.to,m):B(g,!0),R=[];return(f||p).to<(m||g).from-(f&&m?1:0)||p.widgetLineBreaks>1&&y.bottom+i.defaultLineHeight/2<E.top?R.push(D(h,y.bottom,d,E.top)):y.bottom<E.top&&i.elementAtHeight((y.bottom+E.top)/2).type==Ee.Text&&(y.bottom=E.top=(y.bottom+E.top)/2),x(y).concat(R).concat(x(E))}function D(y,E,R,z){return new Ji(e,y-a.left,E-a.top,R-y,z-E)}function x({top:y,bottom:E,horizontal:R}){let z=[];for(let S=0;S<R.length;S+=2)z.push(D(R[S],y,R[S+1],E));return z}function k(y,E,R){let z=1e9,S=-1e9,b=[];function F(j,H,q,_,ee){let O=i.coordsAtPos(j,j==R.to?-2:2),I=i.coordsAtPos(q,q==R.from?2:-2);!O||!I||(z=Math.min(O.top,I.top,z),S=Math.max(O.bottom,I.bottom,S),ee==ye.LTR?b.push(n&&H?h:O.left,n&&_?d:I.right):b.push(!n&&_?h:I.left,!n&&H?d:O.right))}let M=y??R.from,v=E??R.to;for(let j of i.visibleRanges)if(j.to>M&&j.from<v)for(let H=Math.max(j.from,M),q=Math.min(j.to,v);;){let _=i.state.doc.lineAt(H);for(let ee of i.bidiSpans(_)){let O=ee.from+_.from,I=ee.to+_.from;if(O>=q)break;I>H&&F(Math.max(O,H),y==null&&O<=M,Math.min(I,q),E==null&&I>=v,ee.dir)}if(H=_.to+1,H>=q)break}return b.length==0&&F(M,y==null,v,E==null,i.textDirection),{top:z,bottom:S,horizontal:b}}function B(y,E){let R=l.top+(E?y.top:y.bottom);return{top:R,bottom:R,horizontal:[]}}}function md(i,e){return i.constructor==e.constructor&&i.eq(e)}class Dd{constructor(e,t){this.view=e,this.layer=t,this.drawn=[],this.scaleX=1,this.scaleY=1,this.measureReq={read:this.measure.bind(this),write:this.draw.bind(this)},this.dom=e.scrollDOM.appendChild(document.createElement("div")),this.dom.classList.add("cm-layer"),t.above&&this.dom.classList.add("cm-layer-above"),t.class&&this.dom.classList.add(t.class),this.scale(),this.dom.setAttribute("aria-hidden","true"),this.setOrder(e.state),e.requestMeasure(this.measureReq),t.mount&&t.mount(this.dom,e)}update(e){e.startState.facet(zr)!=e.state.facet(zr)&&this.setOrder(e.state),(this.layer.update(e,this.dom)||e.geometryChanged)&&(this.scale(),e.view.requestMeasure(this.measureReq))}docViewUpdate(e){this.layer.updateOnDocViewUpdate!==!1&&e.requestMeasure(this.measureReq)}setOrder(e){let t=0,r=e.facet(zr);for(;t<r.length&&r[t]!=this.layer;)t++;this.dom.style.zIndex=String((this.layer.above?150:-1)-t)}measure(){return this.layer.markers(this.view)}scale(){let{scaleX:e,scaleY:t}=this.view;(e!=this.scaleX||t!=this.scaleY)&&(this.scaleX=e,this.scaleY=t,this.dom.style.transform=`scale(${1/e}, ${1/t})`)}draw(e){if(e.length!=this.drawn.length||e.some((t,r)=>!md(t,this.drawn[r]))){let t=this.dom.firstChild,r=0;for(let s of e)s.update&&t&&s.constructor&&this.drawn[r].constructor&&s.update(t,this.drawn[r])?(t=t.nextSibling,r++):this.dom.insertBefore(s.draw(),t);for(;t;){let s=t.nextSibling;t.remove(),t=s}this.drawn=e,N.safari&&N.safari_version>=26&&(this.dom.style.display=this.dom.firstChild?"":"none")}}destroy(){this.layer.destroy&&this.layer.destroy(this.dom,this.view),this.dom.remove()}}const zr=re.define();function Ta(i){return[He.define(e=>new Dd(e,i)),zr.of(i)]}const qi=re.define({combine(i){return jn(i,{cursorBlinkRate:1200,drawRangeCursor:!0},{cursorBlinkRate:(e,t)=>Math.min(e,t),drawRangeCursor:(e,t)=>e||t})}});function La(i={}){return[qi.of(i),Cd,yd,bd,na.of(!0)]}function Pa(i){return i.startState.facet(qi)!=i.state.facet(qi)}const Cd=Ta({above:!0,markers(i){let{state:e}=i,t=e.facet(qi),r=[];for(let s of e.selection.ranges){let n=s==e.selection.main;if(s.empty||t.drawRangeCursor){let o=n?"cm-cursor cm-cursor-primary":"cm-cursor cm-cursor-secondary",l=s.empty?s:X.cursor(s.head,s.head>s.anchor?-1:1);for(let a of Ji.forRange(i,o,l))r.push(a)}}return r},update(i,e){i.transactions.some(r=>r.selection)&&(e.style.animationName=e.style.animationName=="cm-blink"?"cm-blink2":"cm-blink");let t=Pa(i);return t&&$o(i.state,e),i.docChanged||i.selectionSet||t},mount(i,e){$o(e.state,i)},class:"cm-cursorLayer"});function $o(i,e){e.style.animationDuration=i.facet(qi).cursorBlinkRate+"ms"}const yd=Ta({above:!1,markers(i){return i.state.selection.ranges.map(e=>e.empty?[]:Ji.forRange(i,"cm-selectionBackground",e)).reduce((e,t)=>e.concat(t))},update(i,e){return i.docChanged||i.selectionSet||i.viewportChanged||Pa(i)},class:"cm-selectionLayer"}),bd=Ln.highest(Z.theme({".cm-line":{"& ::selection, &::selection":{backgroundColor:"transparent !important"},caretColor:"transparent !important"},".cm-content":{caretColor:"transparent !important","& :focus":{caretColor:"initial !important","&::selection, & ::selection":{backgroundColor:"Highlight !important"}}}})),ja=$i.define({map(i,e){return i==null?null:e.mapPos(i)}}),Oi=Yu.define({create(){return null},update(i,e){return i!=null&&(i=e.changes.mapPos(i)),e.effects.reduce((t,r)=>r.is(ja)?r.value:t,i)}}),Ad=He.fromClass(class{constructor(i){this.view=i,this.cursor=null,this.measureReq={read:this.readPos.bind(this),write:this.drawCursor.bind(this)}}update(i){var e;let t=i.state.field(Oi);t==null?this.cursor!=null&&((e=this.cursor)===null||e===void 0||e.remove(),this.cursor=null):(this.cursor||(this.cursor=this.view.scrollDOM.appendChild(document.createElement("div")),this.cursor.className="cm-dropCursor"),(i.startState.field(Oi)!=t||i.docChanged||i.geometryChanged)&&this.view.requestMeasure(this.measureReq))}readPos(){let{view:i}=this,e=i.state.field(Oi),t=e!=null&&i.coordsAtPos(e);if(!t)return null;let r=i.scrollDOM.getBoundingClientRect();return{left:t.left-r.left+i.scrollDOM.scrollLeft*i.scaleX,top:t.top-r.top+i.scrollDOM.scrollTop*i.scaleY,height:t.bottom-t.top}}drawCursor(i){if(this.cursor){let{scaleX:e,scaleY:t}=this.view;i?(this.cursor.style.left=i.left/e+"px",this.cursor.style.top=i.top/t+"px",this.cursor.style.height=i.height/t+"px"):this.cursor.style.left="-100000px"}}destroy(){this.cursor&&this.cursor.remove()}setDropPos(i){this.view.state.field(Oi)!=i&&this.view.dispatch({effects:ja.of(i)})}},{eventObservers:{dragover(i){this.setDropPos(this.view.posAtCoords({x:i.clientX,y:i.clientY}))},dragleave(i){(i.target==this.view.contentDOM||!this.view.contentDOM.contains(i.relatedTarget))&&this.setDropPos(null)},dragend(){this.setDropPos(null)},drop(){this.setDropPos(null)}}});function xd(){return[Oi,Ad]}function Ko(i,e,t,r,s){e.lastIndex=0;for(let n=i.iterRange(t,r),o=t,l;!n.next().done;o+=n.value.length)if(!n.lineBreak)for(;l=e.exec(n.value);)s(o+l.index,l)}function Sd(i,e){let t=i.visibleRanges;if(t.length==1&&t[0].from==i.viewport.from&&t[0].to==i.viewport.to)return t;let r=[];for(let{from:s,to:n}of t)s=Math.max(i.state.doc.lineAt(s).from,s-e),n=Math.min(i.state.doc.lineAt(n).to,n+e),r.length&&r[r.length-1].to>=s?r[r.length-1].to=n:r.push({from:s,to:n});return r}class vd{constructor(e){const{regexp:t,decoration:r,decorate:s,boundary:n,maxLength:o=1e3}=e;if(!t.global)throw new RangeError("The regular expression given to MatchDecorator should have its 'g' flag set");if(this.regexp=t,s)this.addMatch=(l,a,u,c)=>s(c,u,u+l[0].length,l,a);else if(typeof r=="function")this.addMatch=(l,a,u,c)=>{let h=r(l,a,u);h&&c(u,u+l[0].length,h)};else if(r)this.addMatch=(l,a,u,c)=>c(u,u+l[0].length,r);else throw new RangeError("Either 'decorate' or 'decoration' should be provided to MatchDecorator");this.boundary=n,this.maxLength=o}createDeco(e){let t=new tc,r=t.add.bind(t);for(let{from:s,to:n}of Sd(e,this.maxLength))Ko(e.state.doc,this.regexp,s,n,(o,l)=>this.addMatch(l,e,o,r));return t.finish()}updateDeco(e,t){let r=1e9,s=-1;return e.docChanged&&e.changes.iterChanges((n,o,l,a)=>{a>=e.view.viewport.from&&l<=e.view.viewport.to&&(r=Math.min(l,r),s=Math.max(a,s))}),e.viewportMoved||s-r>1e3?this.createDeco(e.view):s>-1?this.updateRange(e.view,t.map(e.changes),r,s):t}updateRange(e,t,r,s){for(let n of e.visibleRanges){let o=Math.max(n.from,r),l=Math.min(n.to,s);if(l>=o){let a=e.state.doc.lineAt(o),u=a.to<l?e.state.doc.lineAt(l):a,c=Math.max(n.from,a.from),h=Math.min(n.to,u.to);if(this.boundary){for(;o>a.from;o--)if(this.boundary.test(a.text[o-1-a.from])){c=o;break}for(;l<u.to;l++)if(this.boundary.test(u.text[l-u.from])){h=l;break}}let d=[],p,g=(f,m,D)=>d.push(D.range(f,m));if(a==u)for(this.regexp.lastIndex=c-a.from;(p=this.regexp.exec(a.text))&&p.index<h-a.from;)this.addMatch(p,e,p.index+a.from,g);else Ko(e.state.doc,this.regexp,c,h,(f,m)=>this.addMatch(m,e,f,g));t=t.update({filterFrom:c,filterTo:h,filter:(f,m)=>f<c||m>h,add:d})}}return t}}const vn=/x/.unicode!=null?"gu":"g",wd=new RegExp(`[\0-\b
--\u2028\u2029\uFEFF-]`,vn),Ed={0:"null",7:"bell",8:"backspace",10:"newline",11:"vertical tab",13:"carriage return",27:"escape",8203:"zero width space",8204:"zero width non-joiner",8205:"zero width joiner",8206:"left-to-right mark",8207:"right-to-left mark",8232:"line separator",8237:"left-to-right override",8238:"right-to-left override",8294:"left-to-right isolate",8295:"right-to-left isolate",8297:"pop directional isolate",8233:"paragraph separator",65279:"zero width no-break space",65532:"object replacement"};let $s=null;function Fd(){var i;if($s==null&&typeof document<"u"&&document.body){let e=document.body.style;$s=((i=e.tabSize)!==null&&i!==void 0?i:e.MozTabSize)!=null}return $s||!1}const Wr=re.define({combine(i){let e=jn(i,{render:null,specialChars:wd,addSpecialChars:null});return(e.replaceTabs=!Fd())&&(e.specialChars=new RegExp("	|"+e.specialChars.source,vn)),e.addSpecialChars&&(e.specialChars=new RegExp(e.specialChars.source+"|"+e.addSpecialChars.source,vn)),e}});function Na(i={}){return[Wr.of(i),Bd()]}let Uo=null;function Bd(){return Uo||(Uo=He.fromClass(class{constructor(i){this.view=i,this.decorations=ge.none,this.decorationCache=Object.create(null),this.decorator=this.makeDecorator(i.state.facet(Wr)),this.decorations=this.decorator.createDeco(i)}makeDecorator(i){return new vd({regexp:i.specialChars,decoration:(e,t,r)=>{let{doc:s}=t.state,n=Bl(e[0],0);if(n==9){let o=s.lineAt(r),l=t.state.tabSize,a=kl(o.text,l,r-o.from);return ge.replace({widget:new Rd((l-a%l)*this.view.defaultCharacterWidth/this.view.scaleX)})}return this.decorationCache[n]||(this.decorationCache[n]=ge.replace({widget:new Od(i,n)}))},boundary:i.replaceTabs?void 0:/[^]/})}update(i){let e=i.state.facet(Wr);i.startState.facet(Wr)!=e?(this.decorator=this.makeDecorator(e),this.decorations=this.decorator.createDeco(i.view)):this.decorations=this.decorator.updateDeco(i,this.decorations)}},{decorations:i=>i.decorations}))}const kd="";function Md(i){return i>=32?kd:i==10?"":String.fromCharCode(9216+i)}class Od extends zt{constructor(e,t){super(),this.options=e,this.code=t}eq(e){return e.code==this.code}toDOM(e){let t=Md(this.code),r=e.state.phrase("Control character")+" "+(Ed[this.code]||"0x"+this.code.toString(16)),s=this.options.render&&this.options.render(this.code,r,t);if(s)return s;let n=document.createElement("span");return n.textContent=t,n.title=r,n.setAttribute("aria-label",r),n.className="cm-specialChar",n}ignoreEvent(){return!1}}class Rd extends zt{constructor(e){super(),this.width=e}eq(e){return e.width==this.width}toDOM(){let e=document.createElement("span");return e.textContent="	",e.className="cm-tab",e.style.width=this.width+"px",e}ignoreEvent(){return!1}}function _a(){return Ld}const Td=ge.line({class:"cm-activeLine"}),Ld=He.fromClass(class{constructor(i){this.decorations=this.getDeco(i)}update(i){(i.docChanged||i.selectionSet)&&(this.decorations=this.getDeco(i.view))}getDeco(i){let e=-1,t=[];for(let r of i.state.selection.ranges){let s=i.lineBlockAt(r.head);s.from>e&&(t.push(Td.range(s.from)),e=s.from)}return ge.set(t)}},{decorations:i=>i.decorations});class Pd extends zt{constructor(e){super(),this.content=e}toDOM(e){let t=document.createElement("span");return t.className="cm-placeholder",t.style.pointerEvents="none",t.appendChild(typeof this.content=="string"?document.createTextNode(this.content):typeof this.content=="function"?this.content(e):this.content.cloneNode(!0)),t.setAttribute("aria-hidden","true"),t}coordsAt(e){let t=e.firstChild?Pi(e.firstChild):[];if(!t.length)return null;let r=window.getComputedStyle(e.parentNode),s=Hi(t[0],r.direction!="rtl"),n=parseInt(r.lineHeight);return s.bottom-s.top>n*1.5?{left:s.left,right:s.right,top:s.top,bottom:s.top+n}:s}ignoreEvent(){return!1}}function jd(i){let e=He.fromClass(class{constructor(t){this.view=t,this.placeholder=i?ge.set([ge.widget({widget:new Pd(i),side:1}).range(0)]):ge.none}get decorations(){return this.view.state.doc.length?ge.none:this.placeholder}},{decorations:t=>t.decorations});return typeof i=="string"?[e,Z.contentAttributes.of({"aria-placeholder":i})]:e}const wn=2e3;function Nd(i,e,t){let r=Math.min(e.line,t.line),s=Math.max(e.line,t.line),n=[];if(e.off>wn||t.off>wn||e.col<0||t.col<0){let o=Math.min(e.off,t.off),l=Math.max(e.off,t.off);for(let a=r;a<=s;a++){let u=i.doc.line(a);u.length<=l&&n.push(X.range(u.from+o,u.to+l))}}else{let o=Math.min(e.col,t.col),l=Math.max(e.col,t.col);for(let a=r;a<=s;a++){let u=i.doc.line(a),c=sn(u.text,o,i.tabSize,!0);if(c<0)n.push(X.cursor(u.to));else{let h=sn(u.text,l,i.tabSize);n.push(X.range(u.from+c,u.from+h))}}}return n}function _d(i,e){let t=i.coordsAtPos(i.viewport.from);return t?Math.round(Math.abs((t.left-e)/i.defaultCharacterWidth)):-1}function Qo(i,e){let t=i.posAtCoords({x:e.clientX,y:e.clientY},!1),r=i.state.doc.lineAt(t),s=t-r.from,n=s>wn?-1:s==r.length?_d(i,e.clientX):kl(r.text,i.state.tabSize,t-r.from);return{line:r.number,col:n,off:s}}function Id(i,e){let t=Qo(i,e),r=i.state.selection;return t?{update(s){if(s.docChanged){let n=s.changes.mapPos(s.startState.doc.line(t.line).from),o=s.state.doc.lineAt(n);t={line:o.number,col:t.col,off:Math.min(t.off,o.length)},r=r.map(s.changes)}},get(s,n,o){let l=Qo(i,s);if(!l)return r;let a=Nd(i.state,t,l);return a.length?o?X.create(a.concat(r.ranges)):X.create(a):r}}:null}function zd(i){let e=(t=>t.altKey&&t.button==0);return Z.mouseSelectionStyle.of((t,r)=>e(r)?Id(t,r):null)}const Wd={Alt:[18,i=>!!i.altKey],Control:[17,i=>!!i.ctrlKey],Shift:[16,i=>!!i.shiftKey],Meta:[91,i=>!!i.metaKey]},Hd={style:"cursor: crosshair"};function Vd(i={}){let[e,t]=Wd[i.key||"Alt"],r=He.fromClass(class{constructor(s){this.view=s,this.isDown=!1}set(s){this.isDown!=s&&(this.isDown=s,this.view.update([]))}},{eventObservers:{keydown(s){this.set(s.keyCode==e||t(s))},keyup(s){(s.keyCode==e||!t(s))&&this.set(!1)},mousemove(s){this.set(t(s))}}});return[r,Z.contentAttributes.of(s=>{var n;return!((n=s.plugin(r))===null||n===void 0)&&n.isDown?Hd:null})]}class Ft extends Pn{compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}eq(e){return!1}destroy(e){}}Ft.prototype.elementClass="";Ft.prototype.toDOM=void 0;Ft.prototype.mapMode=Ti.TrackBefore;Ft.prototype.startSide=Ft.prototype.endSide=-1;Ft.prototype.point=!0;const Hr=re.define(),qd=re.define(),Vr=re.define(),Jo=re.define({combine:i=>i.some(e=>e)});function $d(i){return[Kd]}const Kd=He.fromClass(class{constructor(i){this.view=i,this.domAfter=null,this.prevViewport=i.viewport,this.dom=document.createElement("div"),this.dom.className="cm-gutters cm-gutters-before",this.dom.setAttribute("aria-hidden","true"),this.dom.style.minHeight=this.view.contentHeight/this.view.scaleY+"px",this.gutters=i.state.facet(Vr).map(e=>new Go(i,e)),this.fixed=!i.state.facet(Jo);for(let e of this.gutters)e.config.side=="after"?this.getDOMAfter().appendChild(e.dom):this.dom.appendChild(e.dom);this.fixed&&(this.dom.style.position="sticky"),this.syncGutters(!1),i.scrollDOM.insertBefore(this.dom,i.contentDOM)}getDOMAfter(){return this.domAfter||(this.domAfter=document.createElement("div"),this.domAfter.className="cm-gutters cm-gutters-after",this.domAfter.setAttribute("aria-hidden","true"),this.domAfter.style.minHeight=this.view.contentHeight/this.view.scaleY+"px",this.domAfter.style.position=this.fixed?"sticky":"",this.view.scrollDOM.appendChild(this.domAfter)),this.domAfter}update(i){if(this.updateGutters(i)){let e=this.prevViewport,t=i.view.viewport,r=Math.min(e.to,t.to)-Math.max(e.from,t.from);this.syncGutters(r<(t.to-t.from)*.8)}if(i.geometryChanged){let e=this.view.contentHeight/this.view.scaleY+"px";this.dom.style.minHeight=e,this.domAfter&&(this.domAfter.style.minHeight=e)}this.view.state.facet(Jo)!=!this.fixed&&(this.fixed=!this.fixed,this.dom.style.position=this.fixed?"sticky":"",this.domAfter&&(this.domAfter.style.position=this.fixed?"sticky":"")),this.prevViewport=i.view.viewport}syncGutters(i){let e=this.dom.nextSibling;i&&(this.dom.remove(),this.domAfter&&this.domAfter.remove());let t=Se.iter(this.view.state.facet(Hr),this.view.viewport.from),r=[],s=this.gutters.map(n=>new Ud(n,this.view.viewport,-this.view.documentPadding.top));for(let n of this.view.viewportLineBlocks)if(r.length&&(r=[]),Array.isArray(n.type)){let o=!0;for(let l of n.type)if(l.type==Ee.Text&&o){En(t,r,l.from);for(let a of s)a.line(this.view,l,r);o=!1}else if(l.widget)for(let a of s)a.widget(this.view,l)}else if(n.type==Ee.Text){En(t,r,n.from);for(let o of s)o.line(this.view,n,r)}else if(n.widget)for(let o of s)o.widget(this.view,n);for(let n of s)n.finish();i&&(this.view.scrollDOM.insertBefore(this.dom,e),this.domAfter&&this.view.scrollDOM.appendChild(this.domAfter))}updateGutters(i){let e=i.startState.facet(Vr),t=i.state.facet(Vr),r=i.docChanged||i.heightChanged||i.viewportChanged||!Se.eq(i.startState.facet(Hr),i.state.facet(Hr),i.view.viewport.from,i.view.viewport.to);if(e==t)for(let s of this.gutters)s.update(i)&&(r=!0);else{r=!0;let s=[];for(let n of t){let o=e.indexOf(n);o<0?s.push(new Go(this.view,n)):(this.gutters[o].update(i),s.push(this.gutters[o]))}for(let n of this.gutters)n.dom.remove(),s.indexOf(n)<0&&n.destroy();for(let n of s)n.config.side=="after"?this.getDOMAfter().appendChild(n.dom):this.dom.appendChild(n.dom);this.gutters=s}return r}destroy(){for(let i of this.gutters)i.destroy();this.dom.remove(),this.domAfter&&this.domAfter.remove()}},{provide:i=>Z.scrollMargins.of(e=>{let t=e.plugin(i);if(!t||t.gutters.length==0||!t.fixed)return null;let r=t.dom.offsetWidth*e.scaleX,s=t.domAfter?t.domAfter.offsetWidth*e.scaleX:0;return e.textDirection==ye.LTR?{left:r,right:s}:{right:r,left:s}})});function Yo(i){return Array.isArray(i)?i:[i]}function En(i,e,t){for(;i.value&&i.from<=t;)i.from==t&&e.push(i.value),i.next()}class Ud{constructor(e,t,r){this.gutter=e,this.height=r,this.i=0,this.cursor=Se.iter(e.markers,t.from)}addElement(e,t,r){let{gutter:s}=this,n=(t.top-this.height)/e.scaleY,o=t.height/e.scaleY;if(this.i==s.elements.length){let l=new Ia(e,o,n,r);s.elements.push(l),s.dom.appendChild(l.dom)}else s.elements[this.i].update(e,o,n,r);this.height=t.bottom,this.i++}line(e,t,r){let s=[];En(this.cursor,s,t.from),r.length&&(s=s.concat(r));let n=this.gutter.config.lineMarker(e,t,s);n&&s.unshift(n);let o=this.gutter;s.length==0&&!o.config.renderEmptyElements||this.addElement(e,t,s)}widget(e,t){let r=this.gutter.config.widgetMarker(e,t.widget,t),s=r?[r]:null;for(let n of e.state.facet(qd)){let o=n(e,t.widget,t);o&&(s||(s=[])).push(o)}s&&this.addElement(e,t,s)}finish(){let e=this.gutter;for(;e.elements.length>this.i;){let t=e.elements.pop();e.dom.removeChild(t.dom),t.destroy()}}}class Go{constructor(e,t){this.view=e,this.config=t,this.elements=[],this.spacer=null,this.dom=document.createElement("div"),this.dom.className="cm-gutter"+(this.config.class?" "+this.config.class:"");for(let r in t.domEventHandlers)this.dom.addEventListener(r,s=>{let n=s.target,o;if(n!=this.dom&&this.dom.contains(n)){for(;n.parentNode!=this.dom;)n=n.parentNode;let a=n.getBoundingClientRect();o=(a.top+a.bottom)/2}else o=s.clientY;let l=e.lineBlockAtHeight(o-e.documentTop);t.domEventHandlers[r](e,l,s)&&s.preventDefault()});this.markers=Yo(t.markers(e)),t.initialSpacer&&(this.spacer=new Ia(e,0,0,[t.initialSpacer(e)]),this.dom.appendChild(this.spacer.dom),this.spacer.dom.style.cssText+="visibility: hidden; pointer-events: none")}update(e){let t=this.markers;if(this.markers=Yo(this.config.markers(e.view)),this.spacer&&this.config.updateSpacer){let s=this.config.updateSpacer(this.spacer.markers[0],e);s!=this.spacer.markers[0]&&this.spacer.update(e.view,0,0,[s])}let r=e.view.viewport;return!Se.eq(this.markers,t,r.from,r.to)||(this.config.lineMarkerChange?this.config.lineMarkerChange(e):!1)}destroy(){for(let e of this.elements)e.destroy()}}class Ia{constructor(e,t,r,s){this.height=-1,this.above=0,this.markers=[],this.dom=document.createElement("div"),this.dom.className="cm-gutterElement",this.update(e,t,r,s)}update(e,t,r,s){this.height!=t&&(this.height=t,this.dom.style.height=t+"px"),this.above!=r&&(this.dom.style.marginTop=(this.above=r)?r+"px":""),Qd(this.markers,s)||this.setMarkers(e,s)}setMarkers(e,t){let r="cm-gutterElement",s=this.dom.firstChild;for(let n=0,o=0;;){let l=o,a=n<t.length?t[n++]:null,u=!1;if(a){let c=a.elementClass;c&&(r+=" "+c);for(let h=o;h<this.markers.length;h++)if(this.markers[h].compare(a)){l=h,u=!0;break}}else l=this.markers.length;for(;o<l;){let c=this.markers[o++];if(c.toDOM){c.destroy(s);let h=s.nextSibling;s.remove(),s=h}}if(!a)break;a.toDOM&&(u?s=s.nextSibling:this.dom.insertBefore(a.toDOM(e),s)),u&&o++}this.dom.className=r,this.markers=t}destroy(){this.setMarkers(null,[])}}function Qd(i,e){if(i.length!=e.length)return!1;for(let t=0;t<i.length;t++)if(!i[t].compare(e[t]))return!1;return!0}const Jd=re.define(),Yd=re.define(),ci=re.define({combine(i){return jn(i,{formatNumber:String,domEventHandlers:{}},{domEventHandlers(e,t){let r=Object.assign({},e);for(let s in t){let n=r[s],o=t[s];r[s]=n?(l,a,u)=>n(l,a,u)||o(l,a,u):o}return r}})}});class Ks extends Ft{constructor(e){super(),this.number=e}eq(e){return this.number==e.number}toDOM(){return document.createTextNode(this.number)}}function Us(i,e){return i.state.facet(ci).formatNumber(e,i.state)}const Gd=Vr.compute([ci],i=>({class:"cm-lineNumbers",renderEmptyElements:!1,markers(e){return e.state.facet(Jd)},lineMarker(e,t,r){return r.some(s=>s.toDOM)?null:new Ks(Us(e,e.state.doc.lineAt(t.from).number))},widgetMarker:(e,t,r)=>{for(let s of e.state.facet(Yd)){let n=s(e,t,r);if(n)return n}return null},lineMarkerChange:e=>e.startState.facet(ci)!=e.state.facet(ci),initialSpacer(e){return new Ks(Us(e,Xo(e.state.doc.lines)))},updateSpacer(e,t){let r=Us(t.view,Xo(t.view.state.doc.lines));return r==e.number?e:new Ks(r)},domEventHandlers:i.facet(ci).domEventHandlers,side:"before"}));function za(i={}){return[ci.of(i),$d(),Gd]}function Xo(i){let e=9;for(;e<i;)e=e*10+9;return e}const Xd=new class extends Ft{constructor(){super(...arguments),this.elementClass="cm-activeLineGutter"}},Zd=Hr.compute(["selection"],i=>{let e=[],t=-1;for(let r of i.selection.ranges){let s=i.doc.lineAt(r.head).from;s>t&&(t=s,e.push(Xd.range(s)))}return Se.of(e)});function Wa(){return Zd}var Zo=function(e){e===void 0&&(e={});var{crosshairCursor:t=!1}=e,r=[];e.closeBracketsKeymap!==!1&&(r=r.concat(rc)),e.defaultKeymap!==!1&&(r=r.concat(Ml)),e.searchKeymap!==!1&&(r=r.concat(sc)),e.historyKeymap!==!1&&(r=r.concat(Ol)),e.foldKeymap!==!1&&(r=r.concat(nc)),e.completionKeymap!==!1&&(r=r.concat(oc)),e.lintKeymap!==!1&&(r=r.concat(lc));var s=[];return e.lineNumbers!==!1&&s.push(za()),e.highlightActiveLineGutter!==!1&&s.push(Wa()),e.highlightSpecialChars!==!1&&s.push(Na()),e.history!==!1&&s.push(Rl()),e.foldGutter!==!1&&s.push(ac()),e.drawSelection!==!1&&s.push(La()),e.dropCursor!==!1&&s.push(xd()),e.allowMultipleSelections!==!1&&s.push(Dt.allowMultipleSelections.of(!0)),e.indentOnInput!==!1&&s.push(Tl()),e.syntaxHighlighting!==!1&&s.push(Nn(Ll,{fallback:!0})),e.bracketMatching!==!1&&s.push(Pl()),e.closeBrackets!==!1&&s.push(jl()),e.autocompletion!==!1&&s.push(uc()),e.rectangularSelection!==!1&&s.push(zd()),t!==!1&&s.push(Vd()),e.highlightActiveLine!==!1&&s.push(_a()),e.highlightSelectionMatches!==!1&&s.push(Nl()),e.tabSize&&typeof e.tabSize=="number"&&s.push(cc.of(" ".repeat(e.tabSize))),s.concat([as.of(r.flat())]).filter(Boolean)},ef=Z.theme({"&":{backgroundColor:"#fff"}},{dark:!1}),tf=function(e){e===void 0&&(e={});var{indentWithTab:t=!0,editable:r=!0,readOnly:s=!1,theme:n="light",placeholder:o="",basicSetup:l=!0}=e,a=[];switch(t&&a.unshift(as.of([hc])),l&&(typeof l=="boolean"?a.unshift(Zo()):a.unshift(Zo(l))),o&&a.unshift(jd(o)),n){case"light":a.push(ef);break;case"dark":a.push(dc);break;case"none":break;default:a.push(n);break}return r===!1&&a.push(Z.editable.of(!1)),s&&a.push(Dt.readOnly.of(!0)),[...a]},rf=i=>({line:i.state.doc.lineAt(i.state.selection.main.from),lineCount:i.state.doc.lines,lineBreak:i.state.lineBreak,length:i.state.doc.length,readOnly:i.state.readOnly,tabSize:i.state.tabSize,selection:i.state.selection,selectionAsSingle:i.state.selection.asSingle().main,ranges:i.state.selection.ranges,selectionCode:i.state.sliceDoc(i.state.selection.main.from,i.state.selection.main.to),selections:i.state.selection.ranges.map(e=>i.state.sliceDoc(e.from,e.to)),selectedText:i.state.selection.ranges.some(e=>!e.empty)});class sf{constructor(e,t){this.timeLeftMS=void 0,this.timeoutMS=void 0,this.isCancelled=!1,this.isTimeExhausted=!1,this.callbacks=[],this.timeLeftMS=t,this.timeoutMS=t,this.callbacks.push(e)}tick(){if(!this.isCancelled&&!this.isTimeExhausted&&(this.timeLeftMS--,this.timeLeftMS<=0)){this.isTimeExhausted=!0;var e=this.callbacks.slice();this.callbacks.length=0,e.forEach(t=>{try{t()}catch(r){console.error("TimeoutLatch callback error:",r)}})}}cancel(){this.isCancelled=!0,this.callbacks.length=0}reset(){this.timeLeftMS=this.timeoutMS,this.isCancelled=!1,this.isTimeExhausted=!1}get isDone(){return this.isCancelled||this.isTimeExhausted}}class el{constructor(){this.interval=null,this.latches=new Set}add(e){this.latches.add(e),this.start()}remove(e){this.latches.delete(e),this.latches.size===0&&this.stop()}start(){this.interval===null&&(this.interval=setInterval(()=>{this.latches.forEach(e=>{e.tick(),e.isDone&&this.remove(e)})},1))}stop(){this.interval!==null&&(clearInterval(this.interval),this.interval=null)}}var Qs=null,nf=()=>typeof window>"u"?new el:(Qs||(Qs=new el),Qs),tl=El.define(),of=200,lf=[];function af(i){var{value:e,selection:t,onChange:r,onStatistics:s,onCreateEditor:n,onUpdate:o,extensions:l=lf,autoFocus:a,theme:u="light",height:c=null,minHeight:h=null,maxHeight:d=null,width:p=null,minWidth:g=null,maxWidth:f=null,placeholder:m="",editable:D=!0,readOnly:x=!1,indentWithTab:k=!0,basicSetup:B=!0,root:y,initialState:E}=i,[R,z]=L.useState(),[S,b]=L.useState(),[F,M]=L.useState(),v=L.useState(()=>({current:null}))[0],j=L.useState(()=>({current:null}))[0],H=Z.theme({"&":{height:c,minHeight:h,maxHeight:d,width:p,minWidth:g,maxWidth:f},"& .cm-scroller":{height:"100% !important"}}),q=Z.updateListener.of(O=>{if(O.docChanged&&typeof r=="function"&&!O.transactions.some(A=>A.annotation(tl))){v.current?v.current.reset():(v.current=new sf(()=>{if(j.current){var A=j.current;j.current=null,A()}v.current=null},of),nf().add(v.current));var I=O.state.doc,ae=I.toString();r(ae,O)}s&&s(rf(O))}),_=tf({theme:u,editable:D,readOnly:x,placeholder:m,indentWithTab:k,basicSetup:B}),ee=[q,H,..._];return o&&typeof o=="function"&&ee.push(Z.updateListener.of(o)),ee=ee.concat(l),L.useLayoutEffect(()=>{if(R&&!F){var O={doc:e,selection:t,extensions:ee},I=E?Dt.fromJSON(E.json,O,E.fields):Dt.create(O);if(M(I),!S){var ae=new Z({state:I,parent:R,root:y});b(ae),n&&n(ae,I)}}return()=>{S&&(M(void 0),b(void 0))}},[R,F]),L.useEffect(()=>{i.container&&z(i.container)},[i.container]),L.useEffect(()=>()=>{S&&(S.destroy(),b(void 0)),v.current&&(v.current.cancel(),v.current=null)},[S]),L.useEffect(()=>{a&&S&&S.focus()},[a,S]),L.useEffect(()=>{S&&S.dispatch({effects:$i.reconfigure.of(ee)})},[u,l,c,h,d,p,g,f,m,D,x,k,B,r,o]),L.useEffect(()=>{if(e!==void 0){var O=S?S.state.doc.toString():"";if(S&&e!==O){var I=v.current&&!v.current.isDone,ae=()=>{S&&e!==S.state.doc.toString()&&S.dispatch({changes:{from:0,to:S.state.doc.toString().length,insert:e||""},annotations:[tl.of(!0)]})};I?j.current=ae:ae()}}},[e,S]),{state:F,setState:M,view:S,setView:b,container:R,setContainer:z}}var uf=["className","value","selection","extensions","onChange","onStatistics","onCreateEditor","onUpdate","autoFocus","theme","height","minHeight","maxHeight","width","minWidth","maxWidth","basicSetup","placeholder","indentWithTab","editable","readOnly","root","initialState"],Ha=L.forwardRef((i,e)=>{var{className:t,value:r="",selection:s,extensions:n=[],onChange:o,onStatistics:l,onCreateEditor:a,onUpdate:u,autoFocus:c,theme:h="light",height:d,minHeight:p,maxHeight:g,width:f,minWidth:m,maxWidth:D,basicSetup:x,placeholder:k,indentWithTab:B,editable:y,readOnly:E,root:R,initialState:z}=i,S=lu(i,uf),b=L.useRef(null),{state:F,view:M,container:v,setContainer:j}=af({root:R,value:r,autoFocus:c,theme:h,height:d,minHeight:p,maxHeight:g,width:f,minWidth:m,maxWidth:D,basicSetup:x,placeholder:k,indentWithTab:B,editable:y,readOnly:E,selection:s,onChange:o,onStatistics:l,onCreateEditor:a,onUpdate:u,extensions:n,initialState:z});L.useImperativeHandle(e,()=>({editor:b.current,state:F,view:M}),[b,v,F,M]);var H=L.useCallback(_=>{b.current=_,j(_)},[j]);if(typeof r!="string")throw new Error("value must be typeof string but got "+typeof r);var q=typeof h=="string"?"cm-theme-"+h:"cm-theme";return C.jsx("div",au({ref:H,className:""+q+(t?" "+t:"")},S))});Ha.displayName="CodeMirror";var cf=/[\u1680\u2000-\u200A\u202F\u205F\u3000]/,hf=/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDF00-\uDF19]|\uD806[\uDCA0-\uDCDF\uDCFF\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE83\uDE86-\uDE89\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F\uDFE0\uDFE1]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]/,df=/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u08D4-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u09FC\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9-\u0AFF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D00-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19D9\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1CD0-\u1CD2\u1CD4-\u1CF9\u1D00-\u1DF9\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u2E2F\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099\u309A\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE3E\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC4A\uDC50-\uDC59\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9\uDF00-\uDF19\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDCA0-\uDCE9\uDCFF\uDE00-\uDE3E\uDE47\uDE50-\uDE83\uDE86-\uDE99\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC36\uDC38-\uDC40\uDC50-\uDC59\uDC72-\uDC8F\uDC92-\uDCA7\uDCA9-\uDCB6\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD47\uDD50-\uDD59]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F\uDFE0\uDFE1]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6\uDD00-\uDD4A\uDD50-\uDD59]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF]/,Js={Space_Separator:cf,ID_Start:hf,ID_Continue:df},Ce={isSpaceSeparator(i){return typeof i=="string"&&Js.Space_Separator.test(i)},isIdStartChar(i){return typeof i=="string"&&(i>="a"&&i<="z"||i>="A"&&i<="Z"||i==="$"||i==="_"||Js.ID_Start.test(i))},isIdContinueChar(i){return typeof i=="string"&&(i>="a"&&i<="z"||i>="A"&&i<="Z"||i>="0"&&i<="9"||i==="$"||i==="_"||i===""||i===""||Js.ID_Continue.test(i))},isDigit(i){return typeof i=="string"&&/[0-9]/.test(i)},isHexDigit(i){return typeof i=="string"&&/[0-9A-Fa-f]/.test(i)}};let Fn,Oe,ft,es,Bt,et,ve,Qn,_i;var ff=function(e,t){Fn=String(e),Oe="start",ft=[],es=0,Bt=1,et=0,ve=void 0,Qn=void 0,_i=void 0;do ve=pf(),Df[Oe]();while(ve.type!=="eof");return typeof t=="function"?Bn({"":_i},"",t):_i};function Bn(i,e,t){const r=i[e];if(r!=null&&typeof r=="object")if(Array.isArray(r))for(let s=0;s<r.length;s++){const n=String(s),o=Bn(r,n,t);o===void 0?delete r[n]:Object.defineProperty(r,n,{value:o,writable:!0,enumerable:!0,configurable:!0})}else for(const s in r){const n=Bn(r,s,t);n===void 0?delete r[s]:Object.defineProperty(r,s,{value:n,writable:!0,enumerable:!0,configurable:!0})}return t.call(i,e,r)}let te,G,Ri,ht,se;function pf(){for(te="default",G="",Ri=!1,ht=1;;){se=Ct();const i=Va[te]();if(i)return i}}function Ct(){if(Fn[es])return String.fromCodePoint(Fn.codePointAt(es))}function w(){const i=Ct();return i===`
`?(Bt++,et=0):i?et+=i.length:et++,i&&(es+=i.length),i}const Va={default(){switch(se){case"	":case"\v":case"\f":case" ":case"":case"\uFEFF":case`
`:case"\r":case"\u2028":case"\u2029":w();return;case"/":w(),te="comment";return;case void 0:return w(),fe("eof")}if(Ce.isSpaceSeparator(se)){w();return}return Va[Oe]()},comment(){switch(se){case"*":w(),te="multiLineComment";return;case"/":w(),te="singleLineComment";return}throw pe(w())},multiLineComment(){switch(se){case"*":w(),te="multiLineCommentAsterisk";return;case void 0:throw pe(w())}w()},multiLineCommentAsterisk(){switch(se){case"*":w();return;case"/":w(),te="default";return;case void 0:throw pe(w())}w(),te="multiLineComment"},singleLineComment(){switch(se){case`
`:case"\r":case"\u2028":case"\u2029":w(),te="default";return;case void 0:return w(),fe("eof")}w()},value(){switch(se){case"{":case"[":return fe("punctuator",w());case"n":return w(),Ot("ull"),fe("null",null);case"t":return w(),Ot("rue"),fe("boolean",!0);case"f":return w(),Ot("alse"),fe("boolean",!1);case"-":case"+":w()==="-"&&(ht=-1),te="sign";return;case".":G=w(),te="decimalPointLeading";return;case"0":G=w(),te="zero";return;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":G=w(),te="decimalInteger";return;case"I":return w(),Ot("nfinity"),fe("numeric",1/0);case"N":return w(),Ot("aN"),fe("numeric",NaN);case'"':case"'":Ri=w()==='"',G="",te="string";return}throw pe(w())},identifierNameStartEscape(){if(se!=="u")throw pe(w());w();const i=kn();switch(i){case"$":case"_":break;default:if(!Ce.isIdStartChar(i))throw il();break}G+=i,te="identifierName"},identifierName(){switch(se){case"$":case"_":case"":case"":G+=w();return;case"\\":w(),te="identifierNameEscape";return}if(Ce.isIdContinueChar(se)){G+=w();return}return fe("identifier",G)},identifierNameEscape(){if(se!=="u")throw pe(w());w();const i=kn();switch(i){case"$":case"_":case"":case"":break;default:if(!Ce.isIdContinueChar(i))throw il();break}G+=i,te="identifierName"},sign(){switch(se){case".":G=w(),te="decimalPointLeading";return;case"0":G=w(),te="zero";return;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":G=w(),te="decimalInteger";return;case"I":return w(),Ot("nfinity"),fe("numeric",ht*(1/0));case"N":return w(),Ot("aN"),fe("numeric",NaN)}throw pe(w())},zero(){switch(se){case".":G+=w(),te="decimalPoint";return;case"e":case"E":G+=w(),te="decimalExponent";return;case"x":case"X":G+=w(),te="hexadecimal";return}return fe("numeric",ht*0)},decimalInteger(){switch(se){case".":G+=w(),te="decimalPoint";return;case"e":case"E":G+=w(),te="decimalExponent";return}if(Ce.isDigit(se)){G+=w();return}return fe("numeric",ht*Number(G))},decimalPointLeading(){if(Ce.isDigit(se)){G+=w(),te="decimalFraction";return}throw pe(w())},decimalPoint(){switch(se){case"e":case"E":G+=w(),te="decimalExponent";return}if(Ce.isDigit(se)){G+=w(),te="decimalFraction";return}return fe("numeric",ht*Number(G))},decimalFraction(){switch(se){case"e":case"E":G+=w(),te="decimalExponent";return}if(Ce.isDigit(se)){G+=w();return}return fe("numeric",ht*Number(G))},decimalExponent(){switch(se){case"+":case"-":G+=w(),te="decimalExponentSign";return}if(Ce.isDigit(se)){G+=w(),te="decimalExponentInteger";return}throw pe(w())},decimalExponentSign(){if(Ce.isDigit(se)){G+=w(),te="decimalExponentInteger";return}throw pe(w())},decimalExponentInteger(){if(Ce.isDigit(se)){G+=w();return}return fe("numeric",ht*Number(G))},hexadecimal(){if(Ce.isHexDigit(se)){G+=w(),te="hexadecimalInteger";return}throw pe(w())},hexadecimalInteger(){if(Ce.isHexDigit(se)){G+=w();return}return fe("numeric",ht*Number(G))},string(){switch(se){case"\\":w(),G+=gf();return;case'"':if(Ri)return w(),fe("string",G);G+=w();return;case"'":if(!Ri)return w(),fe("string",G);G+=w();return;case`
`:case"\r":throw pe(w());case"\u2028":case"\u2029":Cf(se);break;case void 0:throw pe(w())}G+=w()},start(){switch(se){case"{":case"[":return fe("punctuator",w())}te="value"},beforePropertyName(){switch(se){case"$":case"_":G=w(),te="identifierName";return;case"\\":w(),te="identifierNameStartEscape";return;case"}":return fe("punctuator",w());case'"':case"'":Ri=w()==='"',te="string";return}if(Ce.isIdStartChar(se)){G+=w(),te="identifierName";return}throw pe(w())},afterPropertyName(){if(se===":")return fe("punctuator",w());throw pe(w())},beforePropertyValue(){te="value"},afterPropertyValue(){switch(se){case",":case"}":return fe("punctuator",w())}throw pe(w())},beforeArrayValue(){if(se==="]")return fe("punctuator",w());te="value"},afterArrayValue(){switch(se){case",":case"]":return fe("punctuator",w())}throw pe(w())},end(){throw pe(w())}};function fe(i,e){return{type:i,value:e,line:Bt,column:et}}function Ot(i){for(const e of i){if(Ct()!==e)throw pe(w());w()}}function gf(){switch(Ct()){case"b":return w(),"\b";case"f":return w(),"\f";case"n":return w(),`
`;case"r":return w(),"\r";case"t":return w(),"	";case"v":return w(),"\v";case"0":if(w(),Ce.isDigit(Ct()))throw pe(w());return"\0";case"x":return w(),mf();case"u":return w(),kn();case`
`:case"\u2028":case"\u2029":return w(),"";case"\r":return w(),Ct()===`
`&&w(),"";case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":throw pe(w());case void 0:throw pe(w())}return w()}function mf(){let i="",e=Ct();if(!Ce.isHexDigit(e)||(i+=w(),e=Ct(),!Ce.isHexDigit(e)))throw pe(w());return i+=w(),String.fromCodePoint(parseInt(i,16))}function kn(){let i="",e=4;for(;e-- >0;){const t=Ct();if(!Ce.isHexDigit(t))throw pe(w());i+=w()}return String.fromCodePoint(parseInt(i,16))}const Df={start(){if(ve.type==="eof")throw Rt();Ys()},beforePropertyName(){switch(ve.type){case"identifier":case"string":Qn=ve.value,Oe="afterPropertyName";return;case"punctuator":jr();return;case"eof":throw Rt()}},afterPropertyName(){if(ve.type==="eof")throw Rt();Oe="beforePropertyValue"},beforePropertyValue(){if(ve.type==="eof")throw Rt();Ys()},beforeArrayValue(){if(ve.type==="eof")throw Rt();if(ve.type==="punctuator"&&ve.value==="]"){jr();return}Ys()},afterPropertyValue(){if(ve.type==="eof")throw Rt();switch(ve.value){case",":Oe="beforePropertyName";return;case"}":jr()}},afterArrayValue(){if(ve.type==="eof")throw Rt();switch(ve.value){case",":Oe="beforeArrayValue";return;case"]":jr()}},end(){}};function Ys(){let i;switch(ve.type){case"punctuator":switch(ve.value){case"{":i={};break;case"[":i=[];break}break;case"null":case"boolean":case"numeric":case"string":i=ve.value;break}if(_i===void 0)_i=i;else{const e=ft[ft.length-1];Array.isArray(e)?e.push(i):Object.defineProperty(e,Qn,{value:i,writable:!0,enumerable:!0,configurable:!0})}if(i!==null&&typeof i=="object")ft.push(i),Array.isArray(i)?Oe="beforeArrayValue":Oe="beforePropertyName";else{const e=ft[ft.length-1];e==null?Oe="end":Array.isArray(e)?Oe="afterArrayValue":Oe="afterPropertyValue"}}function jr(){ft.pop();const i=ft[ft.length-1];i==null?Oe="end":Array.isArray(i)?Oe="afterArrayValue":Oe="afterPropertyValue"}function pe(i){return ts(i===void 0?`JSON5: invalid end of input at ${Bt}:${et}`:`JSON5: invalid character '${qa(i)}' at ${Bt}:${et}`)}function Rt(){return ts(`JSON5: invalid end of input at ${Bt}:${et}`)}function il(){return et-=5,ts(`JSON5: invalid identifier character at ${Bt}:${et}`)}function Cf(i){console.warn(`JSON5: '${qa(i)}' in strings is not valid ECMAScript; consider escaping`)}function qa(i){const e={"'":"\\'",'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","\v":"\\v","\0":"\\0","\u2028":"\\u2028","\u2029":"\\u2029"};if(e[i])return e[i];if(i<" "){const t=i.charCodeAt(0).toString(16);return"\\x"+("00"+t).substring(t.length)}return i}function ts(i){const e=new SyntaxError(i);return e.lineNumber=Bt,e.columnNumber=et,e}var yf=function(e,t,r){const s=[];let n="",o,l,a="",u;if(t!=null&&typeof t=="object"&&!Array.isArray(t)&&(r=t.space,u=t.quote,t=t.replacer),typeof t=="function")l=t;else if(Array.isArray(t)){o=[];for(const f of t){let m;typeof f=="string"?m=f:(typeof f=="number"||f instanceof String||f instanceof Number)&&(m=String(f)),m!==void 0&&o.indexOf(m)<0&&o.push(m)}}return r instanceof Number?r=Number(r):r instanceof String&&(r=String(r)),typeof r=="number"?r>0&&(r=Math.min(10,Math.floor(r)),a="          ".substr(0,r)):typeof r=="string"&&(a=r.substr(0,10)),c("",{"":e});function c(f,m){let D=m[f];switch(D!=null&&(typeof D.toJSON5=="function"?D=D.toJSON5(f):typeof D.toJSON=="function"&&(D=D.toJSON(f))),l&&(D=l.call(m,f,D)),D instanceof Number?D=Number(D):D instanceof String?D=String(D):D instanceof Boolean&&(D=D.valueOf()),D){case null:return"null";case!0:return"true";case!1:return"false"}if(typeof D=="string")return h(D);if(typeof D=="number")return String(D);if(typeof D=="object")return Array.isArray(D)?g(D):d(D)}function h(f){const m={"'":.1,'"':.2},D={"'":"\\'",'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","\v":"\\v","\0":"\\0","\u2028":"\\u2028","\u2029":"\\u2029"};let x="";for(let B=0;B<f.length;B++){const y=f[B];switch(y){case"'":case'"':m[y]++,x+=y;continue;case"\0":if(Ce.isDigit(f[B+1])){x+="\\x00";continue}}if(D[y]){x+=D[y];continue}if(y<" "){let E=y.charCodeAt(0).toString(16);x+="\\x"+("00"+E).substring(E.length);continue}x+=y}const k=u||Object.keys(m).reduce((B,y)=>m[B]<m[y]?B:y);return x=x.replace(new RegExp(k,"g"),D[k]),k+x+k}function d(f){if(s.indexOf(f)>=0)throw TypeError("Converting circular structure to JSON5");s.push(f);let m=n;n=n+a;let D=o||Object.keys(f),x=[];for(const B of D){const y=c(B,f);if(y!==void 0){let E=p(B)+":";a!==""&&(E+=" "),E+=y,x.push(E)}}let k;if(x.length===0)k="{}";else{let B;if(a==="")B=x.join(","),k="{"+B+"}";else{let y=`,
`+n;B=x.join(y),k=`{
`+n+B+`,
`+m+"}"}}return s.pop(),n=m,k}function p(f){if(f.length===0)return h(f);const m=String.fromCodePoint(f.codePointAt(0));if(!Ce.isIdStartChar(m))return h(f);for(let D=m.length;D<f.length;D++)if(!Ce.isIdContinueChar(String.fromCodePoint(f.codePointAt(D))))return h(f);return f}function g(f){if(s.indexOf(f)>=0)throw TypeError("Converting circular structure to JSON5");s.push(f);let m=n;n=n+a;let D=[];for(let k=0;k<f.length;k++){const B=c(String(k),f);D.push(B!==void 0?B:"null")}let x;if(D.length===0)x="[]";else if(a==="")x="["+D.join(",")+"]";else{let k=`,
`+n,B=D.join(k);x=`[
`+n+B+`,
`+m+"]"}return s.pop(),n=m,x}};const bf={parse:ff,stringify:yf};var Af=bf,Tt={},Ke={},rl;function us(){return rl||(rl=1,Object.defineProperty(Ke,"__esModule",{value:!0}),Ke.excelBOM=Ke.defaultCsv2JsonOptions=Ke.defaultJson2CsvOptions=Ke.errors=void 0,Ke.errors={optionsRequired:"Options were not passed and are required.",json2csv:{cannotCallOn:"Cannot call json2csv on",dataCheckFailure:"Data provided was not an array of documents.",notSameSchema:"Not all documents have the same schema."},csv2json:{cannotCallOn:"Cannot call csv2json on",dataCheckFailure:"CSV is not a string."}},Ke.defaultJson2CsvOptions={arrayIndexesAsKeys:!1,checkSchemaDifferences:!1,delimiter:{field:",",wrap:'"',eol:`
`},emptyFieldValue:void 0,escapeHeaderNestedDots:!0,excelBOM:!1,excludeKeys:[],expandNestedObjects:!0,expandArrayObjects:!1,prependHeader:!0,preventCsvInjection:!1,sortHeader:!1,trimFieldValues:!1,trimHeaderFields:!1,unwindArrays:!1,useDateIso8601Format:!1,useLocaleFormat:!1,wrapBooleans:!1,fieldTitleMap:Object.create({})},Ke.defaultCsv2JsonOptions={delimiter:{field:",",wrap:'"',eol:`
`},excelBOM:!1,preventCsvInjection:!1,trimFieldValues:!1,trimHeaderFields:!1},Ke.excelBOM="\uFEFF"),Ke}var Ue={},Lt={};var sl;function Jn(){if(sl)return Lt;sl=1,Object.defineProperty(Lt,"__esModule",{value:!0}),Lt.setPath=Lt.evaluatePath=void 0;function i(n,o){if(!n)return null;const{dotIndex:l,key:a,remaining:u}=r(o),c=typeof n=="object"&&o in n?n[o]:void 0,h=typeof n=="object"&&a in n?n[a]:void 0;if(l>=0&&typeof n=="object"&&!(o in n)){const{key:d}=r(u),p=parseInt(d);return Array.isArray(h)&&isNaN(p)?h.map(g=>i(g,u)):i(h,u)}else if(Array.isArray(n)){const d=parseInt(a);return o===a&&l===-1&&!isNaN(d)?h:n.map(p=>i(p,o))}else{if(l>=0&&o!==a&&typeof n=="object"&&a in n)return i(h,u);if(l===-1&&typeof n=="object"&&a in n&&!(o in n))return h}return c}Lt.evaluatePath=i;function e(n,o,l){if(n){if(!o)throw new Error("No keyPath was provided.")}else throw new Error("No object was provided.");return t(n,o,l)}Lt.setPath=e;function t(n,o,l){const{dotIndex:a,key:u,remaining:c}=r(o);if(o.startsWith("__proto__")||o.startsWith("constructor")||o.startsWith("prototype"))return n;if(a>=0){const h=parseInt(u);if(typeof n=="object"&&n!==null&&!(u in n)&&Array.isArray(n)&&!isNaN(h))return n[u]=n[u]??{},t(n[u],c,l),n;if(typeof n=="object"&&n!==null&&!(u in n)&&Array.isArray(n))return n.forEach(d=>t(d,o,l)),n;if(typeof n=="object"&&n!==null&&!(u in n)&&!Array.isArray(n)){const{key:d}=r(c),p=parseInt(d);if(!isNaN(p))n[u]=[];else{if(c==="")return n[o]=l,n;n[u]={}}}t(n[u],c,l)}else if(Array.isArray(n)){const h=parseInt(u);return o===u&&a===-1&&!isNaN(h)?(n[u]=l,n):(n.forEach(d=>t(d,c,l)),n)}else n[u]=l;return n}function r(n){const o=s(n);return{dotIndex:o,key:n.slice(0,o>=0?o:void 0).replace(/\\./g,"."),remaining:n.slice(o+1)}}function s(n){for(let o=0;o<n.length;o++){const l=o>0?n[o-1]:"";if(n[o]==="."&&l!=="\\")return o}return-1}return Lt}var Qe={},ct={},nl;function xf(){if(nl)return ct;nl=1,Object.defineProperty(ct,"__esModule",{value:!0}),ct.isDocumentToRecurOn=ct.flatten=ct.unique=void 0;function i(r){return[...new Set(r)]}ct.unique=i;function e(r){return[].concat(...r)}ct.flatten=e;function t(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)&&Object.keys(r).length}return ct.isDocumentToRecurOn=t,ct}var Gs={},ol;function Sf(){return ol||(ol=1,Object.defineProperty(Gs,"__esModule",{value:!0})),Gs}var ll;function vf(){return ll||(ll=1,(function(i){var e=Qe&&Qe.__createBinding||(Object.create?(function(p,g,f,m){m===void 0&&(m=f);var D=Object.getOwnPropertyDescriptor(g,f);(!D||("get"in D?!g.__esModule:D.writable||D.configurable))&&(D={enumerable:!0,get:function(){return g[f]}}),Object.defineProperty(p,m,D)}):(function(p,g,f,m){m===void 0&&(m=f),p[m]=g[f]})),t=Qe&&Qe.__setModuleDefault||(Object.create?(function(p,g){Object.defineProperty(p,"default",{enumerable:!0,value:g})}):function(p,g){p.default=g}),r=Qe&&Qe.__importStar||function(p){if(p&&p.__esModule)return p;var g={};if(p!=null)for(var f in p)f!=="default"&&Object.prototype.hasOwnProperty.call(p,f)&&e(g,p,f);return t(g,p),g},s=Qe&&Qe.__exportStar||function(p,g){for(var f in p)f!=="default"&&!Object.prototype.hasOwnProperty.call(g,f)&&e(g,p,f)};Object.defineProperty(i,"__esModule",{value:!0}),i.deepKeysFromList=i.deepKeys=void 0;const n=r(xf());s(Sf(),i);function o(p,g){const f=d(g);return typeof p=="object"&&p!==null?a("",p,f):[]}i.deepKeys=o;function l(p,g){const f=d(g);return p.map(m=>typeof m=="object"&&m!==null?o(m,f):[])}i.deepKeysFromList=l;function a(p,g,f){const m=Object.keys(g).map(D=>{const x=h(p,c(D,f));return f.expandNestedObjects&&n.isDocumentToRecurOn(g[D])||f.arrayIndexesAsKeys&&Array.isArray(g[D])&&g[D].length?a(x,g[D],f):f.expandArrayObjects&&Array.isArray(g[D])?u(g[D],x,f):f.ignoreEmptyArrays&&Array.isArray(g[D])&&!g[D].length?[]:x});return n.flatten(m)}function u(p,g,f){let m=l(p,f);return p.length?p.length&&n.flatten(m).length===0?[g]:(m=m.map(D=>Array.isArray(D)&&D.length===0?[g]:D.map(x=>h(g,c(x,f)))),n.unique(n.flatten(m))):f.ignoreEmptyArraysWhenExpanding?[]:[g]}function c(p,g){return g.escapeNestedDots?p.replace(/\./g,"\\."):p}function h(p,g){return p?p+"."+g:g}function d(p){return{arrayIndexesAsKeys:!1,expandNestedObjects:!0,expandArrayObjects:!1,ignoreEmptyArraysWhenExpanding:!1,escapeNestedDots:!1,ignoreEmptyArrays:!1,...p??{}}}})(Qe)),Qe}var J={},al;function Yn(){if(al)return J;al=1,Object.defineProperty(J,"__esModule",{value:!0}),J.isInvalid=J.flatten=J.unique=J.arrayDifference=J.isError=J.isUndefined=J.isNull=J.isObject=J.isString=J.isNumber=J.unwind=J.getNCharacters=J.removeEmptyFields=J.isEmptyField=J.computeSchemaDifferences=J.isDateRepresentation=J.isStringRepresentation=J.deepCopy=J.validate=J.buildC2JOptions=J.buildJ2COptions=void 0;const i=Jn(),e=us(),t=/\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{3}Z/,r=1e5;function s(b){return{...e.defaultJson2CsvOptions,...b,delimiter:{field:b?.delimiter?.field??e.defaultJson2CsvOptions.delimiter.field,wrap:b?.delimiter?.wrap||e.defaultJson2CsvOptions.delimiter.wrap,eol:b?.delimiter?.eol||e.defaultJson2CsvOptions.delimiter.eol},fieldTitleMap:b?.fieldTitleMap||Object.create({})}}J.buildJ2COptions=s;function n(b){return{...e.defaultCsv2JsonOptions,...b,delimiter:{field:b?.delimiter?.field??e.defaultCsv2JsonOptions.delimiter.field,wrap:b?.delimiter?.wrap||e.defaultCsv2JsonOptions.delimiter.wrap,eol:b?.delimiter?.eol||e.defaultCsv2JsonOptions.delimiter.eol}}}J.buildC2JOptions=n;function o(b,F,M){if(!b)throw new Error(`${M.cannotCallOn} ${b}.`);if(!F(b))throw new Error(M.dataCheckFailure);return!0}J.validate=o;function l(b){return JSON.parse(JSON.stringify(b))}J.deepCopy=l;function a(b,F){const M=b[0],v=b.length-1,j=b[v];return M===F.delimiter.wrap&&j===F.delimiter.wrap}J.isStringRepresentation=a;function u(b){return t.test(b)}J.isDateRepresentation=u;function c(b,F){return E(b,F).concat(E(F,b))}J.computeSchemaDifferences=c;function h(b){return B(b)||k(b)||b===""}J.isEmptyField=h;function d(b){return b.filter(F=>!h(F))}J.removeEmptyFields=d;function p(b,F,M){return b.substring(F,F+M)}J.getNCharacters=p;function g(b,F,M){const v=(0,i.evaluatePath)(F,M);let j=l(F);Array.isArray(v)&&v.length?v.forEach(H=>{j=l(F),b.push((0,i.setPath)(j,M,H))}):(Array.isArray(v)&&v.length===0&&(0,i.setPath)(j,M,""),b.push(j))}function f(b,F){const M=[];return b.forEach(v=>{g(M,v,F)}),M}J.unwind=f;function m(b){return!isNaN(Number(b))}J.isNumber=m;function D(b){return typeof b=="string"}J.isString=D;function x(b){return typeof b=="object"}J.isObject=x;function k(b){return b===null}J.isNull=k;function B(b){return typeof b>"u"}J.isUndefined=B;function y(b){return Object.prototype.toString.call(b)==="[object Error]"}J.isError=y;function E(b,F){return b.filter(M=>!F.includes(M))}J.arrayDifference=E;function R(b){return[...new Set(b)]}J.unique=R;function z(b){if(b.flat)return b.flat();if(b.length>r){let F=[];for(let M=0;M<b.length;M+=r)F=F.concat(...b.slice(M,M+r));return F}return b.reduce((F,M)=>F.concat(M),[])}J.flatten=z;function S(b){return b===1/0||b===-1/0}return J.isInvalid=S,J}var ul;function wf(){if(ul)return Ue;ul=1;var i=Ue&&Ue.__createBinding||(Object.create?(function(a,u,c,h){h===void 0&&(h=c);var d=Object.getOwnPropertyDescriptor(u,c);(!d||("get"in d?!u.__esModule:d.writable||d.configurable))&&(d={enumerable:!0,get:function(){return u[c]}}),Object.defineProperty(a,h,d)}):(function(a,u,c,h){h===void 0&&(h=c),a[h]=u[c]})),e=Ue&&Ue.__setModuleDefault||(Object.create?(function(a,u){Object.defineProperty(a,"default",{enumerable:!0,value:u})}):function(a,u){a.default=u}),t=Ue&&Ue.__importStar||function(a){if(a&&a.__esModule)return a;var u={};if(a!=null)for(var c in a)c!=="default"&&Object.prototype.hasOwnProperty.call(a,c)&&i(u,a,c);return e(u,a),u};Object.defineProperty(Ue,"__esModule",{value:!0}),Ue.Json2Csv=void 0;const r=Jn(),s=vf(),n=us(),o=t(Yn()),l=function(a){const u=new RegExp(a.delimiter.wrap,"g"),c=/\r?\n|\r/,h=a.parseValue&&typeof a.parseValue=="function"?a.parseValue:null,d=a.expandArrayObjects&&!a.unwindArrays,p={arrayIndexesAsKeys:a.arrayIndexesAsKeys,expandNestedObjects:a.expandNestedObjects,expandArrayObjects:d,ignoreEmptyArraysWhenExpanding:d,escapeNestedDots:!0};function g(A){return(0,s.deepKeysFromList)(A,p)}function f(A){return A.length===0?[]:a.checkSchemaDifferences?m(A):o.unique(o.flatten(A))}function m(A){const T=A[0],W=A.slice(1);if(D(T,W))throw new Error(n.errors.json2csv.notSameSchema);return T}function D(A,T){return T.reduce((W,$)=>o.computeSchemaDifferences(A,$).length>0?W+1:W,0)}function x(A){return a.excludeKeys?A.filter(T=>{for(const W of a.excludeKeys){const $=W instanceof RegExp?W:new RegExp(`^${W}`);if(W===T||T.match($))return!1}return!0}):A}function k(A){return a.sortHeader&&typeof a.sortHeader=="function"?A.sort(a.sortHeader):a.sortHeader?A.sort():A}function B(A){return a.trimHeaderFields&&(A.headerFields=A.headerFields.map(T=>T.split(".").map(W=>W.trim()).join("."))),A}function y(A){return a.prependHeader&&(A.headerFields=A.headerFields.map(function(T){return ee(T)})),A}function E(A){const T=Object.keys(a.fieldTitleMap);return A.header=A.headerFields.map(function(W){let $=W;return T.includes(W)?$=a.fieldTitleMap[W]:a.escapeHeaderNestedDots||($=$.replace(/\\\./g,".")),$}).join(a.delimiter.field),A}function R(){return a.keys?a.keys.map(A=>typeof A=="object"&&"field"in A?(a.fieldTitleMap[A.field]=A.title??A.field,A.field):A):[]}function z(){return a.keys?a.keys.flatMap(A=>typeof A=="string"?[]:A?.wildcardMatch?A.field:[]):[]}function S(A){const T=z(),W=R(),$=g(A),Y=f($);if(a.keys){a.keys=W;const U=W.flatMap(Q=>{if(!T.includes(Q))return Q;const xe=[],Fe=new RegExp(`^${Q}`);for(const he of Y)(Q===he||he.match(Fe))&&xe.push(he);return xe});if(!a.unwindArrays){const Q=x(U);return k(Q)}}const ne=x(Y);return k(ne)}function b(A){for(const T of A.records)for(const W of A.headerFields){const $=(0,r.evaluatePath)(T,W);if(Array.isArray($))return!0}return!1}function F(A,T=!1){if(a.unwindArrays){if(A.headerFields.forEach(W=>{A.records=o.unwind(A.records,W)}),A.headerFields=S(A.records),b(A))return F(A,T);if(!T)return F(A,!0);if(a.keys){const W=R();A.headerFields=x(W)}return A}return A}function M(A){return A.recordString=A.records.map(T=>{const W=j(T,A.headerFields),$=W.map(Y=>{Y=q(Y),Y=_(Y);let ne=h?h(Y,H):H(Y);return ne=ee(ne),ne});return O($)}).join(a.delimiter.eol),A}function v(A){const T=o.removeEmptyFields(A);return!A.length||!T.length?a.emptyFieldValue||"":T.length===1?T[0]:A}function j(A,T){const W=[];return T.forEach($=>{let Y=(0,r.evaluatePath)(A,$);!o.isUndefined(a.emptyFieldValue)&&o.isEmptyField(Y)?Y=a.emptyFieldValue:a.expandArrayObjects&&Array.isArray(Y)&&(Y=v(Y)),W.push(Y)}),W}function H(A){const T=A instanceof Date;return A===null||Array.isArray(A)||typeof A=="object"&&!T?JSON.stringify(A):typeof A>"u"?"undefined":T&&a.useDateIso8601Format?A.toISOString():a.useLocaleFormat?A.toLocaleString():A.toString()}function q(A){return a.trimFieldValues?Array.isArray(A)?A.map(q):typeof A=="string"?A.trim():A:A}function _(A){return a.preventCsvInjection?Array.isArray(A)?A.map(_):typeof A=="string"&&!o.isNumber(A)?A.replace(/^[=+\-@\t\r]+/g,""):A:A}function ee(A){const T=a.delimiter.wrap;return A.includes(a.delimiter.wrap)&&(A=A.replace(u,T+T)),(A.includes(a.delimiter.field)||A.includes(a.delimiter.wrap)||A.match(c)||a.wrapBooleans&&(A==="true"||A==="false"))&&(A=T+A+T),A}function O(A){return A.join(a.delimiter.field)}function I(A){const T=A.header,W=A.recordString;return(a.excelBOM?n.excelBOM:"")+(a.prependHeader?T+a.delimiter.eol:"")+W}function ae(A){Array.isArray(A)||(A=[A]);const T={headerFields:S(A),records:A,header:"",recordString:""},W=F(T),$=M(W),Y=y($),ne=B(Y),U=E(ne);return I(U)}return{convert:ae}};return Ue.Json2Csv=l,Ue}var Je={},cl;function Ef(){if(cl)return Je;cl=1;var i=Je&&Je.__createBinding||(Object.create?(function(l,a,u,c){c===void 0&&(c=u);var h=Object.getOwnPropertyDescriptor(a,u);(!h||("get"in h?!a.__esModule:h.writable||h.configurable))&&(h={enumerable:!0,get:function(){return a[u]}}),Object.defineProperty(l,c,h)}):(function(l,a,u,c){c===void 0&&(c=u),l[c]=a[u]})),e=Je&&Je.__setModuleDefault||(Object.create?(function(l,a){Object.defineProperty(l,"default",{enumerable:!0,value:a})}):function(l,a){l.default=a}),t=Je&&Je.__importStar||function(l){if(l&&l.__esModule)return l;var a={};if(l!=null)for(var u in l)u!=="default"&&Object.prototype.hasOwnProperty.call(l,u)&&i(a,l,u);return e(a,l),a};Object.defineProperty(Je,"__esModule",{value:!0}),Je.Csv2Json=void 0;const r=Jn(),s=us(),n=t(Yn()),o=function(l){const a=new RegExp(l.delimiter.wrap+l.delimiter.wrap,"g"),u=new RegExp("^"+s.excelBOM),c=l.parseValue&&typeof l.parseValue=="function"?l.parseValue:JSON.parse;function h(S){return S=B(S),l.trimHeaderFields?S.split(".").map(b=>b.trim()).join("."):S}function d(S){let b=[];if(l.headerFields)b=l.headerFields.map((F,M)=>({value:h(F),index:M}));else if(b=S[0].map((M,v)=>({value:h(M),index:v})),l.keys){const M=l.keys;b=b.filter(v=>M.includes(v.value))}return{lines:S,headerFields:b,recordLines:[]}}function p(S){return l.excelBOM?S.replace(u,""):S}function g(S){const b=[],F=S.length-1,M=l.delimiter.eol.length,v={insideWrapDelimiter:!1,parsingValue:!0,justParsedDoubleQuote:!1,startIndex:0};let j=[],H,q,_,ee,O=0;for(;O<S.length;){if(H=S[O],q=O?S[O-1]:"",_=O<F?S[O+1]:"",ee=n.getNCharacters(S,O,M),(ee===l.delimiter.eol&&!v.insideWrapDelimiter||O===F)&&q===l.delimiter.field)ee===l.delimiter.eol&&v.startIndex===O||H===l.delimiter.field?j.push(""):j.push(S.substring(v.startIndex)),j.push(""),b.push(j),j=[],v.startIndex=O+M,v.parsingValue=!0,v.insideWrapDelimiter=_===l.delimiter.wrap;else if(O===F&&H===l.delimiter.field){const I=S.substring(v.startIndex,O);j.push(I),j.push(""),b.push(j)}else if(O===F||ee===l.delimiter.eol&&(!v.insideWrapDelimiter||v.insideWrapDelimiter&&q===l.delimiter.wrap&&!v.justParsedDoubleQuote)){const I=O!==F||q===l.delimiter.wrap?O:void 0;j.push(S.substring(v.startIndex,I)),b.push(j),j=[],v.startIndex=O+M,v.parsingValue=!0,v.insideWrapDelimiter=_===l.delimiter.wrap}else if(H===l.delimiter.wrap&&q===l.delimiter.field&&!v.insideWrapDelimiter&&!v.parsingValue)v.startIndex=O,v.insideWrapDelimiter=!0,v.parsingValue=!0,n.getNCharacters(S,O+1,M)===l.delimiter.eol&&(O+=l.delimiter.eol.length+1);else if(q===l.delimiter.field&&H===l.delimiter.wrap&&_===l.delimiter.eol)j.push(S.substring(v.startIndex,O-1)),v.startIndex=O,v.parsingValue=!0,v.insideWrapDelimiter=!0,v.justParsedDoubleQuote=!0,O+=1;else if((q!==l.delimiter.wrap||v.justParsedDoubleQuote&&q===l.delimiter.wrap)&&H===l.delimiter.wrap&&n.getNCharacters(S,O+1,M)===l.delimiter.eol)v.insideWrapDelimiter=!1,v.parsingValue=!1;else if(H===l.delimiter.wrap&&(O===0||n.getNCharacters(S,O-M,M)===l.delimiter.eol&&!v.insideWrapDelimiter))v.insideWrapDelimiter=!0,v.parsingValue=!0,v.startIndex=O;else if(H===l.delimiter.wrap&&_===l.delimiter.field&&v.insideWrapDelimiter)j.push(S.substring(v.startIndex,O+1)),v.startIndex=O+2,v.insideWrapDelimiter=!1,v.parsingValue=!1;else if(H===l.delimiter.wrap&&q===l.delimiter.field&&!v.insideWrapDelimiter&&v.parsingValue)j.push(S.substring(v.startIndex,O-1)),v.insideWrapDelimiter=!0,v.parsingValue=!0,v.startIndex=O;else if(H===l.delimiter.wrap&&_===l.delimiter.wrap&&O!==v.startIndex){O+=2,v.justParsedDoubleQuote=!0;continue}else H===l.delimiter.field&&q!==l.delimiter.wrap&&_!==l.delimiter.wrap&&!v.insideWrapDelimiter&&v.parsingValue?(j.push(S.substring(v.startIndex,O)),v.startIndex=O+1):H===l.delimiter.field&&q===l.delimiter.wrap&&_!==l.delimiter.wrap&&!v.parsingValue&&(v.insideWrapDelimiter=!1,v.parsingValue=!0,v.startIndex=O+1);O++,v.justParsedDoubleQuote=!1}return b}function f(S){return l.headerFields?S.recordLines=S.lines:S.recordLines=S.lines.splice(1),S}function m(S,b){const F=b[S.index];return D(F)}function D(S){const b=R(S);return!n.isError(b)&&!n.isInvalid(b)?b:S==="undefined"?void 0:S}function x(S){return l.trimFieldValues&&S!==null?S.trim():S}function k(S,b){return S.reduce((F,M)=>{const v=m(M,b);try{return(0,r.setPath)(F,M.value,v)}catch{return F}},{})}function B(S){const b=S[0],F=S.length-1,M=S[F];return b===l.delimiter.wrap&&M===l.delimiter.wrap?S.length<=2?"":S.substring(1,F):S}function y(S){return S.replace(a,l.delimiter.wrap)}function E(S){return S.recordLines.reduce((b,F)=>{F=F.map(v=>(v=B(v),v=y(v),v=x(v),v));const M=k(S.headerFields,F);return b.concat(M)},[])}function R(S){try{if(n.isStringRepresentation(S,l)&&!n.isDateRepresentation(S))return S;const b=c(S);return Array.isArray(b)?b.map(x):b}catch(b){return b}}function z(S){const b=p(S),F=g(b),M=d(F),v=f(M);return E(v)}return{convert:z}};return Je.Csv2Json=o,Je}var hl;function Ff(){if(hl)return Tt;hl=1,Object.defineProperty(Tt,"__esModule",{value:!0}),Tt.csv2json=Tt.json2csv=void 0;const i=us(),e=wf(),t=Ef(),r=Yn();function s(o,l){const a=(0,r.buildJ2COptions)(l??{});return(0,r.validate)(o,r.isObject,i.errors.json2csv),(0,e.Json2Csv)(a).convert(o)}Tt.json2csv=s;function n(o,l){const a=(0,r.buildC2JOptions)(l??{});return(0,r.validate)(o,r.isString,i.errors.csv2json),(0,t.Csv2Json)(a).convert(o)}return Tt.csv2json=n,Tt}var Bf=Ff(),Xs,dl;function kf(){if(dl)return Xs;dl=1;class i{constructor(t={}){if(!(t.maxSize&&t.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");this.maxSize=t.maxSize,this.onEviction=t.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}_set(t,r){if(this.cache.set(t,r),this._size++,this._size>=this.maxSize){if(this._size=0,typeof this.onEviction=="function")for(const[s,n]of this.oldCache.entries())this.onEviction(s,n);this.oldCache=this.cache,this.cache=new Map}}get(t){if(this.cache.has(t))return this.cache.get(t);if(this.oldCache.has(t)){const r=this.oldCache.get(t);return this.oldCache.delete(t),this._set(t,r),r}}set(t,r){return this.cache.has(t)?this.cache.set(t,r):this._set(t,r),this}has(t){return this.cache.has(t)||this.oldCache.has(t)}peek(t){if(this.cache.has(t))return this.cache.get(t);if(this.oldCache.has(t))return this.oldCache.get(t)}delete(t){const r=this.cache.delete(t);return r&&this._size--,this.oldCache.delete(t)||r}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}*keys(){for(const[t]of this)yield t}*values(){for(const[,t]of this)yield t}*[Symbol.iterator](){for(const t of this.cache)yield t;for(const t of this.oldCache){const[r]=t;this.cache.has(r)||(yield t)}}get size(){let t=0;for(const r of this.oldCache.keys())this.cache.has(r)||t++;return Math.min(this._size+t,this.maxSize)}}return Xs=i,Xs}var Mf=kf();const Of=uu(Mf),Ii=["v1","vX","v2021-03-25","v2021-10-21","v2022-03-07","v2025-02-19",`v${new Date().toISOString().split("T")[0]}`],[$a]=Ii.slice(-1);function Ka(i){const e=me.c(5),[t,r]=L.useState(!1);let s,n;e[0]!==i.delay?(s=()=>{const l=setTimeout(()=>r(!0),i.delay||500);return()=>clearTimeout(l)},n=[i.delay],e[0]=i.delay,e[1]=s,e[2]=n):(s=e[1],n=e[2]),L.useEffect(s,n);let o;return e[3]!==t?(o=t?C.jsx(pu,{muted:!0,size:4}):null,e[3]=t,e[4]=o):o=e[4],o}const Rf=[[pc],za(),_a(),Wa(),Nl(),Na(),Tl(),Pl(),jl(),Rl(),La(),Nn(Ll,{fallback:!0}),as.of([{key:"Mod-Enter",run:()=>!0},Ml,Ol].flat().filter(Boolean))];function Tf(i){const e=me.c(7);let t;e[0]!==i?(t=Lf(i),e[0]=i,e[1]=t):t=e[1];const r=t;let s;e[2]!==i?(s=Nn(Pf(i)),e[2]=i,e[3]=s):s=e[3];const n=s;let o;return e[4]!==n||e[5]!==r?(o=[r,n],e[4]=n,e[5]=r,e[6]=o):o=e[6],o}function Lf(i){const{color:e,fonts:t}=i.sanity,r=e.card.enabled,s=so.blue[e.dark?400:500].hex,n=so.gray[i.sanity.color.dark?900:100].hex;return Z.theme({"&":{color:r.fg,backgroundColor:r.bg},".cm-content":{caretColor:s},".cm-editor":{fontFamily:t.code.family,fontSize:Ye(t.code.sizes[1].fontSize),lineHeight:"inherit"},".cm-cursor, .cm-dropCursor":{borderLeftColor:s},"&.cm-focused .cm-selectionBackground, .cm-selectionBackground, .cm-content ::selection":{backgroundColor:n},".cm-panels":{backgroundColor:r.bg,color:r.fg},".cm-panels.cm-panels-top":{borderBottom:`2px solid ${r.border}`},".cm-panels.cm-panels-bottom":{borderTop:`2px solid ${r.border}`}},{dark:e.dark})}function Pf(i){const e=i.sanity.color.base,t=i.sanity.color.syntax;return fc.define([{tag:K.keyword,color:t.keyword},{tag:[K.propertyName,K.name,K.deleted,K.character,K.macroName],color:t.property},{tag:[K.function(K.variableName),K.labelName],color:t.function},{tag:[K.color,K.constant(K.name),K.standard(K.name)],color:t.variable},{tag:[K.definition(K.name),K.separator],color:t.constant},{tag:[K.typeName,K.className,K.number,K.changed,K.annotation,K.modifier,K.self,K.namespace],color:t.number},{tag:[K.operator,K.operatorKeyword,K.url,K.escape,K.regexp,K.link,K.special(K.string)],color:t.operator},{tag:[K.meta,K.comment],color:t.comment},{tag:K.strong,fontWeight:"bold"},{tag:K.emphasis,fontStyle:"italic"},{tag:K.strikethrough,textDecoration:"line-through"},{tag:K.heading,fontWeight:"bold",color:t.property},{tag:[K.atom,K.bool,K.special(K.variableName)],color:t.boolean},{tag:[K.processingInstruction,K.string,K.inserted],color:t.string},{tag:K.invalid,color:e.fg}])}const jf=ce.div.withConfig({displayName:"EditorRoot",componentId:"sc-1e01cjn-0"})`width:100%;box-sizing:border-box;height:100%;overflow:hidden;overflow:clip;position:relative;display:flex;& .cm-theme{width:100%;}& .cm-editor{height:100%;font-size:16px;line-height:21px;}& .cm-line{padding-left:${({theme:i})=>Ye(i.sanity.space[3])};}& .cm-content{border-right-width:${({theme:i})=>Ye(i.sanity.space[4])} !important;padding-top:${({theme:i})=>Ye(i.sanity.space[5])};}`,Gn=L.forwardRef((i,e)=>{const t=me.c(7),[r]=L.useState(i.initialValue),s=xu(),n=Tf(s),o=L.useRef(null);let l;t[0]===Symbol.for("react.memo_cache_sentinel")?(l=d=>{const p=o.current?.view;if(!p)return;const g=p.state.doc.toString();d!==g&&p.dispatch({changes:{from:0,to:g.length,insert:d},selection:X.cursor(d.length)})},t[0]=l):l=t[0];const a=l;let u,c;t[1]===Symbol.for("react.memo_cache_sentinel")?(u=()=>({resetEditorContent:a}),c=[a],t[1]=u,t[2]=c):(u=t[1],c=t[2]),L.useImperativeHandle(e,u,c);let h;return t[3]!==r||t[4]!==i.onChange||t[5]!==n?(h=C.jsx(jf,{children:C.jsx(Ha,{ref:o,basicSetup:!1,theme:n,extensions:Rf,value:r,onChange:i.onChange})}),t[3]=r,t[4]=i.onChange,t[5]=n,t[6]=h):h=t[6],h});Gn.displayName="VisionCodeMirror";const Ua=["pinnedRelease","scheduledDrafts","raw","published","drafts"],Nf=["pinnedRelease","scheduledDrafts"];function Zs(i){return Ua.includes(i)}function fl(i){return typeof i=="string"&&Nf.includes(i)}function pl({selectedPerspectiveName:i}){return typeof i<"u"}function en({visionPerspective:i,perspectiveStack:e,scheduledDraftsStack:t}){return i==="pinnedRelease"?e:i==="scheduledDrafts"?t:i}function tn(i,e={},t={}){const r=new URLSearchParams;r.set("query",i);for(const[s,n]of Object.entries(e))r.set(`$${s}`,JSON.stringify(n));for(const[s,n]of Object.entries(t))n&&r.set(s,`${n}`);return`?${r}`}function _f(i){return!!i&&typeof i=="object"&&Object.prototype.toString.call(i)==="[object Object]"}const Qa=Wf(),Ja="sanityVision:";function If(){if(Qa)for(let i=0;i<localStorage.length;i++){const e=localStorage.key(i);e?.startsWith(Ja)&&localStorage.removeItem(e)}}function zf(i){const e=`${Ja}${i}`;let t=null;return{get:r,set:s,merge:n};function r(a,u){const c=o();return typeof c[a]>"u"?u:c[a]}function s(a,u){const c=o();return c[a]=u,localStorage.setItem(e,JSON.stringify(t)),u}function n(a){const u={...o(),...a};return localStorage.setItem(e,JSON.stringify(u)),u}function o(){return t===null&&(t=l()),t}function l(){if(!Qa)return{};try{const a=JSON.parse(localStorage.getItem(e)||"{}");return _f(a)?a:{}}catch{return{}}}}function Wf(){const i="lsCheck";try{return localStorage.setItem(i,i),localStorage.removeItem(i),!0}catch{return!1}}function Hf(i){const e={},t={};for(const[r,s]of i.entries()){if(r[0]==="$"){e[r.slice(1)]=JSON.parse(s);continue}if(r==="perspective"){t[r]=s;continue}}return{query:i.get("query")||"",params:e,options:t}}function Vf(i){return i[0]!=="v"&&i!=="other"?`v${i}`:i}function rn(i){const e=i.replace(/^v/,"").trim().toUpperCase();return e.length>0&&(e==="X"||e==="1"||/^\d{4}-\d{2}-\d{2}$/.test(e)&&!isNaN(Date.parse(e)))}function qf(i,e){try{const t=i?Af.parse(i):{};return typeof t=="object"&&t&&!Array.isArray(t)?t:{}}catch(t){return t.message=`${e("params.error.params-invalid-json")}:

${t.message.replace("JSON5:","")}`,t}}const Ya=ce(Ne).withConfig({displayName:"Root",componentId:"sc-r315za-0"})`.sidebarPanes .Pane{overflow-y:auto;overflow-x:hidden;}& .Resizer{background:var(--card-border-color);opacity:1;z-index:1;box-sizing:border-box;background-clip:padding-box;border:solid transparent;}& .Resizer:hover{border-color:var(--card-shadow-ambient-color);}& .Resizer.horizontal{height:11px;margin:-5px 0;border-width:5px 0;cursor:row-resize;width:100%;z-index:4;}& .Resizer.vertical{width:11px;margin:0 -5px;border-width:0 5px;cursor:col-resize;z-index:2;}.Resizer.disabled{cursor:not-allowed;}.Resizer.disabled:hover{border-color:transparent;}`;Ya.displayName="Root";const $f=ce(be).withConfig({displayName:"Header",componentId:"sc-r315za-1"})`border-bottom:1px solid var(--card-border-color);`,pt=ce(Iu).withConfig({displayName:"StyledLabel",componentId:"sc-r315za-2"})`flex:1;`,Kf=ce(le).withConfig({displayName:"SplitpaneContainer",componentId:"sc-r315za-3"})`position:relative;`,Uf=ce.a.withConfig({displayName:"QueryCopyLink",componentId:"sc-r315za-4"})`cursor:pointer;margin-right:auto;`,Ga=ce(le).withConfig({displayName:"InputBackgroundContainer",componentId:"sc-r315za-5"})`position:absolute;top:1rem;left:0;padding:0;margin:0;z-index:10;right:0;${pt}{user-select:none;}`,Xa=ce(Ga).withConfig({displayName:"InputBackgroundContainerLeft",componentId:"sc-r315za-6"})`left:33px;`,gl=ce(be).withConfig({displayName:"InputContainer",componentId:"sc-r315za-7"})`width:100%;height:100%;position:relative;flex-direction:column;`,Qf=ce(Ne).withConfig({displayName:"ResultOuterContainer",componentId:"sc-r315za-8"})`height:100%;`,Jf=ce(le).withConfig({displayName:"ResultInnerContainer",componentId:"sc-r315za-9"})`position:relative;`,Yf=ce(be).withConfig({displayName:"ResultContainer",componentId:"sc-r315za-10"})`height:100%;width:100%;position:absolute;max-width:100%;${({$isInvalid:i})=>i&&xl`
      &:after {
        background-color: var(--card-bg-color);
        content: '';
        position: absolute;
        top: 0;
        bottom: 0;
        left: 0;
        width: 100%;
      }
    `}`,Gf=ce(le).withConfig({displayName:"Result",componentId:"sc-r315za-11"})`position:relative;width:100%;height:100%;z-index:20;`,Xf=ce(Ne).withConfig({displayName:"ResultFooter",componentId:"sc-r315za-12"})`border-top:1px solid var(--card-border-color);`,Zf=ce(be).withConfig({displayName:"TimingsCard",componentId:"sc-r315za-13"})`position:relative;`;ce(le).withConfig({displayName:"TimingsContainer",componentId:"sc-r315za-14"})`width:100%;height:100%;`;const ep=ce(Ne).withConfig({displayName:"TimingsTextContainer",componentId:"sc-r315za-15"})`height:100%;min-height:${({theme:i})=>Ye(i.sanity.space[3]*2+i.sanity.fonts.text.sizes[2].lineHeight-i.sanity.fonts.text.sizes[2].ascenderHeight-i.sanity.fonts.text.sizes[2].descenderHeight)};`,tp=ce(be).withConfig({displayName:"DownloadsCard",componentId:"sc-r315za-16"})`position:relative;`,ip=ce(_e).withConfig({displayName:"SaveResultLabel",componentId:"sc-r315za-17"})`transform:initial;&:before,&:after{content:none;}> span{display:flex !important;gap:${({theme:i})=>Ye(i.sanity.space[3])};align-items:center;}`,rp=ce(le).withConfig({displayName:"ControlsContainer",componentId:"sc-r315za-18"})`border-top:1px solid var(--card-border-color);`,sp=`{
  
}`;function np(i){const e=me.c(21),{onChange:t,paramsError:r,hasValidParams:s,editorRef:n}=i,{t:o}=bt(At);let l;e[0]!==t?(l=k=>{t(k)},e[0]=t,e[1]=l):l=e[1];const a=l;let u;e[2]!==a?(u=Au(a,333),e[2]=a,e[3]=u):u=e[3];const c=u,h=s?"default":"critical";let d;e[4]!==o?(d=o("params.label"),e[4]=o,e[5]=d):d=e[5];let p;e[6]!==d?(p=C.jsx(pt,{muted:!0,children:d}),e[6]=d,e[7]=p):p=e[7];let g;e[8]!==r?(g=r&&C.jsx(zi,{animate:!0,placement:"top",portal:!0,content:C.jsx(_e,{size:1,children:r}),children:C.jsx(le,{padding:1,marginX:2,children:C.jsx(_e,{children:C.jsx(Su,{})})})}),e[8]=r,e[9]=g):g=e[9];let f;e[10]!==p||e[11]!==g?(f=C.jsx(Xa,{children:C.jsxs(Ne,{children:[p,g]})}),e[10]=p,e[11]=g,e[12]=f):f=e[12];const m=i.value||sp;let D;e[13]!==n||e[14]!==c||e[15]!==m?(D=C.jsx(Gn,{ref:n,initialValue:m,onChange:c}),e[13]=n,e[14]=c,e[15]=m,e[16]=D):D=e[16];let x;return e[17]!==h||e[18]!==f||e[19]!==D?(x=C.jsxs(be,{flex:1,tone:h,"data-testid":"params-editor",children:[f,D]}),e[17]=h,e[18]=f,e[19]=D,e[20]=x):x=e[20],x}function ml(i,e){const t=qf(i,e),r=t instanceof Error?{}:t,s=t instanceof Error?t.message:void 0;return{parsed:r,raw:i,valid:!s,error:s}}const op="studio.vision-tool.saved-queries",Mn={queries:[]},Nr=op;function lp(){const i=me.c(27),e=Nu(),[t,r]=L.useState(Mn),[s,n]=L.useState(!1);let o;i[0]===Symbol.for("react.memo_cache_sentinel")?(o=[],i[0]=o):o=i[0];const[l,a]=L.useState(o),[u,c]=L.useState(),[h,d]=L.useState(),[p,g]=L.useState();let f;i[1]!==e?(f=e.getKey(Nr),i[1]=e,i[2]=f):f=i[2];const m=f;let D;i[3]!==m?(D=()=>{const b=m.pipe(zu(Mn),yl(ap)).subscribe({next:r,error:F=>g(F)});return()=>b?.unsubscribe()},i[3]=m,i[4]=D):D=i[4];let x;i[5]!==e||i[6]!==m?(x=[m,e],i[5]=e,i[6]=m,i[7]=x):x=i[7],L.useEffect(D,x);let k;i[8]!==e||i[9]!==t.queries?(k=async b=>{n(!0),c(void 0);try{const F=[{...b,_key:Wu()},...t.queries];r({queries:F}),await e.setKey(Nr,{queries:F})}catch(F){c(F)}n(!1)},i[8]=e,i[9]=t.queries,i[10]=k):k=i[10];const B=k;let y;i[11]!==e||i[12]!==t.queries?(y=async b=>{n(!0),c(void 0);try{const F=t.queries.map(M=>M._key===b._key?{...M,...b}:M);r({queries:F}),await e.setKey(Nr,{queries:F})}catch(F){c(F)}n(!1)},i[11]=e,i[12]=t.queries,i[13]=y):y=i[13];const E=y;let R;i[14]!==e||i[15]!==t.queries?(R=async b=>{a(F=>[...F,b]),d(void 0);try{const F=t.queries.filter(M=>M._key!==b);r({queries:F}),await e.setKey(Nr,{queries:F})}catch(F){d(F)}a(F=>F.filter(M=>M!==b))},i[14]=e,i[15]=t.queries,i[16]=R):R=i[16];const z=R;let S;return i[17]!==z||i[18]!==h||i[19]!==l||i[20]!==p||i[21]!==B||i[22]!==u||i[23]!==s||i[24]!==E||i[25]!==t.queries?(S={queries:t.queries,saveQuery:B,updateQuery:E,deleteQuery:z,saving:s,deleting:l,saveQueryError:u,deleteQueryError:h,error:p},i[17]=z,i[18]=h,i[19]=l,i[20]=p,i[21]=B,i[22]=u,i[23]=s,i[24]=E,i[25]=t.queries,i[26]=S):S=i[26],S}function ap(i){return i||Mn}const up=ce(je).withConfig({displayName:"FixedHeader",componentId:"sc-14q7beb-0"})`position:sticky;top:0;background:${({theme:i})=>i.sanity.color.base.bg};z-index:1;`,cp=ce(le).withConfig({displayName:"ScrollContainer",componentId:"sc-14q7beb-1"})`height:100%;overflow-y:auto;overflow-x:hidden;&::-webkit-scrollbar{width:8px;}&::-webkit-scrollbar-track{background:transparent;}&::-webkit-scrollbar-thumb{background:${({theme:i})=>i.sanity.color.base.border};border-radius:4px;}`;function hp(i){const e=me.c(80),{url:t,getStateFromUrl:r,setStateFromParsedUrl:s,currentQuery:n,currentParams:o,generateUrl:l}=i,a=bl(),{saveQuery:u,updateQuery:c,queries:h,deleteQuery:d,saving:p,saveQueryError:g}=lp(),{t:f}=bt(At);let m;e[0]===Symbol.for("react.memo_cache_sentinel")?(m={month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0},e[0]=m):m=e[0];const D=ku(m),[x,k]=L.useState(null),[B,y]=L.useState("");let E;e[1]===Symbol.for("react.memo_cache_sentinel")?(E={},e[1]=E):E=e[1];const[R,z]=L.useState(E),[S,b]=L.useState(""),[F,M]=L.useState(t);let v;e[2]!==o||e[3]!==n||e[4]!==D||e[5]!==l||e[6]!==r||e[7]!==h||e[8]!==u||e[9]!==g||e[10]!==f||e[11]!==a?(v=async()=>{const Y=l(n,o);if(h?.some(ne=>{const U=r(ne.url);return U&&U.query===n&&Ei(U.params,o)})){const ne=h?.find(U=>{const Q=r(U.url);return Q&&Q.query===n&&Ei(Q.params,o)});a.push({closable:!0,status:"warning",title:f("save-query.already-saved"),description:`${ne?.title} - ${D.format(new Date(ne?.savedAt||""))}`});return}Y&&(await u({url:Y,savedAt:new Date().toISOString(),title:"Untitled"}),M(Y)),g?a.push({closable:!0,status:"error",title:f("save-query.error"),description:g.message}):a.push({closable:!0,status:"success",title:f("save-query.success")})},e[2]=o,e[3]=n,e[4]=D,e[5]=l,e[6]=r,e[7]=h,e[8]=u,e[9]=g,e[10]=f,e[11]=a,e[12]=v):v=e[12];const j=v;let H;e[13]!==f||e[14]!==a||e[15]!==c?(H=async(Y,ne)=>{k(null),z(U=>({...U,[Y._key]:ne}));try{await c({...Y,title:ne}),z(U=>{const Q={...U};return delete Q[Y._key],Q})}catch(U){const Q=U;z(xe=>{const Fe={...xe};return delete Fe[Y._key],Fe}),a.push({closable:!0,status:"error",title:f("save-query.error"),description:Q.message})}},e[13]=f,e[14]=a,e[15]=c,e[16]=H):H=e[16];const q=H;let _;e[17]!==o||e[18]!==n||e[19]!==D||e[20]!==l||e[21]!==r||e[22]!==h||e[23]!==f||e[24]!==a||e[25]!==c?(_=async Y=>{const ne=l(n,o);if(h?.some(U=>{if(U._key===Y._key)return!1;const Q=r(U.url);return Q&&Q.query===n&&Ei(Q.params,o)})){const U=h?.find(Q=>{if(Q._key===Y._key)return!1;const xe=r(Q.url);return xe&&xe.query===n&&Ei(xe.params,o)});a.push({closable:!0,status:"warning",title:f("save-query.already-saved"),description:`${U?.title} - ${D.format(new Date(U?.savedAt||""))}`});return}try{await c({...Y,url:ne,savedAt:new Date().toISOString()}),M(ne),a.push({closable:!0,status:"success",title:f("save-query.success")})}catch(U){const Q=U;a.push({closable:!0,status:"error",title:f("save-query.error"),description:Q.message})}},e[17]=o,e[18]=n,e[19]=D,e[20]=l,e[21]=r,e[22]=h,e[23]=f,e[24]=a,e[25]=c,e[26]=_):_=e[26];const ee=_;let O,I,ae,A,T;if(e[27]!==o||e[28]!==n||e[29]!==d||e[30]!==x||e[31]!==B||e[32]!==D||e[33]!==r||e[34]!==j||e[35]!==q||e[36]!==ee||e[37]!==R||e[38]!==h||e[39]!==p||e[40]!==S||e[41]!==F||e[42]!==s||e[43]!==f){const Y=h?.filter(oe=>oe?.title?.toLowerCase().includes(S.toLowerCase()));I=cp;let ne;e[49]===Symbol.for("react.memo_cache_sentinel")?(ne={textTransform:"capitalize"},e[49]=ne):ne=e[49];let U;e[50]!==f?(U=f("label.saved-queries"),e[50]=f,e[51]=U):U=e[51];let Q;e[52]!==U?(Q=C.jsx(_e,{weight:"semibold",style:ne,size:4,children:U}),e[52]=U,e[53]=Q):Q=e[53];let xe;e[54]!==f?(xe=f("action.save-query"),e[54]=f,e[55]=xe):xe=e[55];let Fe;e[56]!==j||e[57]!==p||e[58]!==xe?(Fe=C.jsx(st,{label:xe,icon:Hu,disabled:p,onClick:j,mode:"bleed"}),e[56]=j,e[57]=p,e[58]=xe,e[59]=Fe):Fe=e[59];let he;e[60]!==Q||e[61]!==Fe?(he=C.jsxs(Ne,{padding:3,paddingTop:4,paddingBottom:0,justify:"space-between",align:"center",children:[Q,Fe]}),e[60]=Q,e[61]=Fe,e[62]=he):he=e[62];let nt;e[63]!==f?(nt=f("label.search-queries"),e[63]=f,e[64]=nt):nt=e[64];let xt;e[65]===Symbol.for("react.memo_cache_sentinel")?(xt=oe=>b(oe.currentTarget.value),e[65]=xt):xt=e[65];let ot;e[66]!==S||e[67]!==nt?(ot=C.jsx(le,{padding:3,paddingTop:0,children:C.jsx(qr,{placeholder:nt,icon:Vu,value:S,onChange:xt})}),e[66]=S,e[67]=nt,e[68]=ot):ot=e[68],e[69]!==he||e[70]!==ot?(T=C.jsxs(up,{space:3,children:[he,ot]}),e[69]=he,e[70]=ot,e[71]=T):T=e[71],O=je,ae=3,A=Y?.map(oe=>{const ie=r(oe.url),Wt=F===oe.url,yi=ie&&n===ie.query&&Ei(o,ie.params),kt=Wt&&!yi;return C.jsx(be,{width:"fill",padding:4,border:!0,tone:Wt?"positive":"default",onClick:()=>{M(oe.url);const Be=r(oe.url);Be&&s(Be)},style:{position:"relative"},children:C.jsxs(je,{space:3,children:[C.jsxs(Ne,{justify:"space-between",align:"center",children:[C.jsxs(Ne,{align:"center",gap:2,paddingRight:1,children:[x===oe._key?C.jsx(qr,{value:B,onChange:Be=>y(Be.currentTarget.value),onKeyDown:Be=>{Be.key==="Enter"?q(oe,B):Be.key==="Escape"&&k(null)},onBlur:()=>q(oe,B),autoFocus:!0,style:{maxWidth:"170px",height:"24px"}}):C.jsx(_e,{weight:"bold",size:3,textOverflow:"ellipsis",style:{maxWidth:"170px",cursor:"pointer",padding:"4px 0"},title:R[oe._key]||oe.title||oe._key.slice(oe._key.length-5,oe._key.length),onClick:()=>{k(oe._key),y(oe.title||oe._key.slice(0,5))},children:R[oe._key]||oe.title||oe._key.slice(oe._key.length-5,oe._key.length)}),kt&&C.jsx(le,{style:{width:"6px",height:"6px",borderRadius:"50%",backgroundColor:"var(--card-focus-ring-color)"}})]}),C.jsx(Mu,{button:C.jsx(Lu,{}),id:`${oe._key}-menu`,menu:C.jsx(Ou,{children:C.jsx(Ru,{tone:"critical",padding:3,icon:Tu,text:f("action.delete"),onClick:Be=>{Be.stopPropagation(),d(oe._key)}})}),popover:{portal:!0,placement:"bottom-end",tone:"default"}})]}),C.jsx(is,{muted:!0,children:ie?.query.split("{")[0]}),C.jsx(Ne,{align:"center",gap:1,children:C.jsx(_e,{size:1,muted:!0,children:D.format(new Date(oe.savedAt||""))})}),kt&&C.jsx(st,{mode:"ghost",tone:"default",size:1,padding:2,style:{height:"24px",position:"absolute",right:"16px",bottom:"16px",fontSize:"12px"},text:f("action.update"),onClick:Be=>{Be.stopPropagation(),ee(oe)}})]})},oe._key)}),e[27]=o,e[28]=n,e[29]=d,e[30]=x,e[31]=B,e[32]=D,e[33]=r,e[34]=j,e[35]=q,e[36]=ee,e[37]=R,e[38]=h,e[39]=p,e[40]=S,e[41]=F,e[42]=s,e[43]=f,e[44]=O,e[45]=I,e[46]=ae,e[47]=A,e[48]=T}else O=e[44],I=e[45],ae=e[46],A=e[47],T=e[48];let W;e[72]!==O||e[73]!==ae||e[74]!==A?(W=C.jsx(O,{paddingY:ae,children:A}),e[72]=O,e[73]=ae,e[74]=A,e[75]=W):W=e[75];let $;return e[76]!==I||e[77]!==T||e[78]!==W?($=C.jsxs(I,{children:[T,W]}),e[76]=I,e[77]=T,e[78]=W,e[79]=$):$=e[79],$}function Xn(){return typeof window<"u"&&window.innerWidth>600}function Za(i){let e=i;return e||(e=typeof window<"u"&&typeof document<"u"?document.body.getBoundingClientRect().height-60:0),{defaultSize:e/(Xn()?2:1),size:e>550?void 0:e*.4,allowResize:e>550,minSize:Math.min(170,Math.max(170,e/2)),maxSize:e>650?e*.7:e*.6}}function dp(i){const e=me.c(6),{visionRootRef:t}=i,[r,s]=L.useState(pp),[n,o]=L.useState(fp);let l,a;e[0]!==t?(l=()=>{if(!t.current)return;const c=d=>{s(Xn());const p=d?.[0];p&&o(Za(p.contentRect.height))},h=new ResizeObserver(c);return h.observe(t.current),()=>{h.disconnect()}},a=[t],e[0]=t,e[1]=l,e[2]=a):(l=e[1],a=e[2]),L.useEffect(l,a);let u;return e[3]!==r||e[4]!==n?(u={paneSizeOptions:n,isNarrowBreakpoint:r},e[3]=r,e[4]=n,e[5]=u):u=e[5],u}function fp(){return Za(void 0)}function pp(){return Xn()}function gp(i){const e=me.c(30),{hasValidParams:t,listenInProgress:r,queryInProgress:s,onQueryExecution:n,onListenExecution:o}=i,{t:l}=bt(At);let a;e[0]!==l?(a=l("params.error.params-invalid-json"),e[0]=l,e[1]=a):a=e[1];let u;e[2]!==a?(u=C.jsx(be,{radius:4,children:C.jsx(_e,{size:1,muted:!0,children:a})}),e[2]=a,e[3]=u):u=e[3];let c;e[4]===Symbol.for("react.memo_cache_sentinel")?(c=C.jsx(be,{radius:4,children:C.jsx(vu,{keys:["Ctrl","Enter"]})}),e[4]=c):c=e[4];const h=s?to:io,d=r||!t,p=s?"positive":"primary";let g;e[5]!==s||e[6]!==l?(g=l(s?"action.query-cancel":"action.query-execute"),e[5]=s,e[6]=l,e[7]=g):g=e[7];let f;e[8]!==n||e[9]!==h||e[10]!==d||e[11]!==p||e[12]!==g?(f=C.jsx(le,{flex:1,children:C.jsx(zi,{content:c,placement:"top",portal:!0,children:C.jsx(st,{width:"fill",onClick:n,type:"button",icon:h,disabled:d,tone:p,text:g})})}),e[8]=n,e[9]=h,e[10]=d,e[11]=p,e[12]=g,e[13]=f):f=e[13];const m=r?to:io;let D;e[14]!==r||e[15]!==l?(D=l(r?"action.listen-cancel":"action.listen-execute"),e[14]=r,e[15]=l,e[16]=D):D=e[16];const x=!t,k=r?"positive":"default";let B;e[17]!==o||e[18]!==D||e[19]!==x||e[20]!==k||e[21]!==m?(B=C.jsx(le,{flex:1,marginLeft:3,children:C.jsx(st,{width:"fill",onClick:o,type:"button",icon:m,text:D,mode:"ghost",disabled:x,tone:k})}),e[17]=o,e[18]=D,e[19]=x,e[20]=k,e[21]=m,e[22]=B):B=e[22];let y;e[23]!==B||e[24]!==f?(y=C.jsxs(Ne,{justify:"space-evenly",children:[f,B]}),e[23]=B,e[24]=f,e[25]=y):y=e[25];let E;return e[26]!==t||e[27]!==y||e[28]!==u?(E=C.jsx(rp,{children:C.jsx(be,{padding:3,paddingX:3,children:C.jsx(zi,{content:u,placement:"top",disabled:t,portal:!0,children:y})})}),e[26]=t,e[27]=y,e[28]=u,e[29]=E):E=e[29],E}const mp=ce(le).withConfig({displayName:"PerspectivePopoverContent",componentId:"sc-ls0jfp-0"})`max-width:240px;`,Dp=ce.a.withConfig({displayName:"PerspectivePopoverLink",componentId:"sc-ls0jfp-1"})`cursor:pointer;margin-right:auto;`,Cp=ce.div.withConfig({displayName:"Dot",componentId:"sc-y1ykk8-0"})`width:4px;height:4px;border-radius:3px;box-shadow:0 0 0 1px var(--card-bg-color);background-color:${({$tone:i})=>`var(--card-badge-${i}-dot-color)`};`;function yp(){const i=me.c(39),[e,t]=L.useState(!1),r=L.useRef(null),s=L.useRef(null);let n;i[0]===Symbol.for("react.memo_cache_sentinel")?(n=()=>t(bp),i[0]=n):n=i[0];const o=n,{t:l}=bt(At);let a,u;i[1]===Symbol.for("react.memo_cache_sentinel")?(a=()=>t(!1),u=()=>[r.current,s.current],i[1]=a,i[2]=u):(a=i[1],u=i[2]),$u(a,u);let c;i[3]!==l?(c=l("settings.perspectives.title"),i[3]=l,i[4]=c):c=i[4];let h;i[5]!==c?(h=C.jsx(Sl,{space:2,children:C.jsx(_e,{weight:"medium",children:c})}),i[5]=c,i[6]=h):h=i[6];let d;i[7]!==l?(d=l("settings.perspectives.description"),i[7]=l,i[8]=d):d=i[8];let p;i[9]!==d?(p=C.jsx(be,{children:C.jsx(_e,{muted:!0,children:d})}),i[9]=d,i[10]=p):p=i[10];let g;i[11]!==l?(g=l("label.new"),i[11]=l,i[12]=g):g=i[12];let f;i[13]!==g?(f=C.jsx(le,{children:C.jsx(Uu,{tone:"primary",children:g})}),i[13]=g,i[14]=f):f=i[14];let m;i[15]!==l?(m=C.jsx(_e,{muted:!0,children:C.jsx(vl,{t:l,i18nKey:"settings.perspective.preview-drafts-renamed-to-drafts.description"})}),i[15]=l,i[16]=m):m=i[16];let D;i[17]!==f||i[18]!==m?(D=C.jsx(be,{children:C.jsxs(je,{space:2,children:[f,m]})}),i[17]=f,i[18]=m,i[19]=D):D=i[19];let x;i[20]!==l?(x=null,i[20]=l,i[21]=x):x=i[21];let k;i[22]!==l?(k=l("settings.perspectives.action.docs-link"),i[22]=l,i[23]=k):k=i[23];let B;i[24]!==k?(B=C.jsx(be,{children:C.jsx(_e,{children:C.jsxs(Dp,{href:"https://www.sanity.io/docs/perspectives",target:"_blank",children:[k," "]})})}),i[24]=k,i[25]=B):B=i[25];let y;i[26]!==D||i[27]!==x||i[28]!==B||i[29]!==h||i[30]!==p?(y=C.jsx(mp,{children:C.jsxs(je,{space:4,children:[h,p,D,x,B]})}),i[26]=D,i[27]=x,i[28]=B,i[29]=h,i[30]=p,i[31]=y):y=i[31];let E;i[32]===Symbol.for("react.memo_cache_sentinel")?(E=C.jsx(Cp,{$tone:"primary"}),i[32]=E):E=i[32];let R;i[33]!==e?(R=C.jsx(st,{icon:Qu,mode:"bleed",padding:2,paddingRight:1,tone:"primary",fontSize:1,ref:r,onClick:o,selected:e,children:E}),i[33]=e,i[34]=R):R=i[34];let z;return i[35]!==e||i[36]!==y||i[37]!==R?(z=C.jsx(Ku,{content:y,placement:"bottom-start",portal:!0,padding:3,ref:s,open:e,children:R}),i[35]=e,i[36]=y,i[37]=R,i[38]=z):z=i[38],z}function bp(i){return!i}const Ap=i=>{const e=me.c(11),{pinnedPerspective:t,t:r}=i,s=typeof t.selectedPerspective=="object"?t.selectedPerspective.metadata.title:t.selectedPerspectiveName;let n;e[0]!==t||e[1]!==r?(n=pl(t)?`(${r("settings.perspectives.pinned-release-label")})`:r("settings.perspectives.pinned-release-label"),e[0]=t,e[1]=r,e[2]=n):n=e[2];const o=n;let l;e[3]!==o||e[4]!==s?(l=[s,o].filter(wp),e[3]=o,e[4]=s,e[5]=l):l=e[5];const a=l.join(" ");let u;e[6]!==t?(u=pl(t),e[6]=t,e[7]=u):u=e[7];const c=!u;let h;return e[8]!==c||e[9]!==a?(h=C.jsx("option",{value:"pinnedRelease",disabled:c,children:a}),e[8]=c,e[9]=a,e[10]=h):h=e[10],h};function xp(i){const e=me.c(65),{onChangeDataset:t,dataset:r,customApiVersion:s,apiVersion:n,onChangeApiVersion:o,datasets:l,customApiVersionElementRef:a,onCustomApiVersionChange:u,isValidApiVersion:c,onChangePerspective:h,url:d,perspective:p,isScheduledDraftsEnabled:g}=i,f=Al(),{t:m}=bt(At),D=L.useRef(null);let x;e[0]===Symbol.for("react.memo_cache_sentinel")?(x=()=>{const Q=D.current;if(Q)try{Q.select(),document.execCommand("copy")}catch{console.error("Unable to copy to clipboard :(")}},e[0]=x):x=e[0];const k=x;let B;e[1]===Symbol.for("react.memo_cache_sentinel")?(B=[1,4,8,12],e[1]=B):B=e[1];let y;e[2]!==m?(y=m("settings.dataset-label"),e[2]=m,e[3]=y):y=e[3];let E;e[4]!==y?(E=C.jsx(be,{paddingTop:2,paddingBottom:3,children:C.jsx(pt,{children:y})}),e[4]=y,e[5]=E):E=e[5];let R;e[6]!==l?(R=l.map(vp),e[6]=l,e[7]=R):R=e[7];let z;e[8]!==r||e[9]!==t||e[10]!==R?(z=C.jsx(Ls,{value:r,onChange:t,children:R}),e[8]=r,e[9]=t,e[10]=R,e[11]=z):z=e[11];let S;e[12]!==E||e[13]!==z?(S=C.jsx(le,{padding:1,column:2,children:C.jsxs(je,{children:[E,z]})}),e[12]=E,e[13]=z,e[14]=S):S=e[14];let b;e[15]!==m?(b=m("settings.api-version-label"),e[15]=m,e[16]=b):b=e[16];let F;e[17]!==b?(F=C.jsx(be,{paddingTop:2,paddingBottom:3,children:C.jsx(pt,{children:b})}),e[17]=b,e[18]=F):F=e[18];const M=s===!1?n:"other";let v;e[19]===Symbol.for("react.memo_cache_sentinel")?(v=Ii.map(Sp),e[19]=v):v=e[19];let j;e[20]!==m?(j=m("settings.other-api-version-label"),e[20]=m,e[21]=j):j=e[21];let H;e[22]!==j?(H=C.jsx("option",{value:"other",children:j},"other"),e[22]=j,e[23]=H):H=e[23];let q;e[24]!==o||e[25]!==M||e[26]!==H?(q=C.jsxs(Ls,{"data-testid":"api-version-selector",value:M,onChange:o,children:[v,H]}),e[24]=o,e[25]=M,e[26]=H,e[27]=q):q=e[27];let _;e[28]!==q||e[29]!==F?(_=C.jsx(le,{padding:1,column:2,children:C.jsxs(je,{children:[F,q]})}),e[28]=q,e[29]=F,e[30]=_):_=e[30];let ee;e[31]!==s||e[32]!==a||e[33]!==c||e[34]!==u||e[35]!==m?(ee=s!==!1&&C.jsx(le,{padding:1,column:2,children:C.jsxs(je,{children:[C.jsx(be,{paddingTop:2,paddingBottom:3,children:C.jsx(pt,{textOverflow:"ellipsis",children:m("settings.custom-api-version-label")})}),C.jsx(qr,{ref:a,value:s,onChange:u,customValidity:c?void 0:m("settings.error.invalid-api-version"),maxLength:11})]})}),e[31]=s,e[32]=a,e[33]=c,e[34]=u,e[35]=m,e[36]=ee):ee=e[36];let O;e[37]!==m?(O=m("settings.perspective-label"),e[37]=m,e[38]=O):O=e[38];let I;e[39]!==O?(I=C.jsx(le,{children:C.jsx(pt,{children:O})}),e[39]=O,e[40]=I):I=e[40];let ae;e[41]===Symbol.for("react.memo_cache_sentinel")?(ae=C.jsx(le,{children:C.jsx(yp,{})}),e[41]=ae):ae=e[41];let A;e[42]!==I?(A=C.jsx(be,{paddingBottom:1,children:C.jsxs(Sl,{space:1,children:[I,ae]})}),e[42]=I,e[43]=A):A=e[43];const T=p||"default";let W;e[44]!==g||e[45]!==f||e[46]!==m?(W=Ua.map(Q=>Q==="pinnedRelease"?C.jsxs(L.Fragment,{children:[C.jsx(Ap,{pinnedPerspective:f,t:m}),C.jsx("option",{value:"default",children:m("settings.perspectives.default")},"default"),C.jsx("hr",{})]},"pinnedRelease"):Q==="scheduledDrafts"?g?C.jsx("option",{value:"scheduledDrafts",children:m("settings.perspectives.scheduled-drafts")},"scheduledDrafts"):null:C.jsx("option",{children:Q},Q)),e[44]=g,e[45]=f,e[46]=m,e[47]=W):W=e[47];let $;e[48]!==h||e[49]!==T||e[50]!==W?($=C.jsx(Ls,{value:T,onChange:h,children:W}),e[48]=h,e[49]=T,e[50]=W,e[51]=$):$=e[51];let Y;e[52]!==A||e[53]!==$?(Y=C.jsx(le,{padding:1,column:2,children:C.jsxs(je,{children:[A,$]})}),e[52]=A,e[53]=$,e[54]=Y):Y=e[54];let ne;e[55]!==s||e[56]!==m||e[57]!==d?(ne=typeof d=="string"?C.jsx(le,{padding:1,flex:1,column:s===!1?6:4,children:C.jsxs(je,{children:[C.jsx(be,{paddingTop:2,paddingBottom:3,children:C.jsxs(pt,{children:[m("query.url"),"",C.jsxs(Uf,{onClick:k,children:["[",m("action.copy-url-to-clipboard"),"]"]})]})}),C.jsxs(Ne,{flex:1,gap:1,children:[C.jsx(le,{flex:1,children:C.jsx(qr,{readOnly:!0,type:"url",ref:D,value:d})}),C.jsx(zi,{content:m("action.copy-url-to-clipboard"),children:C.jsx(st,{"aria-label":m("action.copy-url-to-clipboard"),type:"button",mode:"ghost",icon:Fu,onClick:k})})]})]})}):C.jsx(le,{flex:1}),e[55]=s,e[56]=m,e[57]=d,e[58]=ne):ne=e[58];let U;return e[59]!==_||e[60]!==ee||e[61]!==Y||e[62]!==ne||e[63]!==S?(U=C.jsx($f,{paddingX:3,paddingY:2,children:C.jsxs(Bu,{columns:B,children:[S,_,ee,Y,ne]})}),e[59]=_,e[60]=ee,e[61]=Y,e[62]=ne,e[63]=S,e[64]=U):U=e[64],U}function Sp(i){return C.jsx("option",{children:i},i)}function vp(i){return C.jsx("option",{children:i},i)}function wp(i){return typeof i<"u"}function Ep(i,e){return URL.createObjectURL(new Blob([i],{type:e}))}function eu(i,e){return(()=>{let t="",r="";return s=>{const n=e(s);if(!(typeof n!="string"||n===""))return n===r||(r=n,t&&URL.revokeObjectURL(t),t=Ep(n,i)),t}})()}const Fp=eu("application/json",i=>JSON.stringify(i,null,2)),Bp=eu("text/csv",i=>Bf.json2csv(Array.isArray(i)?i:[i]).trim()),On=ce(is).withConfig({displayName:"ErrorCode",componentId:"sc-14lyn64-0"})`color:${({theme:i})=>i.sanity.color.muted.critical.enabled.fg};`;function kp(i){const e=me.c(20),{error:t}=i,{t:r}=bt(At);if(!("details"in t))return null;const s=t.details;let n,o,l,a,u,c;if(e[0]!==t.details){c=Symbol.for("react.early_return_sentinel");e:{if(o={...s,...Mp(t.details)},!o.line){c=null;break e}n=On,u=1,l=o.line,a=Op(o.column,o.columnEnd)}e[0]=t.details,e[1]=n,e[2]=o,e[3]=l,e[4]=a,e[5]=u,e[6]=c}else n=e[1],o=e[2],l=e[3],a=e[4],u=e[5],c=e[6];if(c!==Symbol.for("react.early_return_sentinel"))return c;const h=`${l}
${a}`;let d;e[7]!==n||e[8]!==u||e[9]!==h?(d=C.jsx(n,{size:u,children:h}),e[7]=n,e[8]=u,e[9]=h,e[10]=d):d=e[10];let p;e[11]!==r?(p=r("query.error.line"),e[11]=r,e[12]=p):p=e[12];const g=o.lineNumber;let f;e[13]!==r?(f=r("query.error.column"),e[13]=r,e[14]=f):f=e[14];const m=`${p}:   ${g}
${f}: ${o.column}`;let D;e[15]!==m?(D=C.jsx(le,{marginTop:4,children:C.jsx(On,{size:1,children:m})}),e[15]=m,e[16]=D):D=e[16];let x;return e[17]!==D||e[18]!==d?(x=C.jsxs("div",{children:[d,D]}),e[17]=D,e[18]=d,e[19]=x):x=e[19],x}function Mp(i){if(!i||typeof i.query!="string"||typeof i.start!="number")return{};const{query:e,start:t,end:r}=i,s=e.slice(0,t).lastIndexOf(`
`)+1,n=(e.slice(0,s).match(/\n/g)||[]).length,o=e.slice(s,e.indexOf(`
`,s)),l=t-s,a=typeof r=="number"?r-s:void 0;return{line:o,lineNumber:n,column:l,columnEnd:a}}function Op(i,e){const t="-".repeat(i),r="^".repeat(e?e-i:1);return`${t}${r}`}function Rp(i){const e=me.c(7);let t;e[0]!==i.error.message?(t=C.jsx(On,{size:1,children:i.error.message}),e[0]=i.error.message,e[1]=t):t=e[1];let r;e[2]!==i.error?(r=C.jsx(kp,{error:i.error}),e[2]=i.error,e[3]=r):r=e[3];let s;return e[4]!==t||e[5]!==r?(s=C.jsxs(je,{space:5,marginTop:2,children:[t,r]}),e[4]=t,e[5]=r,e[6]=s):s=e[6],s}const Tp=ce.div.withConfig({displayName:"ResultViewWrapper",componentId:"sc-nbqtaq-0"})(({theme:i})=>{const{color:e,fonts:t,space:r}=i.sanity;return xl`
    & .json-inspector,
    & .json-inspector .json-inspector__selection {
      font-family: ${t.code.family};
      font-size: ${t.code.sizes[2].fontSize}px;
      line-height: ${t.code.sizes[2].lineHeight}px;
      color: var(--card-code-fg-color);
    }

    & .json-inspector .json-inspector__leaf {
      padding-left: ${Ye(r[4])};
    }

    & .json-inspector .json-inspector__leaf.json-inspector__leaf_root {
      padding-top: ${Ye(r[0])};
      padding-left: 0;
    }

    & .json-inspector > .json-inspector__leaf_root > .json-inspector__line > .json-inspector__key {
      display: none;
    }

    & .json-inspector .json-inspector__line {
      display: block;
      position: relative;
      cursor: default;
    }

    & .json-inspector .json-inspector__line::after {
      content: '';
      position: absolute;
      top: 0;
      left: -200px;
      right: -50px;
      bottom: 0;
      z-index: -1;
      pointer-events: none;
    }

    & .json-inspector .json-inspector__line:hover::after {
      background: var(--card-code-bg-color);
    }

    & .json-inspector .json-inspector__leaf_composite > .json-inspector__line {
      cursor: pointer;
    }

    & .json-inspector .json-inspector__leaf_composite > .json-inspector__line::before {
      content: ' ';
      margin-left: calc(0px - ${Ye(r[4])});
      font-size: ${t.code.sizes[2].fontSize}px;
      line-height: ${t.code.sizes[2].lineHeight}px;
    }

    &
      .json-inspector
      .json-inspector__leaf_expanded.json-inspector__leaf_composite
      > .json-inspector__line::before {
      content: ' ';
      font-size: ${t.code.sizes[2].fontSize}px;
      line-height: ${t.code.sizes[2].lineHeight}px;
    }

    & .json-inspector .json-inspector__radio,
    & .json-inspector .json-inspector__flatpath {
      display: none;
    }

    & .json-inspector .json-inspector__value {
      margin-left: ${Ye(r[4]/2)};
    }

    &
      .json-inspector
      > .json-inspector__leaf_root
      > .json-inspector__line
      > .json-inspector__key
      + .json-inspector__value {
      margin: 0;
    }

    & .json-inspector .json-inspector__key {
      color: ${e.syntax.property};
    }

    & .json-inspector .json-inspector__value_helper,
    & .json-inspector .json-inspector__value_null {
      color: ${e.syntax.constant};
    }

    & .json-inspector .json-inspector__not-found {
      padding-top: ${Ye(r[2])};
    }

    & .json-inspector .json-inspector__value_string {
      color: ${e.syntax.string};
      word-break: break-word;
    }

    & .json-inspector .json-inspector__value_boolean {
      color: ${e.syntax.boolean};
    }

    & .json-inspector .json-inspector__value_number {
      color: ${e.syntax.number};
    }

    & .json-inspector .json-inspector__show-original {
      display: inline-block;
      padding: 0 6px;
      cursor: pointer;
    }

    & .json-inspector .json-inspector__show-original:hover {
      color: inherit;
    }

    & .json-inspector .json-inspector__show-original::before {
      content: '';
    }

    & .json-inspector .json-inspector__show-original:hover::after {
      content: ' expand';
    }
  `}),Rn=new Of({maxSize:5e4});function Dl(i){const e=me.c(7),{data:t,datasetName:r}=i,s=Pu();if(tu(t)||Array.isArray(t)){const l=s===r?Lp:void 0;let a;return e[0]!==t||e[1]!==l?(a=C.jsx(Tp,{children:C.jsx(ju,{data:t,search:!1,isExpanded:Pp,onClick:jp,interactiveLabel:l})}),e[0]=t,e[1]=l,e[2]=a):a=e[2],a}let n;e[3]!==t?(n=JSON.stringify(t),e[3]=t,e[4]=n):n=e[4];let o;return e[5]!==n?(o=C.jsx(is,{language:"json",children:n}),e[5]=n,e[6]=o):o=e[6],o}function Lp(i){const e=me.c(5);if(i.isKey||!i.keypath.endsWith("_id")&&!i.keypath.endsWith("_ref"))return null;let t;e[0]!==i.value?(t={id:i.value},e[0]=i.value,e[1]=t):t=e[1];let r;e[2]===Symbol.for("react.memo_cache_sentinel")?(r=C.jsx(qu,{}),e[2]=r):r=e[2];let s;return e[3]!==t?(s=C.jsx(_u,{intent:"edit",params:t,children:r}),e[3]=t,e[4]=s):s=e[4],s}function Pp(i,e){const t=Rn.get(i);if(typeof t=="boolean")return t;const r=i.split(".",4);return r.length===4?!1:Array.isArray(e)?!0:tu(e)&&!r.some(s=>_p(s))}function jp(i){const{path:e}=i,t=Rn.get(e);t!==void 0&&Rn.set(e,!t)}function tu(i){return i!==null&&typeof i=="object"&&!Array.isArray(i)}const Np=/^\d+$/;function _p(i,e=10){return Np.test(i)&&parseInt(i,10)>e}function Ip(i){return i.preventDefault()}function zp(i){const e=me.c(9),{blobUrl:t}=i,{t:r}=bt(At),s=!t,n=s?void 0:"query-result.csv",o=s?Ip:void 0;let l;e[0]!==t||e[1]!==s||e[2]!==n||e[3]!==o?(l=C.jsx(st,{as:"a",disabled:s,download:n,href:t,icon:wl,mode:"ghost",onClick:o,text:"CSV",tone:"default"}),e[0]=t,e[1]=s,e[2]=n,e[3]=o,e[4]=l):l=e[4];const a=l;let u;return e[5]!==a||e[6]!==s||e[7]!==r?(u=s?C.jsx(zi,{content:r("result.save-result-as-csv.not-csv-encodable"),placement:"top",children:a}):a,e[5]=a,e[6]=s,e[7]=r,e[8]=u):u=e[8],u}function Wp(i){const e=me.c(2),{blobUrl:t}=i;let r;return e[0]!==t?(r=C.jsx(st,{as:"a",download:"query-result.json",href:t,icon:wl,mode:"ghost",text:"JSON",tone:"default"}),e[0]=t,e[1]=r):r=e[1],r}function Hp(i){const e=me.c(67),{error:t,queryInProgress:r,queryResult:s,listenInProgress:n,listenMutations:o,dataset:l,queryTime:a,e2eTime:u}=i,{t:c}=bt(At),h=!t&&!r&&typeof s<"u";let d;e[0]!==h||e[1]!==s?(d=h?Fp(s):"",e[0]=h,e[1]=s,e[2]=d):d=e[2];const p=d;let g;e[3]!==h||e[4]!==s?(g=h?Bp(s):"",e[3]=h,e[4]=s,e[5]=g):g=e[5];const f=g,m=t?"critical":"default",D=!!t;let x;e[6]!==c?(x=c("result.label"),e[6]=c,e[7]=x):x=e[7];let k;e[8]!==x?(k=C.jsx(Ga,{children:C.jsx(le,{marginLeft:3,children:C.jsx(pt,{muted:!0,children:x})})}),e[8]=x,e[9]=k):k=e[9];let B;e[10]!==n||e[11]!==o||e[12]!==r?(B=(r||n&&o.length===0)&&C.jsx(le,{marginTop:3,children:C.jsx(Ka,{})}),e[10]=n,e[11]=o,e[12]=r,e[13]=B):B=e[13];let y;e[14]!==t?(y=t&&C.jsx(Rp,{error:t}),e[14]=t,e[15]=y):y=e[15];let E;e[16]!==l||e[17]!==h||e[18]!==s?(E=h&&C.jsx(Dl,{data:s,datasetName:l}),e[16]=l,e[17]=h,e[18]=s,e[19]=E):E=e[19];let R;e[20]!==l||e[21]!==n||e[22]!==o?(R=n&&o.length>0&&C.jsx(Dl,{data:o,datasetName:l}),e[20]=l,e[21]=n,e[22]=o,e[23]=R):R=e[23];let z;e[24]!==R||e[25]!==B||e[26]!==y||e[27]!==E?(z=C.jsxs(le,{padding:3,paddingTop:5,children:[B,y,E,R]}),e[24]=R,e[25]=B,e[26]=y,e[27]=E,e[28]=z):z=e[28];let S;e[29]!==z||e[30]!==k?(S=C.jsxs(Gf,{overflow:"auto",children:[k,z]}),e[29]=z,e[30]=k,e[31]=S):S=e[31];let b;e[32]!==S||e[33]!==m||e[34]!==D?(b=C.jsx(Jf,{flex:1,children:C.jsx(Yf,{flex:1,overflow:"hidden",tone:m,$isInvalid:D,children:S})}),e[32]=S,e[33]=m,e[34]=D,e[35]=b):b=e[35];let F;e[36]===Symbol.for("react.memo_cache_sentinel")?(F=["column","column","row"],e[36]=F):F=e[36];let M;e[37]!==c?(M=c("result.execution-time-label"),e[37]=c,e[38]=M):M=e[38];let v;e[39]!==a||e[40]!==c?(v=typeof a=="number"?`${a}ms`:c("result.timing-not-applicable"),e[39]=a,e[40]=c,e[41]=v):v=e[41];let j;e[42]!==M||e[43]!==v?(j=C.jsx(le,{children:C.jsxs(_e,{muted:!0,children:[M,":"," ",v]})}),e[42]=M,e[43]=v,e[44]=j):j=e[44];let H;e[45]!==c?(H=c("result.end-to-end-time-label"),e[45]=c,e[46]=H):H=e[46];let q;e[47]!==u||e[48]!==c?(q=typeof u=="number"?`${u}ms`:c("result.timing-not-applicable"),e[47]=u,e[48]=c,e[49]=q):q=e[49];let _;e[50]!==H||e[51]!==q?(_=C.jsx(le,{marginLeft:4,children:C.jsxs(_e,{muted:!0,children:[H,":"," ",q]})}),e[50]=H,e[51]=q,e[52]=_):_=e[52];let ee;e[53]!==j||e[54]!==_?(ee=C.jsx(Zf,{paddingX:4,paddingY:3,sizing:"border",children:C.jsxs(ep,{align:"center",children:[j,_]})}),e[53]=j,e[54]=_,e[55]=ee):ee=e[55];let O;e[56]!==f||e[57]!==h||e[58]!==p||e[59]!==c?(O=h&&C.jsx(tp,{paddingX:4,paddingY:3,sizing:"border",children:C.jsx(ip,{muted:!0,children:C.jsx(vl,{components:{SaveResultButtons:()=>C.jsxs(C.Fragment,{children:[C.jsx(Wp,{blobUrl:p}),C.jsx(zp,{blobUrl:f})]})},i18nKey:"result.save-result-as-format",t:c})})}),e[56]=f,e[57]=h,e[58]=p,e[59]=c,e[60]=O):O=e[60];let I;e[61]!==ee||e[62]!==O?(I=C.jsxs(Xf,{justify:"space-between",direction:F,children:[ee,O]}),e[61]=ee,e[62]=O,e[63]=I):I=e[63];let ae;return e[64]!==b||e[65]!==I?(ae=C.jsxs(Qf,{direction:"column","data-testid":"vision-result",children:[b,I]}),e[64]=b,e[65]=I,e[66]=ae):ae=e[66],ae}function Vp(i,e){return!i||!e?!1:i===e||!!(i.compareDocumentPosition(e)&16)}const qp=/\/(vX|v1|v\d{4}-\d\d-\d\d)\/.*?(?:query|listen)\/(.*?)\?(.*)/,$p=i=>ro("ctrl+enter",i)||ro("mod+enter",i);function Kp(i){const e=me.c(210),{datasets:t,config:r,projectId:s,defaultDataset:n}=i,o=bl(),{t:l}=bt(At),{perspectiveStack:a}=Al(),u=gu(),{data:c}=mu();let h;e[0]!==c?(h=c===void 0?[]:c,e[0]=c,e[1]=h):h=e[1];const d=h,p=Du().document.drafts.enabled,g=L.useRef(null),f=L.useRef(null),m=L.useRef(null),D=L.useRef(null),x=L.useRef(void 0),k=L.useRef(void 0);let B;e[2]!==s?(B=()=>zf(s||"default"),e[2]=s,e[3]=B):B=e[3];const[y]=L.useState(B);let E;e[4]!==n||e[5]!==y?(E=y.get("dataset",n),e[4]=n,e[5]=y,e[6]=E):E=e[6];const R=E;let z;e[7]!==r.defaultApiVersion||e[8]!==y?(z=y.get("apiVersion",Vf(`${r.defaultApiVersion}`)),e[7]=r.defaultApiVersion,e[8]=y,e[9]=z):z=e[9];const S=z;let b;e[10]!==y?(b=y.get("query",""),e[10]=y,e[11]=b):b=e[11];const F=b;let M;e[12]!==y?(M=y.get("params",`{
  
}`),e[12]=y,e[13]=M):M=e[13];const v=M;let j;e[14]!==y?(j=y.get("perspective",void 0),e[14]=y,e[15]=j):j=e[15];const H=j;let q;e[16]!==t||e[17]!==n||e[18]!==R?(q=()=>t.includes(R)?R:t.includes(n)?n:t[0],e[16]=t,e[17]=n,e[18]=R,e[19]=q):q=e[19];const[_,ee]=L.useState(q);let O;e[20]!==S?(O=()=>Ii.includes(S)?S:$a,e[20]=S,e[21]=O):O=e[21];const[I,ae]=L.useState(O);let A;e[22]!==S?(A=()=>Ii.includes(S)?!1:S,e[22]=S,e[23]=A):A=e[23];const[T,W]=L.useState(A),[$,Y]=L.useState(H||"raw");let ne;e[24]!==T?(ne=T?rn(T):!0,e[24]=T,e[25]=ne):ne=e[25];const U=ne,[Q,xe]=L.useState(void 0);let Fe;e[26]!==F?(Fe=()=>typeof F=="string"?F:"",e[26]=F,e[27]=Fe):Fe=e[27];const[he,nt]=L.useState(Fe),[xt,ot]=L.useState(v);let oe;e[28]!==xt||e[29]!==l?(oe=ml(xt,l),e[28]=xt,e[29]=l,e[30]=oe):oe=e[30];const ie=oe,[Wt,yi]=L.useState(void 0);let kt;e[31]===Symbol.for("react.memo_cache_sentinel")?(kt=[],e[31]=kt):kt=e[31];const[Be,cs]=L.useState(kt),[hs,bi]=L.useState(void 0),[ds,fs]=L.useState(void 0),[ps,gs]=L.useState(void 0),[lt,Ai]=L.useState(!1),[at,Yi]=L.useState(!1),[Mt,iu]=L.useState(!1);let Gi;e[32]===Symbol.for("react.memo_cache_sentinel")?(Gi={visionRootRef:m},e[32]=Gi):Gi=e[32];const{paneSizeOptions:Ie,isNarrowBreakpoint:ms}=dp(Gi);let Ds;e:{if(!u){Ds=void 0;break e}let P;if(e[33]!==p||e[34]!==d){const V=d.filter(Qp),ke=Cu(V).map(Up);let $e;e[36]!==p?($e=p?["drafts"]:["published"],e[36]=p,e[37]=$e):$e=e[37];const wi=$e;P=[...ke,...wi],e[33]=p,e[34]=d,e[35]=P}else P=e[35];Ds=P}const ut=Ds,Cs=U&&T?T:I;let Xi;e[38]!==Cs?(Xi={apiVersion:Cs},e[38]=Cs,e[39]=Xi):Xi=e[39];const ys=Tn(Xi);let Zi;e[40]!==ys||e[41]!==I||e[42]!==T||e[43]!==_||e[44]!==U||e[45]!==$||e[46]!==a||e[47]!==ut?(Zi=ys.withConfig({apiVersion:U&&T?T:I,perspective:en({visionPerspective:$,perspectiveStack:a,scheduledDraftsStack:ut}),dataset:_,allowReconfigure:!0}),e[40]=ys,e[41]=I,e[42]=T,e[43]=_,e[44]=U,e[45]=$,e[46]=a,e[47]=ut,e[48]=Zi):Zi=e[48];const qe=Zi;let er;e[49]===Symbol.for("react.memo_cache_sentinel")?(er=()=>{x.current&&(x.current.unsubscribe(),x.current=void 0)},e[49]=er):er=e[49];const tr=er;let ir;e[50]===Symbol.for("react.memo_cache_sentinel")?(ir=()=>{k.current&&(k.current.unsubscribe(),k.current=void 0)},e[50]=ir):ir=e[50];const xi=ir;let rr;e[51]!==I||e[52]!==qe||e[53]!==T||e[54]!==_||e[55]!==U||e[56]!==y||e[57]!==ie.parsed||e[58]!==$||e[59]!==a||e[60]!==he||e[61]!==lt||e[62]!==ut||e[63]!==l?(rr=P=>{if(lt){tr(),xi(),Ai(!1);return}const V={query:P?.query||he,dataset:P?.dataset||_,params:ml(JSON.stringify(P?.params||ie.parsed,null,2),l),perspective:en({visionPerspective:P&&"perspective"in P?P.perspective:$,perspectiveStack:a,scheduledDraftsStack:ut}),apiVersion:P?.apiVersion||(T&&U?T:I)};if(y.set("query",V.query),y.set("params",V.params.raw),xi(),Ai(!V.params.error&&!!V.query),Yi(!1),cs([]),bi(V.params.error?new Error(V.params.error):void 0),yi(void 0),fs(void 0),gs(void 0),V.params.error)return;const ke={perspective:V.perspective??[]},$e=qe.withConfig({apiVersion:V.apiVersion,dataset:V.dataset,perspective:V.perspective}),wi=$e.getUrl($e.getDataUrl("query",tn(V.query,V.params.parsed,ke)));xe(wi);const Rs=Date.now();x.current=$e.observable.fetch(V.query,V.params.parsed,{filterResponse:!1,tag:"vision"}).subscribe({next:Te=>{fs(Te.ms),gs(Date.now()-Rs),yi(Te.result),Ai(!1),bi(void 0)},error:Te=>{bi(Te),Ai(!1)}})},e[51]=I,e[52]=qe,e[53]=T,e[54]=_,e[55]=U,e[56]=y,e[57]=ie.parsed,e[58]=$,e[59]=a,e[60]=he,e[61]=lt,e[62]=ut,e[63]=l,e[64]=rr):rr=e[64];const De=rr;let sr;e[65]!==De||e[66]!==y?(sr=P=>{P!==void 0&&!Zs(P)||(Y(P),y.set("perspective",P),De({perspective:P}))},e[65]=De,e[66]=y,e[67]=sr):sr=e[67];const Ht=sr;let nr;e[68]!==De||e[69]!==y?(nr=P=>{const V=P.target.value;y.set("dataset",V),ee(V),De({dataset:V})},e[68]=De,e[69]=y,e[70]=nr):nr=e[70];const bs=nr;let or;e[71]!==De||e[72]!==y?(or=P=>{const V=P.target.value;if(V?.toLowerCase()==="other"){W("v"),D.current?.focus();return}ae(V),W(!1),y.set("apiVersion",V),De({apiVersion:V})},e[71]=De,e[72]=y,e[73]=or):or=e[73];const As=or;let lr;e[74]!==De||e[75]!==y?(lr=P=>{const V=P.target.value||"";W(V||"v"),rn(V)&&(ae(V),y.set("apiVersion",V),De({apiVersion:V}))},e[74]=De,e[75]=y,e[76]=lr):lr=e[76];const xs=lr;let ar;e[77]!==Ht?(ar=P=>{const V=P.target.value;Ht(V==="default"?void 0:V)},e[77]=Ht,e[78]=ar):ar=e[78];const Ss=ar;let ur;e[79]===Symbol.for("react.memo_cache_sentinel")?(ur=P=>{P.type==="mutation"&&cs(V=>V.length===50?[P,...V.slice(0,49)]:[P,...V])},e[79]=ur):ur=e[79];const ru=ur;let cr;e[80]!==qe||e[81]!==at||e[82]!==y||e[83]!==ie.error||e[84]!==ie.parsed||e[85]!==ie.raw||e[86]!==he?(cr=()=>{if(at){xi(),Yi(!1);return}const P=qe.getDataUrl("listen",tn(he,ie.parsed,{})),V=!ie.error&&he.trim().length>0;y.set("query",he),y.set("params",ie.raw),tr(),xe(P),cs([]),Ai(!1),yi(void 0),Yi(V),bi(ie.error?new Error(ie.error):void 0),fs(void 0),gs(void 0),V&&(k.current=qe.listen(he,ie.parsed,{events:["mutation","welcome"],includeAllVersions:!0}).subscribe({next:ru,error:ke=>{bi(ke),Yi(!1)}}))},e[80]=qe,e[81]=at,e[82]=y,e[83]=ie.error,e[84]=ie.parsed,e[85]=ie.raw,e[86]=he,e[87]=cr):cr=e[87];const vs=cr;let hr;e[88]!==y?(hr=P=>{ot(P),y.set("params",P)},e[88]=y,e[89]=hr):hr=e[89];const ws=hr;let dr;e[90]!==I||e[91]!==_||e[92]!==t||e[93]!==$||e[94]!==o?(dr=P=>{const V=P.match(qp);if(!V)return null;const[,ke,$e,wi]=V,Rs=new URLSearchParams(wi),Te=Hf(Rs);if(!Te)return null;let Zn,Ts;rn(ke)&&(Ii.includes(ke)?(Zn=ke,Ts=!1):Ts=ke);const eo=Zs(Te.options.perspective)&&!fl(Te.options.perspective)?Te.options.perspective:void 0;return eo&&(!Zs(Te.options.perspective)||fl(Te.options.perspective))&&o.push({closable:!0,id:"vision-paste-unsupported-perspective",status:"warning",title:'Perspective in pasted url is currently not supported. Falling back to "raw"'}),{query:Te.query,params:Te.params,rawParams:JSON.stringify(Te.params,null,2),dataset:t.includes($e)?$e:_,apiVersion:Zn||I,customApiVersion:Ts,perspective:eo||$,url:P}},e[90]=I,e[91]=_,e[92]=t,e[93]=$,e[94]=o,e[95]=dr):dr=e[95];const Vt=dr;let fr;e[96]!==De||e[97]!==y?(fr=P=>{ee(P.dataset),nt(P.query),ot(P.rawParams),ae(P.apiVersion),P.customApiVersion&&W(P.customApiVersion),Y(P.perspective),xe(P.url),g.current?.resetEditorContent(P.query),f.current?.resetEditorContent(P.rawParams),y.merge({query:P.query,params:P.rawParams,dataset:P.dataset,apiVersion:P.customApiVersion||P.apiVersion,perspective:P.perspective}),De(P)},e[96]=De,e[97]=y,e[98]=fr):fr=e[98];const qt=fr;let pr;e[99]!==Vt||e[100]!==qt||e[101]!==o?(pr=P=>{if(!P.clipboardData)return;const V=P.clipboardData.getData("text/plain");P.preventDefault();const ke=Vt(V);ke&&(qt(ke),o.push({closable:!0,id:"vision-paste",status:"info",title:"Parsed URL to query"}))},e[99]=Vt,e[100]=qt,e[101]=o,e[102]=pr):pr=e[102];const Si=pr;let gr;e[103]!==De||e[104]!==ie.valid?(gr=P=>{const V=m.current&&Vp(m.current,P.target);$p(P)&&V&&ie.valid&&(De(),P.preventDefault(),P.stopPropagation())},e[103]=De,e[104]=ie.valid,e[105]=gr):gr=e[105];const vi=gr;let mr,Dr;e[106]!==vi||e[107]!==Si?(mr=()=>(window.document.addEventListener("paste",Si),window.document.addEventListener("keydown",vi),()=>{window.document.removeEventListener("paste",Si),window.document.removeEventListener("keydown",vi)}),Dr=[vi,Si],e[106]=vi,e[107]=Si,e[108]=mr,e[109]=Dr):(mr=e[108],Dr=e[109]),L.useEffect(mr,Dr);let Cr,yr;e[110]===Symbol.for("react.memo_cache_sentinel")?(Cr=()=>()=>{tr(),xi()},yr=[tr,xi],e[110]=Cr,e[111]=yr):(Cr=e[110],yr=e[111]),L.useEffect(Cr,yr);let br;e[112]!==Ht?(br=P=>{P.length>0&&Ht("pinnedRelease")},e[112]=Ht,e[113]=br):br=e[113];const Es=L.useEffectEvent(br);let Ar;e[114]!==Es||e[115]!==a?(Ar=()=>{Es(a)},e[114]=Es,e[115]=a,e[116]=Ar):Ar=e[116];let xr;e[117]!==a?(xr=[a],e[117]=a,e[118]=xr):xr=e[118],L.useEffect(Ar,xr);let Sr;e[119]!==qe||e[120]!==$||e[121]!==a||e[122]!==ut?(Sr=(P,V)=>{const ke={perspective:en({visionPerspective:$,perspectiveStack:a,scheduledDraftsStack:ut})??[]};return qe.getUrl(qe.getDataUrl("query",tn(P,V,ke)))},e[119]=qe,e[120]=$,e[121]=a,e[122]=ut,e[123]=Sr):Sr=e[123];const Fs=Sr;let $t;e[124]!==I||e[125]!==T||e[126]!==_||e[127]!==t||e[128]!==As||e[129]!==bs||e[130]!==Ss||e[131]!==xs||e[132]!==u||e[133]!==U||e[134]!==$||e[135]!==Q?($t=C.jsx(xp,{apiVersion:I,customApiVersion:T,dataset:_,datasets:t,onChangeDataset:bs,onChangeApiVersion:As,customApiVersionElementRef:D,onCustomApiVersionChange:xs,isValidApiVersion:U,onChangePerspective:Ss,url:Q,perspective:$,isScheduledDraftsEnabled:u}),e[124]=I,e[125]=T,e[126]=_,e[127]=t,e[128]=As,e[129]=bs,e[130]=Ss,e[131]=xs,e[132]=u,e[133]=U,e[134]=$,e[135]=Q,e[136]=$t):$t=e[136];const Bs=Mt?window.innerWidth:window.innerWidth-275,ks=ms?"vertical":"horizontal",Ms=ms?Ie.defaultSize:Ie.minSize,su=Ie.size,nu=Ie.allowResize,Os=ms?Ie.minSize:100,ou=Ie.maxSize;let Kt;e[137]!==l?(Kt=l("query.label"),e[137]=l,e[138]=Kt):Kt=e[138];let Ut;e[139]!==Kt?(Ut=C.jsx(Xa,{children:C.jsx(Ne,{children:C.jsx(pt,{muted:!0,children:Kt})})}),e[139]=Kt,e[140]=Ut):Ut=e[140];let Qt;e[141]!==he?(Qt=C.jsx(Gn,{initialValue:he,onChange:nt,ref:g}),e[141]=he,e[142]=Qt):Qt=e[142];let Jt;e[143]!==Ut||e[144]!==Qt?(Jt=C.jsx(gl,{display:"flex","data-testid":"vision-query-editor",children:C.jsxs(le,{flex:1,children:[Ut,Qt]})}),e[143]=Ut,e[144]=Qt,e[145]=Jt):Jt=e[145];let Yt;e[146]!==ws||e[147]!==ie.error||e[148]!==ie.raw||e[149]!==ie.valid?(Yt=C.jsx(np,{value:ie.raw,onChange:ws,paramsError:ie.error,hasValidParams:ie.valid,editorRef:f}),e[146]=ws,e[147]=ie.error,e[148]=ie.raw,e[149]=ie.valid,e[150]=Yt):Yt=e[150];let Gt;e[151]!==vs||e[152]!==De||e[153]!==at||e[154]!==ie.valid||e[155]!==lt?(Gt=C.jsx(gp,{hasValidParams:ie.valid,queryInProgress:lt,listenInProgress:at,onQueryExecution:De,onListenExecution:vs}),e[151]=vs,e[152]=De,e[153]=at,e[154]=ie.valid,e[155]=lt,e[156]=Gt):Gt=e[156];let Xt;e[157]!==Yt||e[158]!==Gt?(Xt=C.jsxs(gl,{display:"flex",children:[Yt,Gt]}),e[157]=Yt,e[158]=Gt,e[159]=Xt):Xt=e[159];let Zt;e[160]!==Ie.allowResize||e[161]!==Ie.maxSize||e[162]!==Ie.size||e[163]!==Ms||e[164]!==Os||e[165]!==Jt||e[166]!==Xt?(Zt=C.jsx(le,{height:"stretch",flex:1,children:C.jsxs(js,{className:"sidebarPanes",split:"horizontal",defaultSize:Ms,size:su,allowResize:nu,minSize:Os,maxSize:ou,primary:"first",children:[Jt,Xt]})}),e[160]=Ie.allowResize,e[161]=Ie.maxSize,e[162]=Ie.size,e[163]=Ms,e[164]=Os,e[165]=Jt,e[166]=Xt,e[167]=Zt):Zt=e[167];let ei;e[168]!==_||e[169]!==ps||e[170]!==hs||e[171]!==at||e[172]!==Be||e[173]!==lt||e[174]!==Wt||e[175]!==ds?(ei=C.jsx(Hp,{error:hs,queryInProgress:lt,queryResult:Wt,listenInProgress:at,listenMutations:Be,dataset:_,queryTime:ds,e2eTime:ps}),e[168]=_,e[169]=ps,e[170]=hs,e[171]=at,e[172]=Be,e[173]=lt,e[174]=Wt,e[175]=ds,e[176]=ei):ei=e[176];let ti;e[177]!==ks||e[178]!==Zt||e[179]!==ei?(ti=C.jsx(le,{height:"stretch",flex:1,children:C.jsxs(js,{className:"sidebarPanes",split:ks,minSize:300,children:[Zt,ei]})}),e[177]=ks,e[178]=Zt,e[179]=ei,e[180]=ti):ti=e[180];let vr;e[181]===Symbol.for("react.memo_cache_sentinel")?(vr={position:"relative",height:"100%"},e[181]=vr):vr=e[181];let wr;e[182]===Symbol.for("react.memo_cache_sentinel")?(wr={position:"absolute",left:-32,top:"50%",transform:"translateY(-50%)",zIndex:100,pointerEvents:"auto"},e[182]=wr):wr=e[182];let ii;e[183]!==Mt?(ii=()=>iu(!Mt),e[183]=Mt,e[184]=ii):ii=e[184];let Er;e[185]===Symbol.for("react.memo_cache_sentinel")?(Er={display:"flex",alignItems:"center",height:"100%"},e[185]=Er):Er=e[185];let ri;e[186]!==Mt?(ri=C.jsx("div",{style:Er,children:Mt?C.jsx(wu,{}):C.jsx(Eu,{})}),e[186]=Mt,e[187]=ri):ri=e[187];let si;e[188]!==ii||e[189]!==ri?(si=C.jsx(st,{mode:"ghost",padding:2,style:wr,onClick:ii,children:ri}),e[188]=ii,e[189]=ri,e[190]=si):si=e[190];let ni;e[191]!==ie.parsed?(ni=ie.parsed||{},e[191]=ie.parsed,e[192]=ni):ni=e[192];let oi;e[193]!==Fs||e[194]!==Vt||e[195]!==he||e[196]!==qt||e[197]!==ni||e[198]!==Q?(oi=C.jsx(hp,{url:Q,getStateFromUrl:Vt,setStateFromParsedUrl:qt,currentQuery:he,currentParams:ni,generateUrl:Fs}),e[193]=Fs,e[194]=Vt,e[195]=he,e[196]=qt,e[197]=ni,e[198]=Q,e[199]=oi):oi=e[199];let li;e[200]!==si||e[201]!==oi?(li=C.jsxs(le,{style:vr,children:[si,oi]}),e[200]=si,e[201]=oi,e[202]=li):li=e[202];let ai;e[203]!==Bs||e[204]!==ti||e[205]!==li?(ai=C.jsx(Kf,{flex:"auto",children:C.jsxs(js,{minSize:800,defaultSize:window.innerWidth-275,size:Bs,maxSize:-225,primary:"first",children:[ti,li]})}),e[203]=Bs,e[204]=ti,e[205]=li,e[206]=ai):ai=e[206];let Fr;return e[207]!==$t||e[208]!==ai?(Fr=C.jsxs(Ya,{direction:"column",height:"fill",ref:m,sizing:"border",overflow:"hidden","data-testid":"vision-root",children:[$t,ai]}),e[207]=$t,e[208]=ai,e[209]=Fr):Fr=e[209],Fr}function Up(i){return bu(i._id)}function Qp(i){return yu(i)&&i.state==="scheduled"}function Jp(i){const e=me.c(7),{client:t,datasets:r}=i;let s;e:{if(Array.isArray(r)){let o;e[0]!==r?(o=Cl(r),e[0]=r,e[1]=o):o=e[1],s=o;break e}let n;if(e[2]!==t.observable.datasets||e[3]!==r){let o;e[5]!==r?(o=l=>typeof r=="function"?r(l).map(Xp):l.map(Gp),e[5]=r,e[6]=o):o=e[6],n=t.observable.datasets.list().pipe(yl(o),du(Yp)),e[2]=t.observable.datasets,e[3]=r,e[4]=n}else n=e[4];s=n}return fu(s,null)}function Yp(i){return Cl(i)}function Gp(i){return i.name}function Xp(i){return i.name}function Zp(i){const e=me.c(19);let t;e[0]===Symbol.for("react.memo_cache_sentinel")?(t={apiVersion:"v2025-06-27"},e[0]=t):t=e[0];const r=Tn(t);let s;e[1]!==r||e[2]!==i.config.datasets?(s={client:r,datasets:i.config.datasets},e[1]=r,e[2]=i.config.datasets,e[3]=s):s=e[3];const n=Jp(s);if(!n){let p;return e[4]===Symbol.for("react.memo_cache_sentinel")?(p=C.jsx(Ne,{align:"center",height:"fill",justify:"center",children:C.jsx(Ka,{})}),e[4]=p):p=e[4],p}let o;e[5]!==n||e[6]!==i.client?(o=n instanceof Error?[i.client.config().dataset||"production"]:n,e[5]=n,e[6]=i.client,e[7]=o):o=e[7];const l=o;let a;e[8]!==i.client?(a=i.client.config(),e[8]=i.client,e[9]=a):a=e[9];const u=a.projectId;let c;e[10]!==l||e[11]!==i.client||e[12]!==i.config.defaultDataset?(c=i.config.defaultDataset||i.client.config().dataset||l[0],e[10]=l,e[11]=i.client,e[12]=i.config.defaultDataset,e[13]=c):c=e[13];const h=c;let d;return e[14]!==l||e[15]!==h||e[16]!==u||e[17]!==i?(d=C.jsx(Kp,{...i,datasets:l,projectId:u,defaultDataset:h},u),e[14]=l,e[15]=h,e[16]=u,e[17]=i,e[18]=d):d=e[18],d}class e0 extends L.Component{constructor(e){super(e),this.state={error:null,numRetries:0}}static getDerivedStateFromError(e){return{error:e instanceof Error?e.message:`${e}`}}handleRetryRender=()=>this.setState(e=>({error:null,numRetries:e.numRetries+1}));handleRetryWithCacheClear=()=>{If(),this.handleRetryRender()};render(){if(!this.state.error)return this.props.children;const e=this.state.error,t=this.state.numRetries>0;return C.jsx(be,{height:"fill",overflow:"auto",paddingY:[4,5,6,7],paddingX:4,sizing:"border",tone:"critical",children:C.jsx(cu,{width:3,children:C.jsxs(je,{space:4,children:[C.jsx("div",{children:C.jsx(st,{onClick:t?this.handleRetryWithCacheClear:this.handleRetryRender,text:t?"Clear cache and retry":"Retry",tone:"default"})}),C.jsx(hu,{children:"An error occurred"}),C.jsx(be,{border:!0,radius:2,overflow:"auto",padding:4,tone:"inherit",children:C.jsx(je,{space:4,children:e&&C.jsx(is,{size:1,children:C.jsxs("strong",{children:["Error: ",e]})})})})]})})})}}function o0(i){const e=me.c(6);let t;e[0]===Symbol.for("react.memo_cache_sentinel")?(t={apiVersion:"1"},e[0]=t):t=e[0];const r=Tn(t);let s;e[1]!==i.tool.options?(s={defaultApiVersion:$a,...i.tool.options},e[1]=i.tool.options,e[2]=s):s=e[2];const n=s;let o;return e[3]!==r||e[4]!==n?(o=C.jsx(e0,{children:C.jsx(Zp,{client:r,config:n})}),e[3]=r,e[4]=n,e[5]=o):o=e[5],o}export{o0 as default};
